!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Procedural=t()}(this,function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}function r(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var i=n(function(t,n){(function(){function r(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function i(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function o(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function a(e){return function(t){return e(t)}}function s(e,t){return e.has(t)}function l(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function c(e,t){return function(n){return e(t(n))}}function u(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function h(){}function p(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function d(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function f(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function m(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new f;++t<n;)this.add(e[t])}function v(e){this.size=(this.__data__=new d(e)).size}function g(e,t){var n=Un(e),r=!n&&kn(e),i=!n&&!r&&Nn(e),o=!n&&!r&&!i&&Gn(e),a=n||r||i||o,s=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],l=s.length;for(var c in e)!t&&!Yt.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||W(c,l))||s.push(c);return s}function y(e,t,n){var r=e[t];Yt.call(e,t)&&re(r,n)&&(n!==_e||t in e)||b(e,t,n)}function x(e,t){for(var n=e.length;n--;)if(re(e[n][0],t))return n;return-1}function b(e,t,n){"__proto__"==t&&sn?sn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function w(e,t,n,i,o,a){var s,l=t&Ce,c=t&Oe,u=t&Pe;if(n&&(s=o?n(e,i,o,a):n(e)),s!==_e)return s;if(!se(e))return e;var h=Un(e);if(h){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Yt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(e,s)}else{var p=zn(e),d=p==qe||p==Ye;if(Nn(e))return function(e,t){if(t)return e.slice();var n=e.length,r=en?en(n):new e.constructor(n);return e.copy(r),r}(e,l);if(p==Ke||p==Be||d&&!o){if(s=c||d?{}:function(e){return"function"!=typeof e.constructor||X(e)?{}:An(tn(e))}(e),!l)return c?function(e,t){return k(e,Ln(e),t)}(e,function(e,t){return e&&k(t,ge(t),e)}(s,e)):function(e,t){return k(e,Pn(e),t)}(e,function(e,t){return e&&k(t,ve(t),e)}(s,e))}else{if(!Ct[p])return o?e:{};s=function(e,t,n){var r=e.constructor;switch(t){case at:return D(e);case He:case Ve:return new r(+e);case st:return function(e,t){return new e.constructor(t?D(e.buffer):e.buffer,e.byteOffset,e.byteLength)}(e,n);case lt:case ct:case ut:case ht:case pt:case dt:case ft:case mt:case vt:return function(e,t){return new e.constructor(t?D(e.buffer):e.buffer,e.byteOffset,e.length)}(e,n);case Xe:return new r;case Ze:case nt:return new r(e);case et:return function(e){var t=new e.constructor(e.source,St.exec(e));return t.lastIndex=e.lastIndex,t}(e);case tt:return new r;case rt:return function(e){return Mn?Object(Mn.call(e)):{}}(e)}}(e,p,l)}}a||(a=new v);var f=a.get(e);if(f)return f;if(a.set(e,s),jn(e))return e.forEach(function(r){s.add(w(r,t,n,r,e,a))}),s;if(Bn(e))return e.forEach(function(r,i){s.set(i,w(r,t,n,i,e,a))}),s;var m=h?_e:(u?c?j:B:c?ge:ve)(e);return r(m||e,function(r,i){m&&(r=e[i=r]),y(s,i,w(r,t,n,i,e,a))}),s}function S(e,t){return e&&Cn(e,t,ve)}function T(e,t){for(var n=0,r=(t=I(t,e)).length;null!=e&&n<r;)e=e[Q(t[n++])];return n&&n==r?e:_e}function _(e,t,n){var r=t(e);return Un(e)?r:i(r,n(e))}function M(e){return null==e?e===_e?it:Je:an&&an in Object(e)?function(e){var t=Yt.call(e,an),n=e[an];try{e[an]=_e;var r=!0}catch(e){}var i=Zt.call(e);return r&&(t?e[an]=n:delete e[an]),i}(e):function(e){return Zt.call(e)}(e)}function E(e,t){return null!=e&&t in Object(e)}function A(e){return le(e)&&M(e)==Be}function R(e,t,n,r,i){return e===t||(null==e||null==t||!le(e)&&!le(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=Un(e),s=Un(t),l=a?je:zn(e),c=s?je:zn(t),u=(l=l==Be?Ke:l)==Ke,h=(c=c==Be?Ke:c)==Ke,p=l==c;if(p&&Nn(e)){if(!Nn(t))return!1;a=!0,u=!1}if(p&&!u)return o||(o=new v),a||Gn(e)?U(e,t,n,r,i,o):N(e,t,l,n,r,i,o);if(!(n&Le)){var d=u&&Yt.call(e,"__wrapped__"),f=h&&Yt.call(t,"__wrapped__");if(d||f){var m=d?e.value():e,g=f?t.value():t;return o||(o=new v),i(m,g,n,r,o)}}return!!p&&(o||(o=new v),function(e,t,n,r,i,o){var a=n&Le,s=B(e),l=s.length;if(l!=B(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:Yt.call(t,u)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++c<l;){u=s[c];var f=e[u],m=t[u];if(r)var v=a?r(m,f,u,t,e,o):r(f,m,u,e,t,o);if(!(v===_e?f===m||i(f,m,n,r,o):v)){p=!1;break}d||(d="constructor"==u)}if(p&&!d){var g=e.constructor,y=t.constructor;g!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))}(e,t,n,r,R,i))}function C(e){return!(!se(e)||function(e){return!!Xt&&Xt in e}(e))&&(oe(e)?Jt:Mt).test($(e))}function O(e){return"function"==typeof e?e:null==e?xe:"object"==typeof e?Un(e)?L(e[0],e[1]):function(e){var t=function(e){for(var t=ve(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Z(i)]}return t}(e);return 1==t.length&&t[0][2]?J(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],c=e[l],u=s[1];if(a&&s[2]){if(c===_e&&!(l in e))return!1}else{var h=new v;if(r)var p=r(c,u,l,e,t,h);if(!(p===_e?R(u,c,Le|ze,r,h):p))return!1}}return!0}(n,e,t)}}(e):we(e)}function P(e){if(!se(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=X(e),n=[];for(var r in e)("constructor"!=r||!t&&Yt.call(e,r))&&n.push(r);return n}function L(e,t){return Y(e)&&Z(t)?J(Q(e),t):function(n){var r=fe(n,e);return r===_e&&r===t?me(n,e):R(t,r,Le|ze)}}function z(e,t){return Fn(K(e,t,xe),e+"")}function F(e){if("string"==typeof e)return e;if(Un(e))return function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}(e,F)+"";if(ce(e))return En?En.call(e):"";var t=e+"";return"0"==t&&1/e==-De?"-0":t}function I(e,t){return Un(e)?e:Y(e,t)?[e]:In(de(e))}function D(e){var t=new e.constructor(e.byteLength);return new $t(t).set(new $t(e)),t}function k(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):_e;l===_e&&(l=e[s]),i?b(n,s,l):y(n,s,l)}return n}function U(e,t,n,r,i,a){var l=n&Le,c=e.length,u=t.length;if(c!=u&&!(l&&u>c))return!1;var h=a.get(e);if(h&&a.get(t))return h==t;var p=-1,d=!0,f=n&ze?new m:_e;for(a.set(e,t),a.set(t,e);++p<c;){var v=e[p],g=t[p];if(r)var y=l?r(g,v,p,t,e,a):r(v,g,p,e,t,a);if(y!==_e){if(y)continue;d=!1;break}if(f){if(!o(t,function(e,t){if(!s(f,t)&&(v===e||i(v,e,n,r,a)))return f.push(t)})){d=!1;break}}else if(v!==g&&!i(v,g,n,r,a)){d=!1;break}}return a.delete(e),a.delete(t),d}function N(e,t,n,r,i,o,a){switch(n){case st:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case at:return!(e.byteLength!=t.byteLength||!o(new $t(e),new $t(t)));case He:case Ve:case Ze:return re(+e,+t);case We:return e.name==t.name&&e.message==t.message;case et:case nt:return e==t+"";case Xe:var s=l;case tt:var c=r&Le;if(s||(s=u),e.size!=t.size&&!c)return!1;var h=a.get(e);if(h)return h==t;r|=ze,a.set(e,t);var p=U(s(e),s(t),r,i,o,a);return a.delete(e),p;case rt:if(Mn)return Mn.call(e)==Mn.call(t)}return!1}function B(e){return _(e,ve,Pn)}function j(e){return _(e,ge,Ln)}function G(){var e=h.iteratee||be;return e=e===be?O:e,arguments.length?e(arguments[0],arguments[1]):e}function H(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function V(e,t){var n=function(e,t){return null==e?_e:e[t]}(e,t);return C(n)?n:_e}function W(e,t){var n=typeof e;return!!(t=null==t?ke:t)&&("number"==n||"symbol"!=n&&At.test(e))&&e>-1&&e%1==0&&e<t}function q(e,t,n){if(!se(n))return!1;var r=typeof t;return!!("number"==r?ie(n)&&W(t,n.length):"string"==r&&t in n)&&re(n[t],e)}function Y(e,t){if(Un(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ce(e))||yt.test(e)||!gt.test(e)||null!=t&&e in Object(t)}function X(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Vt)}function Z(e){return e==e&&!se(e)}function J(e,t){return function(n){return null!=n&&n[e]===t&&(t!==_e||e in Object(n))}}function K(e,t,n){return t=hn(t===_e?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=hn(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,s)}}function Q(e){if("string"==typeof e||ce(e))return e;var t=e+"";return"0"==t&&1/e==-De?"-0":t}function $(e){if(null!=e){try{return qt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ee(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:he(n);return i<0&&(i=hn(r+i,0)),function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,G(t,3),i)}function te(e,t){return(Un(e)?r:Rn)(e,G(t,3))}function ne(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Ee);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(ne.Cache||f),n}function re(e,t){return e===t||e!=e&&t!=t}function ie(e){return null!=e&&ae(e.length)&&!oe(e)}function oe(e){if(!se(e))return!1;var t=M(e);return t==qe||t==Ye||t==Ge||t==$e}function ae(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ke}function se(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function le(e){return null!=e&&"object"==typeof e}function ce(e){return"symbol"==typeof e||le(e)&&M(e)==rt}function ue(e){return e?(e=pe(e))===De||e===-De?(e<0?-1:1)*Ue:e==e?e:0:0===e?e:0}function he(e){var t=ue(e),n=t%1;return t==t?n?t-n:t:0}function pe(e){if("number"==typeof e)return e;if(ce(e))return Ne;if(se(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=se(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(bt,"");var n=_t.test(e);return n||Et.test(e)?Ot(e.slice(2),n?2:8):Tt.test(e)?Ne:+e}function de(e){return null==e?"":F(e)}function fe(e,t,n){var r=null==e?_e:T(e,t);return r===_e?n:r}function me(e,t){return null!=e&&function(e,t,n){for(var r=-1,i=(t=I(t,e)).length,o=!1;++r<i;){var a=Q(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&ae(i)&&W(a,i)&&(Un(e)||kn(e))}(e,t,E)}function ve(e){return ie(e)?g(e):function(e){if(!X(e))return un(e);var t=[];for(var n in Object(e))Yt.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}function ge(e){return ie(e)?g(e,!0):P(e)}function ye(e){return function(){return e}}function xe(e){return e}function be(e){return O("function"==typeof e?e:w(e,Ce))}function we(e){return Y(e)?function(e){return function(t){return null==t?_e:t[e]}}(Q(e)):function(e){return function(t){return T(t,e)}}(e)}function Se(){return[]}function Te(){return!1}var _e,Me=200,Ee="Expected a function",Ae="__lodash_hash_undefined__",Re=500,Ce=1,Oe=2,Pe=4,Le=1,ze=2,Fe=800,Ie=16,De=1/0,ke=9007199254740991,Ue=1.7976931348623157e308,Ne=NaN,Be="[object Arguments]",je="[object Array]",Ge="[object AsyncFunction]",He="[object Boolean]",Ve="[object Date]",We="[object Error]",qe="[object Function]",Ye="[object GeneratorFunction]",Xe="[object Map]",Ze="[object Number]",Je="[object Null]",Ke="[object Object]",Qe="[object Promise]",$e="[object Proxy]",et="[object RegExp]",tt="[object Set]",nt="[object String]",rt="[object Symbol]",it="[object Undefined]",ot="[object WeakMap]",at="[object ArrayBuffer]",st="[object DataView]",lt="[object Float32Array]",ct="[object Float64Array]",ut="[object Int8Array]",ht="[object Int16Array]",pt="[object Int32Array]",dt="[object Uint8Array]",ft="[object Uint8ClampedArray]",mt="[object Uint16Array]",vt="[object Uint32Array]",gt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yt=/^\w*$/,xt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bt=/^\s+|\s+$/g,wt=/\\(\\)?/g,St=/\w*$/,Tt=/^[-+]0x[0-9a-f]+$/i,_t=/^0b[01]+$/i,Mt=/^\[object .+?Constructor\]$/,Et=/^0o[0-7]+$/i,At=/^(?:0|[1-9]\d*)$/,Rt={};Rt[lt]=Rt[ct]=Rt[ut]=Rt[ht]=Rt[pt]=Rt[dt]=Rt[ft]=Rt[mt]=Rt[vt]=!0,Rt[Be]=Rt[je]=Rt[at]=Rt[He]=Rt[st]=Rt[Ve]=Rt[We]=Rt[qe]=Rt[Xe]=Rt[Ze]=Rt[Ke]=Rt[et]=Rt[tt]=Rt[nt]=Rt[ot]=!1;var Ct={};Ct[Be]=Ct[je]=Ct[at]=Ct[st]=Ct[He]=Ct[Ve]=Ct[lt]=Ct[ct]=Ct[ut]=Ct[ht]=Ct[pt]=Ct[Xe]=Ct[Ze]=Ct[Ke]=Ct[et]=Ct[tt]=Ct[nt]=Ct[rt]=Ct[dt]=Ct[ft]=Ct[mt]=Ct[vt]=!0,Ct[We]=Ct[qe]=Ct[ot]=!1;var Ot=parseInt,Pt="object"==typeof e&&e&&e.Object===Object&&e,Lt="object"==typeof self&&self&&self.Object===Object&&self,zt=Pt||Lt||Function("return this")(),Ft=n&&!n.nodeType&&n,It=Ft&&t&&!t.nodeType&&t,Dt=It&&It.exports===Ft,kt=Dt&&Pt.process,Ut=function(){try{return kt&&kt.binding&&kt.binding("util")}catch(e){}}(),Nt=Ut&&Ut.isMap,Bt=Ut&&Ut.isSet,jt=Ut&&Ut.isTypedArray,Gt=Array.prototype,Ht=Function.prototype,Vt=Object.prototype,Wt=zt["__core-js_shared__"],qt=Ht.toString,Yt=Vt.hasOwnProperty,Xt=function(){var e=/[^.]+$/.exec(Wt&&Wt.keys&&Wt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Zt=Vt.toString,Jt=RegExp("^"+qt.call(Yt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kt=Dt?zt.Buffer:_e,Qt=zt.Symbol,$t=zt.Uint8Array,en=Kt?Kt.allocUnsafe:_e,tn=c(Object.getPrototypeOf,Object),nn=Object.create,rn=Vt.propertyIsEnumerable,on=Gt.splice,an=Qt?Qt.toStringTag:_e,sn=function(){try{var e=V(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ln=Object.getOwnPropertySymbols,cn=Kt?Kt.isBuffer:_e,un=c(Object.keys,Object),hn=Math.max,pn=Date.now,dn=V(zt,"DataView"),fn=V(zt,"Map"),mn=V(zt,"Promise"),vn=V(zt,"Set"),gn=V(zt,"WeakMap"),yn=V(Object,"create"),xn=$(dn),bn=$(fn),wn=$(mn),Sn=$(vn),Tn=$(gn),_n=Qt?Qt.prototype:_e,Mn=_n?_n.valueOf:_e,En=_n?_n.toString:_e,An=function(){function e(){}return function(t){if(!se(t))return{};if(nn)return nn(t);e.prototype=t;var n=new e;return e.prototype=_e,n}}();p.prototype.clear=function(){this.__data__=yn?yn(null):{},this.size=0},p.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},p.prototype.get=function(e){var t=this.__data__;if(yn){var n=t[e];return n===Ae?_e:n}return Yt.call(t,e)?t[e]:_e},p.prototype.has=function(e){var t=this.__data__;return yn?t[e]!==_e:Yt.call(t,e)},p.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=yn&&t===_e?Ae:t,this},d.prototype.clear=function(){this.__data__=[],this.size=0},d.prototype.delete=function(e){var t=this.__data__,n=x(t,e);return!(n<0||(n==t.length-1?t.pop():on.call(t,n,1),--this.size,0))},d.prototype.get=function(e){var t=this.__data__,n=x(t,e);return n<0?_e:t[n][1]},d.prototype.has=function(e){return x(this.__data__,e)>-1},d.prototype.set=function(e,t){var n=this.__data__,r=x(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},f.prototype.clear=function(){this.size=0,this.__data__={hash:new p,map:new(fn||d),string:new p}},f.prototype.delete=function(e){var t=H(this,e).delete(e);return this.size-=t?1:0,t},f.prototype.get=function(e){return H(this,e).get(e)},f.prototype.has=function(e){return H(this,e).has(e)},f.prototype.set=function(e,t){var n=H(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},m.prototype.add=m.prototype.push=function(e){return this.__data__.set(e,Ae),this},m.prototype.has=function(e){return this.__data__.has(e)},v.prototype.clear=function(){this.__data__=new d,this.size=0},v.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},v.prototype.get=function(e){return this.__data__.get(e)},v.prototype.has=function(e){return this.__data__.has(e)},v.prototype.set=function(e,t){var n=this.__data__;if(n instanceof d){var r=n.__data__;if(!fn||r.length<Me-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new f(r)}return n.set(e,t),this.size=n.size,this};var Rn=function(e,t){return function(n,r){if(null==n)return n;if(!ie(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}(S),Cn=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}(),On=sn?function(e,t){return sn(e,"toString",{configurable:!0,enumerable:!1,value:ye(t),writable:!0})}:xe,Pn=ln?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}(ln(e),function(t){return rn.call(e,t)}))}:Se,Ln=ln?function(e){for(var t=[];e;)i(t,Pn(e)),e=tn(e);return t}:Se,zn=M;(dn&&zn(new dn(new ArrayBuffer(1)))!=st||fn&&zn(new fn)!=Xe||mn&&zn(mn.resolve())!=Qe||vn&&zn(new vn)!=tt||gn&&zn(new gn)!=ot)&&(zn=function(e){var t=M(e),n=t==Ke?e.constructor:_e,r=n?$(n):"";if(r)switch(r){case xn:return st;case bn:return Xe;case wn:return Qe;case Sn:return tt;case Tn:return ot}return t});var Fn=function(e){var t=0,n=0;return function(){var r=pn(),i=Ie-(r-n);if(n=r,i>0){if(++t>=Fe)return arguments[0]}else t=0;return e.apply(_e,arguments)}}(On),In=function(e){var t=ne(e,function(e){return n.size===Re&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(xt,function(e,n,r,i){t.push(r?i.replace(wt,"$1"):n||e)}),t}),Dn=function(e){return function(t,n,r){var i=Object(t);if(!ie(t)){var o=G(n,3);t=ve(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:_e}}(ee);ne.Cache=f;var kn=A(function(){return arguments}())?A:function(e){return le(e)&&Yt.call(e,"callee")&&!rn.call(e,"callee")},Un=Array.isArray,Nn=cn||Te,Bn=Nt?a(Nt):function(e){return le(e)&&zn(e)==Xe},jn=Bt?a(Bt):function(e){return le(e)&&zn(e)==tt},Gn=jt?a(jt):function(e){return le(e)&&ae(e.length)&&!!Rt[M(e)]},Hn=function(e){return z(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:_e,a=i>2?n[2]:_e;for(o=e.length>3&&"function"==typeof o?(i--,o):_e,a&&q(n[0],n[1],a)&&(o=i<3?_e:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t})}(function(e,t){if(X(t)||ie(t))return k(t,ve(t),e),_e;for(var n in t)Yt.call(t,n)&&y(e,n,t[n])}),Vn=z(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:_e;for(i&&q(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=ge(o),s=-1,l=a.length;++s<l;){var c=a[s],u=e[c];(u===_e||re(u,Vt[c])&&!Yt.call(e,c))&&(e[c]=o[c])}return e});h.assign=Hn,h.constant=ye,h.defaults=Vn,h.iteratee=be,h.keys=ve,h.keysIn=ge,h.matchesProperty=function(e,t){return L(e,w(t,Ce))},h.memoize=ne,h.property=we,h.clone=function(e){return w(e,Pe)},h.eq=re,h.find=Dn,h.findIndex=ee,h.forEach=te,h.forOwn=function(e,t){return e&&S(e,G(t,3))},h.get=fe,h.hasIn=me,h.identity=xe,h.isArguments=kn,h.isArray=Un,h.isArrayLike=ie,h.isBuffer=Nn,h.isEqual=function(e,t){return R(e,t)},h.isFunction=oe,h.isLength=ae,h.isMap=Bn,h.isObject=se,h.isObjectLike=le,h.isSet=jn,h.isSymbol=ce,h.isTypedArray=Gn,h.stubArray=Se,h.stubFalse=Te,h.toFinite=ue,h.toInteger=he,h.toNumber=pe,h.toString=de,h.each=te,h.VERSION="4.17.5",It?((It.exports=h)._=h,Ft._=h):zt._=h}).call(e)}),o=new(t(n(function(e,t){e.exports=function e(t,n,i){function o(s,l){if(!n[s]){if(!t[s]){var c=r;if(!l&&c)return c(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return o(n||e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var a=r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){var r={},i=Object.create,o=Object.defineProperties,a=Object.defineProperty,s=function(e){var t=void 0===arguments[1]?{}:arguments[1];return{value:e,configurable:!!t.c,writable:!!t.w,enumerable:!!t.e}},l=void 0;try{var c=a({},"y",{get:function(){return 1}});l=1===c.y}catch(e){l=!1}var u={},h=function(e){e=String(e);for(var t="",n=0;u[e+t];)t=n+=1;u[e+t]=1;var r="Symbol("+e+t+")";return l&&a(Object.prototype,r,{get:void 0,set:function(e){a(this,r,s(e,{c:!0,w:!0}))},configurable:!0,enumerable:!1}),r},p=i(null);function d(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");e=void 0===e?"":String(e);var t=h(e);return l?i(p,{__description__:s(e),__tag__:s(t)}):t}o(d,{for:s(function(e){var t=String(e);if(r[t])return r[t];var n=d(t);return r[t]=n,n}),keyFor:s(function(e){if(l&&(!(t=e)||"Symbol"!==t[d.toStringTag]))throw new TypeError(e+" is not a symbol");var t;for(var n in r)if(r[n]===e)return l?r[n].__description__:r[n].substr(7,r[n].length-8)})}),o(d,{hasInstance:s(d("hasInstance")),isConcatSpreadable:s(d("isConcatSpreadable")),iterator:s(d("iterator")),match:s(d("match")),replace:s(d("replace")),search:s(d("search")),species:s(d("species")),split:s(d("split")),toPrimitive:s(d("toPrimitive")),toStringTag:s(d("toStringTag")),unscopables:s(d("unscopables"))}),o(p,{constructor:s(d),toString:s(function(){return this.__tag__}),valueOf:s(function(){return"Symbol("+this.__description__+")"})}),l&&a(p,d.toStringTag,s("Symbol",{c:!0})),t.exports="function"==typeof Symbol?Symbol:d},{}],2:[function(e,t,n){function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];if(this._events[e].fn)return[this._events[e].fn];for(var t=0,n=this._events[e].length,r=new Array(n);t<n;t++)r[t]=this._events[e][t].fn;return r},i.prototype.emit=function(e,t,n,r,i,o){if(!this._events||!this._events[e])return!1;var a,s,l=this._events[e],c=arguments.length;if("function"==typeof l.fn){switch(l.once&&this.removeListener(e,l.fn,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,i),!0;case 6:return l.fn.call(l.context,t,n,r,i,o),!0}for(s=1,a=new Array(c-1);s<c;s++)a[s-1]=arguments[s];l.fn.apply(l.context,a)}else{var u,h=l.length;for(s=0;s<h;s++)switch(l[s].once&&this.removeListener(e,l[s].fn,!0),c){case 1:l[s].fn.call(l[s].context);break;case 2:l[s].fn.call(l[s].context,t);break;case 3:l[s].fn.call(l[s].context,t,n);break;default:if(!a)for(u=1,a=new Array(c-1);u<c;u++)a[u-1]=arguments[u];l[s].fn.apply(l[s].context,a)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],i]:this._events[e].push(i):this._events[e]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],i]:this._events[e].push(i):this._events[e]=i,this},i.prototype.removeListener=function(e,t,n){if(!this._events||!this._events[e])return this;var r=this._events[e],i=[];if(t&&(r.fn&&(r.fn!==t||n&&!r.once)&&i.push(r),!r.fn))for(var o=0,a=r.length;o<a;o++)(r[o].fn!==t||n&&!r[o].once)&&i.push(r[o]);return i.length?this._events[e]=1===i.length?i[0]:i:delete this._events[e],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[e]:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,t.exports=i},{}],3:[function(e,t,n){t.exports.Dispatcher=e("./lib/Dispatcher")},{"./lib/Dispatcher":4}],4:[function(e,t,n){var r=e("./invariant"),i=1;function o(){this.$Dispatcher_callbacks={},this.$Dispatcher_isPending={},this.$Dispatcher_isHandled={},this.$Dispatcher_isDispatching=!1,this.$Dispatcher_pendingPayload=null}o.prototype.register=function(e){var t="ID_"+i++;return this.$Dispatcher_callbacks[t]=e,t},o.prototype.unregister=function(e){r(this.$Dispatcher_callbacks[e],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",e),delete this.$Dispatcher_callbacks[e]},o.prototype.waitFor=function(e){r(this.$Dispatcher_isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var t=0;t<e.length;t++){var n=e[t];this.$Dispatcher_isPending[n]?r(this.$Dispatcher_isHandled[n],"Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",n):(r(this.$Dispatcher_callbacks[n],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n),this.$Dispatcher_invokeCallback(n))}},o.prototype.dispatch=function(e){r(!this.$Dispatcher_isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."),this.$Dispatcher_startDispatching(e);try{for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]||this.$Dispatcher_invokeCallback(t)}finally{this.$Dispatcher_stopDispatching()}},o.prototype.isDispatching=function(){return this.$Dispatcher_isDispatching},o.prototype.$Dispatcher_invokeCallback=function(e){this.$Dispatcher_isPending[e]=!0,this.$Dispatcher_callbacks[e](this.$Dispatcher_pendingPayload),this.$Dispatcher_isHandled[e]=!0},o.prototype.$Dispatcher_startDispatching=function(e){for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]=!1,this.$Dispatcher_isHandled[t]=!1;this.$Dispatcher_pendingPayload=e,this.$Dispatcher_isDispatching=!0},o.prototype.$Dispatcher_stopDispatching=function(){this.$Dispatcher_pendingPayload=null,this.$Dispatcher_isDispatching=!1},t.exports=o},{"./invariant":5}],5:[function(e,t,n){t.exports=function(e,t,n,r,i,o,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,o,a,s],u=0;l=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[u++]}))}throw l.framesToPop=1,l}}},{}],6:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.default=function(e,t,n,r,i){var o=c.uid(e[l.ACTIONS_REGISTRY],t+"."+n);e[l.ACTIONS_REGISTRY][o]=1;var a=s.default.for("alt/"+o),h={namespace:t,name:n,id:o,symbol:a},p=new u(e,a,r,i,h),d=p[l.ACTION_HANDLER];d.defer=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];setTimeout(function(){p[l.ACTION_HANDLER].apply(null,t)})},d[l.ACTION_KEY]=a,d.data=h;var f=e.actions[t],m=c.uid(f,n);return f[m]=d,d};var o,a=e("es-symbol"),s=(o=a)&&o.__esModule?o:{default:o},l=i(e("../symbols/symbols")),c=i(e("../utils/AltUtils")),u=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[l.ACTION_UID]=n,this[l.ACTION_HANDLER]=r.bind(this),this.actions=i,this.actionDetails=o,this.alt=t}return r(e,[{key:"dispatch",value:function(e){this.alt.dispatch(this[l.ACTION_UID],e,this.actionDetails)}}]),e}();t.exports=n.default},{"../symbols/symbols":10,"../utils/AltUtils":11,"es-symbol":1}],7:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}var a=o(e("eventemitter3")),s=o(e("es-symbol")),l=i(e("../symbols/symbols")),c=i(e("../../utils/functions")),u=(0,s.default)(),h=function(){function e(t,n,r,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this[u]=new a.default,this[l.LIFECYCLE]=n[l.LIFECYCLE],this[l.STATE_CONTAINER]=r||n,this._storeName=n._storeName,this.boundListeners=n[l.ALL_LISTENERS],this.StoreModel=i,c.assign(this,n[l.PUBLIC_METHODS]),this.dispatchToken=t.dispatcher.register(function(e){if(o[l.LIFECYCLE].emit("beforeEach",e,o[l.STATE_CONTAINER]),n[l.LISTENERS][e.action]){var t=!1;try{t=n[l.LISTENERS][e.action](e.data)}catch(t){if(!n[l.HANDLING_ERRORS])throw t;o[l.LIFECYCLE].emit("error",t,e,o[l.STATE_CONTAINER])}!1!==t&&o.emitChange()}o[l.LIFECYCLE].emit("afterEach",e,o[l.STATE_CONTAINER])}),this[l.LIFECYCLE].emit("init")}return r(e,[{key:"getEventEmitter",value:function(){return this[u]}},{key:"emitChange",value:function(){this[u].emit("change",this[l.STATE_CONTAINER])}},{key:"listen",value:function(e){var t=this;return this[u].on("change",e),function(){return t.unlisten(e)}}},{key:"unlisten",value:function(e){this[l.LIFECYCLE].emit("unlisten"),this[u].removeListener("change",e)}},{key:"getState",value:function(){return this.StoreModel.config.getState.call(this,this[l.STATE_CONTAINER])}}]),e}();n.default=h,t.exports=n.default},{"../../utils/functions":13,"../symbols/symbols":10,"es-symbol":1,eventemitter3:2}],8:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("es-symbol"),a=(i=o)&&i.__esModule?i:{default:i},s=r(e("../symbols/symbols")),l=r(e("../../utils/functions")),c={waitFor:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.length)throw new ReferenceError("Dispatch tokens not provided");var r=t;1===t.length&&(r=Array.isArray(t[0])?t[0]:t);var i=r.map(function(e){return e.dispatchToken||e});this.dispatcher.waitFor(i)},exportAsync:function(e){this.registerAsync(e)},registerAsync:function(e){var t=this,n=0,r=l.isFunction(e)?e(this.alt):e,i=Object.keys(r).reduce(function(e,i){var o=r[i],a=l.isFunction(o)?o(t):o;return["success","error","loading"].forEach(function(e){if(a[e]&&!a[e][s.ACTION_KEY])throw new Error(e+" handler must be an action function")}),e[i]=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];var o=t.getInstance().getState(),s=a.local&&a.local.apply(a,[o].concat(r)),l=a.shouldFetch?a.shouldFetch.apply(a,[o].concat(r)):!s,c=a.interceptResponse||function(e){return e};l?(n+=1,a.loading&&a.loading(c(null,a.loading)),a.remote.apply(a,[o].concat(r)).then(function(e){n-=1,a.success(c(e,a.success))}).catch(function(e){n-=1,a.error(c(e,a.error))})):t.emitChange()},e},{});this.exportPublicMethods(i),this.exportPublicMethods({isLoading:function(){return n>0}})},exportPublicMethods:function(e){var t=this;l.eachObject(function(e,n){if(!l.isFunction(n))throw new TypeError("exportPublicMethods expects a function");t[s.PUBLIC_METHODS][e]=n},[e])},emitChange:function(){this.getInstance().emitChange()},on:function(e,t){"error"===e&&(this[s.HANDLING_ERRORS]=!0),this[s.LIFECYCLE].on(e,t.bind(this))},bindAction:function(e,t){if(!e)throw new ReferenceError("Invalid action reference passed in");if(!l.isFunction(t))throw new TypeError("bindAction expects a function");if(t.length>1)throw new TypeError("Action handler in store "+this._storeName+" for "+(e[s.ACTION_KEY]||e).toString()+" was defined with two parameters. Only a single parameter is passed through the dispatcher, did you mean to pass in an Object instead?");var n=e[s.ACTION_KEY]?e[s.ACTION_KEY]:e;this[s.LISTENERS][n]=t.bind(this),this[s.ALL_LISTENERS].push(a.default.keyFor(n))},bindActions:function(e){var t=this;l.eachObject(function(e,n){var r=e.replace(/./,function(e){return"on"+e[0].toUpperCase()}),i=null;if(t[e]&&t[r])throw new ReferenceError("You have multiple action handlers bound to an action: "+e+" and "+r);t[e]?i=t[e]:t[r]&&(i=t[r]),i&&t.bindAction(n,i)},[e])},bindListeners:function(e){var t=this;l.eachObject(function(e,n){var r=t[e];if(!r)throw new ReferenceError(e+" defined but does not exist in "+t._storeName);Array.isArray(n)?n.forEach(function(e){t.bindAction(e,r)}):t.bindAction(n,r)},[e])}};n.default=c,t.exports=n.default},{"../../utils/functions":13,"../symbols/symbols":10,"es-symbol":1}],9:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=Function.prototype.bind,i=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;c=l=void 0,r=!1;var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(a)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,n=a,r=!0}};function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}n.createStoreConfig=function(e,t){t.config=u.assign({getState:function(e){return u.assign({},e)},setState:u.assign},e,t.config)},n.transformStore=function(e,t){return e.reduce(function(e,t){return t(e)},t)},n.createStoreFromObject=function(e,t,n){var r=void 0,i=f({},e,n,u.assign({getInstance:function(){return r},setState:function(e){d(this,r,e)}},t));return i.bindListeners&&p.default.bindListeners.call(i,i.bindListeners),i.lifecycle&&u.eachObject(function(e,t){p.default.on.call(i,e,t)},[i.lifecycle]),r=u.assign(new h.default(e,i,i.state,t),i.publicMethods,{displayName:n})},n.createStoreFromClass=function(e,t,n){for(var o=arguments.length,a=Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];var l=void 0,p=t.config,m=function(e){function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}(t,e),t}(t);f(m.prototype,e,n,{getInstance:function(){return l},setState:function(e){d(this,l,e)}});var v=new(r.apply(m,[null].concat(a)));return p.bindListeners&&v.bindListeners(p.bindListeners),p.datasource&&v.exportAsync(p.datasource),l=u.assign(new h.default(e,v,v[e.config.stateKey]||v[p.stateKey]||null,t),c.getInternalMethods(t),p.publicMethods,{displayName:n})};var s=a(e("eventemitter3")),l=o(e("../symbols/symbols")),c=o(e("../utils/AltUtils")),u=o(e("../../utils/functions")),h=a(e("./AltStore")),p=a(e("./StoreMixin"));function d(e,t,n){if(n){var r=t.StoreModel.config,i=u.isFunction(n)?n(t[l.STATE_CONTAINER]):n;t[l.STATE_CONTAINER]=r.setState.call(e,t[l.STATE_CONTAINER],i),e.alt.dispatcher.isDispatching()||e.emitChange()}}function f(e,t,n,r){return e[l.ALL_LISTENERS]=[],e[l.LIFECYCLE]=new s.default,e[l.LISTENERS]={},e[l.PUBLIC_METHODS]={},u.assign(e,p.default,{_storeName:n,alt:t,dispatcher:t.dispatcher},r)}},{"../../utils/functions":13,"../symbols/symbols":10,"../utils/AltUtils":11,"./AltStore":7,"./StoreMixin":8,eventemitter3:2}],10:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("es-symbol"),o=(r=i)&&r.__esModule?r:{default:r},a=(0,o.default)();n.ACTION_HANDLER=a;var s=(0,o.default)();n.ACTION_KEY=s;var l=(0,o.default)();n.ACTIONS_REGISTRY=l;var c=(0,o.default)();n.ACTION_UID=c;var u=(0,o.default)();n.ALL_LISTENERS=u;var h=(0,o.default)();n.HANDLING_ERRORS=h;var p=(0,o.default)();n.INIT_SNAPSHOT=p;var d=(0,o.default)();n.LAST_SNAPSHOT=d;var f=(0,o.default)();n.LIFECYCLE=f;var m=(0,o.default)();n.LISTENERS=m;var v=(0,o.default)();n.PUBLIC_METHODS=v;var g=(0,o.default)();n.STATE_CONTAINER=g},{"es-symbol":1}],11:[function(e,t,n){function r(){}Object.defineProperty(n,"__esModule",{value:!0}),n.getInternalMethods=function(e,t){var n=t?o:i,r=t?e.prototype:e;return Object.getOwnPropertyNames(r).reduce(function(e,t){return-1!==n.indexOf(t)?e:(e[t]=r[t],e)},{})},n.warn=function(e){"undefined"!=typeof console&&console.warn(new ReferenceError(e))},n.uid=function(e,t){for(var n=0,r=t;Object.hasOwnProperty.call(e,r);)r=t+String(++n);return r},n.formatAsConstant=function(e){return e.replace(/[a-z]([A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()}).toUpperCase()},n.dispatchIdentity=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.dispatch(n.length?[e].concat(n):e)};var i=Object.getOwnPropertyNames(r),o=Object.getOwnPropertyNames(r.prototype)},{}],12:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.setAppState=function(e,t,n){var r=e.deserialize(t);o.eachObject(function(t,a){var s,l,c=e.stores[t];c&&(s=c.StoreModel.config,l=c[i.STATE_CONTAINER],s.onDeserialize&&(r[t]=s.onDeserialize(a)||a),o.eachObject(function(e){return delete l[e]},[l]),o.assign(l,r[t]),n(c))},[r])},n.snapshot=function(e){var t=void 0===arguments[1]?[]:arguments[1];return(t.length?t:Object.keys(e.stores)).reduce(function(t,n){var r=n.displayName||n,o=e.stores[r],a=o.StoreModel.config;o[i.LIFECYCLE].emit("snapshot");var s=a.onSerialize&&a.onSerialize(o[i.STATE_CONTAINER]);return t[r]=s||o.getState(),t},{})},n.saveInitialSnapshot=function(e,t){var n=e.deserialize(e.serialize(e.stores[t][i.STATE_CONTAINER]));e[i.INIT_SNAPSHOT][t]=n,e[i.LAST_SNAPSHOT][t]=n},n.filterSnapshots=function(e,t,n){return n.reduce(function(e,n){var r=n.displayName||n;if(!t[r])throw new ReferenceError(r+" is not a valid store");return e[r]=t[r],e},{})};var i=r(e("../symbols/symbols")),o=r(e("../../utils/functions"))},{"../../utils/functions":13,"../symbols/symbols":10}],13:[function(e,t,n){function r(e,t){t.forEach(function(t){Object.keys(Object(t)).forEach(function(n){e(n,t[n])})})}Object.defineProperty(n,"__esModule",{value:!0}),n.eachObject=r,n.assign=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return r(function(t,n){return e[t]=n},n),e},n.isFunction=function(e){return"function"==typeof e}},{}],14:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=Function.prototype.bind,i=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;c=l=void 0,r=!1;var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(a)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,n=a,r=!0}},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l,c=e("flux"),u=a(e("./utils/StateFunctions")),h=a(e("./symbols/symbols")),p=a(e("../utils/functions")),d=a(e("./store")),f=a(e("./utils/AltUtils")),m=e("./actions"),v=(l=m)&&l.__esModule?l:{default:l},g=function(){function e(){var t=void 0===arguments[0]?{}:arguments[0];s(this,e),this.config=t,this.serialize=t.serialize||JSON.stringify,this.deserialize=t.deserialize||JSON.parse,this.dispatcher=t.dispatcher||new c.Dispatcher,this.actions={global:{}},this.stores={},this.storeTransforms=t.storeTransforms||[],this[h.ACTIONS_REGISTRY]={},this[h.INIT_SNAPSHOT]={},this[h.LAST_SNAPSHOT]={}}return o(e,[{key:"dispatch",value:function(e,t,n){this.dispatcher.dispatch({action:e,data:t,details:n})}},{key:"createUnsavedStore",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=e.displayName||"";d.createStoreConfig(this.config,e);var o=d.transformStore(this.storeTransforms,e);return p.isFunction(o)?d.createStoreFromClass.apply(d,[this,o,i].concat(n)):d.createStoreFromObject(this,o,i)}},{key:"createStore",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=t||e.displayName||e.name||"";d.createStoreConfig(this.config,e);var a=d.transformStore(this.storeTransforms,e);!this.stores[o]&&o||(this.stores[o]?f.warn("A store named "+o+" already exists, double check your store names or pass in your own custom identifier for each store"):f.warn("Store name was not specified"),o=f.uid(this.stores,o));var s=p.isFunction(a)?d.createStoreFromClass.apply(d,[this,a,o].concat(r)):d.createStoreFromObject(this,a,o);return this.stores[o]=s,u.saveInitialSnapshot(this,o),s}},{key:"generateActions",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.createActions(t.reduce(function(e,t){return e[t]=f.dispatchIdentity,e},{name:"global"}))}},{key:"createAction",value:function(e,t,n){return(0,v.default)(this,"global",e,t,n)}},{key:"createActions",value:function(e){for(var t=arguments.length,n=Array(t>2?t-2:0),a=2;a<t;a++)n[a-2]=arguments[a];var l=this,c=void 0===arguments[1]?{}:arguments[1],u={},d=f.uid(this[h.ACTIONS_REGISTRY],e.displayName||e.name||"Unknown");return p.isFunction(e)?function(){p.assign(u,f.getInternalMethods(e,!0));var t=function(t){function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s(this,n),i(Object.getPrototypeOf(n.prototype),"constructor",this).apply(this,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}(n,e),o(n,[{key:"generateActions",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){u[e]=f.dispatchIdentity})}}]),n}();p.assign(u,new(r.apply(t,[null].concat(n))))}():p.assign(u,e),this.actions[d]=this.actions[d]||{},p.eachObject(function(e,t){if(p.isFunction(t)){c[e]=(0,v.default)(l,d,e,t,c);var n=f.formatAsConstant(e);c[n]=c[e][h.ACTION_KEY]}},[u]),c}},{key:"takeSnapshot",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=u.snapshot(this,t);return p.assign(this[h.LAST_SNAPSHOT],r),this.serialize(r)}},{key:"rollback",value:function(){u.setAppState(this,this.serialize(this[h.LAST_SNAPSHOT]),function(e){e[h.LIFECYCLE].emit("rollback"),e.emitChange()})}},{key:"recycle",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.length?u.filterSnapshots(this,this[h.INIT_SNAPSHOT],t):this[h.INIT_SNAPSHOT];u.setAppState(this,this.serialize(r),function(e){e[h.LIFECYCLE].emit("init"),e.emitChange()})}},{key:"flush",value:function(){var e=this.serialize(u.snapshot(this));return this.recycle(),e}},{key:"bootstrap",value:function(e){u.setAppState(this,e,function(e){e[h.LIFECYCLE].emit("bootstrap"),e.emitChange()})}},{key:"prepare",value:function(e,t){var n={};if(!e.displayName)throw new ReferenceError("Store provided does not have a name");return n[e.displayName]=t,this.serialize(n)}},{key:"addActions",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];this.actions[e]=Array.isArray(t)?this.generateActions.apply(this,t):this.createActions.apply(this,[t].concat(r))}},{key:"addStore",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];this.createStore.apply(this,[t,e].concat(r))}},{key:"getActions",value:function(e){return this.actions[e]}},{key:"getStore",value:function(e){return this.stores[e]}}]),e}();n.default=g,t.exports=n.default},{"../utils/functions":13,"./actions":6,"./store":9,"./symbols/symbols":10,"./utils/AltUtils":11,"./utils/StateFunctions":12,flux:3}]},{},[14])(14)})));o.serialize=function(){return""},o.deserialize=function(){return""};var a=o.generateActions("containerMounted","containerResized","fatalError","featureCreated","fontsLoaded","forceHD","onBoundsFocused","onLocationFocused","overlayDisplayed","needsRender","pause","play","renderedFeatureDisplayed","renderedFeatureRegister","setFieldOfView","setHD","setSize"),s=o.generateActions("animateAlongFeature","doubleTapZoom","featureClicked","featureSelected","focusOnBounds","focusOnFeature","focusOnLocation","focusOnTarget","inputEnded","inputStarted","orbitTarget","panToPosition","rotateLeft","rotateRight","selectFeatures","setCamera","setCameraMode","setCameraPosition","setCameraTarget","setCurrentPlace","setEnvironment","setGeography","setSecondaryParams","setTerrainEffectContours","setTerrainEffectFlats","setTerrainEffectGrade","setTerrainEffectHeight","setTerrainEffectNone","startFlyover","toggleWidgets","zoomIn","zoomOut");const l={focusOnBounds:function(e){if(!(e.sw&&e.sw.longitude&&e.sw.latitude&&e.ne&&e.ne.longitude&&e.ne.latitude))return console.log("Invalid target passed"),console.log("Please use following format: { sw: { latitude: 44.5, longitude: 6.3 }, ne: { latitude: 44.4, longitude: 6.4 } }"),void console.log("{ longitude: 1.23, latitude: 4.56 }");var t={onComplete:a.onBoundsFocused};i.defaults(t,e),setTimeout(function(){s.focusOnBounds(t)},0)},focusOnLocation:function(e){if(!e.longitude||!e.latitude)return console.log("Invalid target passed"),console.log("Please use following format:"),void console.log("{ longitude: 1.23, latitude: 4.56 }");var t={onComplete:a.onLocationFocused};i.defaults(t,e),setTimeout(function(){s.focusOnLocation(t)},0)},orbitTarget:function(){setTimeout(function(){s.orbitTarget()},0)},setCameraMode:function(e){setTimeout(function(){s.setCameraMode(e)},0)}};var c=o.generateActions("configureCamera","configureElevationDatasource","configureImageryDatasource","setAppContainer","setCameraModeControlVisible","setCompassVisible","setDisplayErrors","setLayersControlVisible","setResourceUrl","setRotationControlVisible","setSeasonControlVisible","setUserLocationControlVisible","setZoomControlVisible");const u={configureControls:function(e){if(e){var t={},n=["minDistance","maxBounds","maxDistance","minPolarAngle","maxPolarAngle","noPan","noRotate","noZoom"];for(var r in n){var i=n[r];e.hasOwnProperty(i)&&(t[i]=e[i])}setTimeout(function(){c.configureCamera(t)},0)}else console.log("No configuration passed")}};var h=o.generateActions("addBuiltinOverlay","addOverlay","elevationBigProgress","elevationProgress","featuresProgress","imageryBigProgress","imageryProgress","removeOverlay","setElevation","setElevationBig","setFeatures","setHeightOffset","setHeightOffsetBig","setImagery","setImageryBig","setLiabilityUsed","setOSMUsed","setSRTMUsed","setTerrainMesh","updateHeightMap","updateOverlay");const p={};function d(){this.appContainer=null,this.bindListeners({onBoundsFocused:a.onBoundsFocused,onLocationFocused:a.onLocationFocused,fatalError:a.fatalError,signalUserInteraction:s.inputStarted,setElevation:h.setElevation,setElevationBig:h.setElevationBig})}p.init=function({container:e,datasource:t}){if(void 0===e||null===e)return void console.error("Error: tried to init Procedural API with invalid container");if(void 0===t||null===t)return void console.error("Error: tried to init Procedural API without datasource definition");const{elevation:n,imagery:r}=t;void 0!==n&&void 0!==n.apiKey?void 0!==r&&void 0!==r.urlFormat?(c.configureElevationDatasource(n),c.configureImageryDatasource(r),c.setAppContainer(e)):console.error("Error: imagery datasource configuration is invalid"):console.error("Error: elevation datasource configuration is invalid")},d.prototype.fatalError=function(e){"function"==typeof p.onLocationError&&p.onLocationError(e)},d.prototype.onBoundsFocused=function(){"function"==typeof p.onBoundsFocused&&p.onBoundsFocused()},d.prototype.onLocationFocused=function(){"function"==typeof p.onLocationFocused&&p.onLocationFocused()},d.prototype.setElevation=function(){},d.prototype.setElevationBig=function(){},p.setDisplayErrors=function(e){setTimeout(function(){c.setDisplayErrors(e)},0)},d.prototype.signalUserInteraction=function(){"function"==typeof p.onUserInteraction&&p.onUserInteraction()},d.displayName="CoreExport",o.createStore(d);var f={snap:function(e){return.05*Math.round(e/.05)},datafileForLocation:function(e,t){e=f.snap(e);var n=(t=f.snap(t))>0?"N":"S",r=e>0?"E":"W";e=Math.abs(e),t=Math.abs(t);var i=.05.toPrecision().split(".")[1];return i=i?i.length:0,e=e.toFixed(i),n+(t=t.toFixed(i))+r+e}},m={env:{turbidity:2.928118393234672,reileigh:.631430584918957,mieCoefficient:.006765327695560254,mieDirectionalG:.9020436927413672,luminance:.7892882311486963,inclination:.6376744186046512,azimuth:.881,sun:!1,fogDropoff:9e-6,fogIntensity:1.1,exposureBias:1.25,whitePoint:2.5,ambientColor:"#2d3034",diffuseColor:"#aeafa4",backscatterColor:"#181d20",ambientOcclusion:1.17}};const v={};v.datafileForLocation=function(e){if(!e||isNaN(e.latitude)||isNaN(e.longitude))return null;var t=f.snap(e.longitude),n=f.snap(e.latitude);return f.datafileForLocation(t,n)},v.displayLocation=function(e){e?isNaN(e.latitude)||isNaN(e.longitude)?a.fatalError("Invalid place data passed"):setTimeout(function(){s.setCurrentPlace(function(e){var t=m;return t.name=v.datafileForLocation(e),t.location=[e.longitude,e.latitude],e.features&&(t.features=e.features),t}(e))},0):a.fatalError("No place data passed")};const g={setEnvironment:function(e){setTimeout(function(){s.setEnvironment(e)},0)},environmentEditor:function(){null.initEnv()}};var y=[],x=function(){y.shift()()},b=function(e){"function"==typeof e?(y.push(e),setTimeout(x,0)):console.error("Tried to enqueue non-function")};let w;var S=w=(()=>{}),T={isLineString:function(e){return"LineString"===e.geometry.type},isPolygon:function(e){return"Polygon"===e.geometry.type},isMultiPolygon:function(e){return"MultiPolygon"===e.geometry.type},isPoint:function(e){return"Point"===e.geometry.type},tagValue:function(e,t){return e.properties.tags?e.properties.tags[t]:null},hasTag:function(e,t){return!!T.tagValue(e,t)},isPiste:function(e){return T.isLineString(e)&&T.hasTag(e,"piste:type")},isAerial:function(e){return T.isLineString(e)&&T.hasTag(e,"aerialway")},isHighway:function(e){return T.isLineString(e)&&T.hasTag(e,"highway")},isTrack:function(e){if(!T.isLineString(e))return!1;var t=T.tagValue(e,"highway");return"track"===t||"footway"===t||"path"===t||"cycleway"===t||"bridleway"===t},isRiver:function(e){return T.isLineString(e)&&T.hasTag(e,"waterway")},isBuilding:function(e){return T.isPolygon(e)&&T.hasTag(e,"building")},isForest:function(e){return(T.isPolygon(e)||T.isMultiPolygon(e))&&!T.isBuilding(e)},color:function(e){var t=!!e.properties.tags&&e.properties.tags["piste:difficulty"];return t?"advanced"===t||"expert"===t||"freeride"===t?"#030512":"intermediate"===t?"#ef2415":"easy"===t?"#1976d2":"novice"===t?"#4caf50":(S("Unknown piste difficulty",t),"#17afef"):T.isAerial(e)?"#0c0c0c":T.isTrack(e)?"rgba(46, 42, 22, 0.5)":T.isHighway(e)?"#222120":e.properties.color?e.properties.color:T.isRiver(e)?"stream"===e.properties.tags.waterway?5:100:void S("Unknown feature color",e)},thickness:function(e){if(e.properties.thickness)return e.properties.thickness;if(T.isPiste(e))return 2.7;if(T.isAerial(e))return 3;if(T.isTrack(e))return 3;if(T.isHighway(e)){var t=T.tagValue(e,"highway");return"motorway"===t?13:"trunk"===t?11:"primary"===t?10:"secondary"===t?8:5}return T.isRiver(e)?e.properties.tags.width?e.properties.tags.width:"stream"===e.properties.tags.waterway?2:3.7:2.5}};void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t});var _={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},M={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},E=0,A=1,R=2,C=0,O=1,P=2,L=0,z=1,F=2,I=3,D=4,k=5,U=100,N=101,B=102,j=103,G=104,H=200,V=201,W=202,q=203,Y=204,X=205,Z=206,J=207,K=208,Q=209,$=210,ee=0,te=1,ne=2,re=3,ie=4,oe=5,ae=6,se=7,le=0,ce=1,ue=306,he=1e3,pe=1001,de=1002,fe=1003,me=1004,ve=1005,ge=1006,ye=1007,xe=1008,be=1009,we=1010,Se=1011,Te=1012,_e=1013,Me=1014,Ee=1015,Ae=1016,Re=1017,Ce=1018,Oe=1019,Pe=1020,Le=1021,ze=1022,Fe=1023,Ie=1024,De=1025,ke=Fe,Ue=1026,Ne=1027,Be=1028,je=1029,Ge=1030,He=1031,Ve=1032,We=1033,qe=33776,Ye=33777,Xe=33778,Ze=33779,Je=35840,Ke=35841,Qe=35842,$e=35843,et=36196,tt=37492,nt=37496,rt=37808,it=37809,ot=37810,at=37811,st=37812,lt=37813,ct=37814,ut=37815,ht=37816,pt=37817,dt=37818,ft=37819,mt=37820,vt=37821,gt=37840,yt=37841,xt=37842,bt=37843,wt=37844,St=37845,Tt=37846,_t=37847,Mt=37848,Et=37849,At=37850,Rt=37851,Ct=37852,Ot=37853,Pt=3e3,Lt=3200,zt=0,Ft=1,It=7680,Dt=519,kt=35044;function Ut(){}Object.assign(Ut.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var Nt=[],Bt=0;Bt<256;Bt++)Nt[Bt]=(Bt<16?"0":"")+Bt.toString(16);var jt,Gt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Nt[255&e]+Nt[e>>8&255]+Nt[e>>16&255]+Nt[e>>24&255]+"-"+Nt[255&t]+Nt[t>>8&255]+"-"+Nt[t>>16&15|64]+Nt[t>>24&255]+"-"+Nt[63&n|128]+Nt[n>>8&255]+"-"+Nt[n>>16&255]+Nt[n>>24&255]+Nt[255&r]+Nt[r>>8&255]+Nt[r>>16&255]+Nt[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Gt.DEG2RAD},radToDeg:function(e){return e*Gt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((t+r)/2),u=a((t+r)/2),h=o((t-r)/2),p=a((t-r)/2),d=o((r-t)/2),f=a((r-t)/2);"XYX"===i?e.set(s*u,l*h,l*p,s*c):"YZY"===i?e.set(l*p,s*u,l*h,s*c):"ZXZ"===i?e.set(l*h,l*p,s*u,s*c):"XZX"===i?e.set(s*u,l*f,l*d,s*c):"YXY"===i?e.set(l*d,s*u,l*f,s*c):"ZYZ"===i?e.set(l*f,l*d,s*u,s*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Ht(e,t){this.x=e||0,this.y=t||0}function Vt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Ht.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ht.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}}),Object.assign(Vt.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},extractBasis:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],x=r[7],b=r[2],w=r[5],S=r[8];return i[0]=o*f+a*g+s*b,i[3]=o*m+a*y+s*w,i[6]=o*v+a*x+s*S,i[1]=l*f+c*g+u*b,i[4]=l*m+c*y+u*w,i[7]=l*v+c*x+u*S,i[2]=h*f+p*g+d*b,i[5]=h*m+p*y+d*w,i[8]=h*v+p*x+d*S,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*i*c+n*a*s+r*i*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],p=n[8],d=p*l-c*h,f=c*u-p*s,m=h*s-l*u,v=i*d+o*f+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=d*y,r[1]=(a*h-p*o)*y,r[2]=(c*o-a*l)*y,r[3]=f*y,r[4]=(p*i-a*u)*y,r[5]=(a*s-c*i)*y,r[6]=m*y,r[7]=(o*u-h*i)*y,r[8]=(l*i-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,o,a){var s=Math.cos(i),l=Math.sin(i);this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*l,r[6]=t*a+n*c,r[1]=-n*i+t*s,r[4]=-n*o+t*l,r[7]=-n*a+t*c,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Wt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===jt&&(jt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),jt.width=e.width,jt.height=e.height;var n=jt.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=jt}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},qt=0;function Yt(e,t,n,r,i,o,a,s,l,c){Object.defineProperty(this,"id",{value:qt++}),this.uuid=Gt.generateUUID(),this.name="",this.image=void 0!==e?e:Yt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Yt.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:pe,this.wrapT=void 0!==r?r:pe,this.magFilter=void 0!==i?i:ge,this.minFilter=void 0!==o?o:xe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Fe,this.internalFormat=null,this.type=void 0!==s?s:be,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Pt,this.version=0,this.onUpdate=null}function Xt(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function Zt(e,t,n){this.width=e,this.height=t,this.scissor=new Xt(0,0,e,t),this.scissorTest=!1,this.viewport=new Xt(0,0,e,t),n=n||{},this.texture=new Yt(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ge,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Jt(e,t,n){Zt.call(this,e,t,n),this.samples=4}function Kt(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Yt.DEFAULT_IMAGE=void 0,Yt.DEFAULT_MAPPING=300,Yt.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Yt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Gt.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)i.push(Wt.getDataURL(r[o]))}else i=Wt.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case pe:e.x=e.x<0?0:1;break;case de:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case pe:e.y=e.y<0?0:1;break;case de:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Yt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Xt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Xt.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,v=(u+1)/2,g=(f+1)/2,y=(s+c)/4,x=(l+p)/4,b=(h+d)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=x/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=b/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(g)),r=b/i),this.set(n,r,i,t),this}var w=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(d-h)/w,this.y=(l-p)/w,this.z=(c-s)/w,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Zt.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Zt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Jt.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Jt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Zt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Kt,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,o,a){var s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(u!==f||s!==h||l!==p||c!==d){var m=1-a,v=s*h+l*p+c*d+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,a=Math.sin(a*b)/x}var w=a*g;if(s=s*m+h*w,l=l*m+p*w,c=c*m+d*w,u=u*m+f*w,m===1-a){var S=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=S,l*=S,c*=S,u*=S}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Kt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Kt.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=s(n/2),p=s(r/2),d=s(i/2);return"XYZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"YXZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"ZXY"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"ZYX"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"YZX"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d):"XZY"===o&&(this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],l=n[9],c=n[2],u=n[6],h=n[10],p=r+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(a-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-c)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-i)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Gt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+r*l-i*s,this._y=r*c+o*s+i*a-n*l,this._z=i*c+o*l+n*s-r*a,this._w=o*c-n*a-r*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*h+this._w*p,this._x=n*h+this._x*p,this._y=r*h+this._y*p,this._z=i*h+this._z*p,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Qt=new en,$t=new Kt;function en(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(en.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion($t.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion($t.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*n,c=s*n+a*t-i*r,u=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return Qt.copy(this).projectOnVector(e),this.sub(Qt)},reflect:function(e){return this.sub(Qt.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Gt.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var tn=new en,nn=new cn,rn=new en(0,0,0),on=new en(1,1,1),an=new en,sn=new en,ln=new en;function cn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(cn.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,o,a,s,l,c,u,h,p,d,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new cn).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/tn.setFromMatrixColumn(e,0).length(),i=1/tn.setFromMatrixColumn(e,1).length(),o=1/tn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var x=o*s,b=o*l,w=a*s,S=a*l;t[0]=s*c,t[4]=S-x*u,t[8]=w*u+b,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=b*u+w,t[10]=x-S*u}else if("XZY"===e.order){x=o*s,b=o*l,w=a*s,S=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=x*u+S,t[5]=o*c,t[9]=b*u-w,t[2]=w*u-b,t[6]=a*c,t[10]=S*u+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(rn,e,on)},lookAt:function(e,t,n){var r=this.elements;return ln.subVectors(e,t),0===ln.lengthSq()&&(ln.z=1),ln.normalize(),an.crossVectors(n,ln),0===an.lengthSq()&&(1===Math.abs(n.z)?ln.x+=1e-4:ln.z+=1e-4,ln.normalize(),an.crossVectors(n,ln)),an.normalize(),sn.crossVectors(ln,an),r[0]=an.x,r[4]=sn.x,r[8]=ln.x,r[1]=an.y,r[5]=sn.y,r[9]=ln.y,r[2]=an.z,r[6]=sn.z,r[10]=ln.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],b=n[15],w=r[0],S=r[4],T=r[8],_=r[12],M=r[1],E=r[5],A=r[9],R=r[13],C=r[2],O=r[6],P=r[10],L=r[14],z=r[3],F=r[7],I=r[11],D=r[15];return i[0]=o*w+a*M+s*C+l*z,i[4]=o*S+a*E+s*O+l*F,i[8]=o*T+a*A+s*P+l*I,i[12]=o*_+a*R+s*L+l*D,i[1]=c*w+u*M+h*C+p*z,i[5]=c*S+u*E+h*O+p*F,i[9]=c*T+u*A+h*P+p*I,i[13]=c*_+u*R+h*L+p*D,i[2]=d*w+f*M+m*C+v*z,i[6]=d*S+f*E+m*O+v*F,i[10]=d*T+f*A+m*P+v*I,i[14]=d*_+f*R+m*L+v*D,i[3]=g*w+y*M+x*C+b*z,i[7]=g*S+y*E+x*O+b*F,i[11]=g*T+y*A+x*P+b*I,i[15]=g*_+y*R+x*L+b*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*p-n*s*p)+e[7]*(+t*s*p-t*l*h+i*o*h-r*o*p+r*l*c-i*s*c)+e[11]*(+t*l*u-t*a*p-i*o*u+n*o*p+i*a*c-n*l*c)+e[15]*(-r*a*c-t*s*u+t*a*h+r*o*u-n*o*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],x=r[15],b=d*y*h-g*f*h+g*u*m-c*y*m-d*u*x+c*f*x,w=v*f*h-p*y*h-v*u*m+l*y*m+p*u*x-l*f*x,S=p*g*h-v*d*h+v*c*m-l*g*m-p*c*x+l*d*x,T=v*d*u-p*g*u-v*c*f+l*g*f+p*c*y-l*d*y,_=i*b+o*w+a*S+s*T;if(0===_){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var E=1/_;return n[0]=b*E,n[1]=(g*f*s-d*y*s-g*a*m+o*y*m+d*a*x-o*f*x)*E,n[2]=(c*y*s-g*u*s+g*a*h-o*y*h-c*a*x+o*u*x)*E,n[3]=(d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m)*E,n[4]=w*E,n[5]=(p*y*s-v*f*s+v*a*m-i*y*m-p*a*x+i*f*x)*E,n[6]=(v*u*s-l*y*s-v*a*h+i*y*h+l*a*x-i*u*x)*E,n[7]=(l*f*s-p*u*s+p*a*h-i*f*h-l*a*m+i*u*m)*E,n[8]=S*E,n[9]=(v*d*s-p*g*s-v*o*m+i*g*m+p*o*x-i*d*x)*E,n[10]=(l*g*s-v*c*s+v*o*h-i*g*h-l*o*x+i*c*x)*E,n[11]=(p*c*s-l*d*s-p*o*h+i*d*h+l*o*m-i*c*m)*E,n[12]=T*E,n[13]=(p*g*a-v*d*a+v*o*f-i*g*f-p*o*y+i*d*y)*E,n[14]=(v*c*a-l*g*a-v*o*u+i*g*u+l*o*y-i*c*y)*E,n[15]=(l*d*a-p*c*a+p*o*u-i*d*u-l*o*f+i*c*f)*E,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,c=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+n,c*s-r*o,0,l*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,c=o+o,u=a+a,h=i*l,p=i*c,d=i*u,f=o*c,m=o*u,v=a*u,g=s*l,y=s*c,x=s*u,b=n.x,w=n.y,S=n.z;return r[0]=(1-(f+v))*b,r[1]=(p+x)*b,r[2]=(d-y)*b,r[3]=0,r[4]=(p-x)*w,r[5]=(1-(h+v))*w,r[6]=(m+g)*w,r[7]=0,r[8]=(d+y)*S,r[9]=(m-g)*S,r[10]=(1-(h+f))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=tn.set(r[0],r[1],r[2]).length(),o=tn.set(r[4],r[5],r[6]).length(),a=tn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],nn.copy(this);var s=1/i,l=1/o,c=1/a;return nn.elements[0]*=s,nn.elements[1]*=s,nn.elements[2]*=s,nn.elements[4]*=l,nn.elements[5]*=l,nn.elements[6]*=l,nn.elements[8]*=c,nn.elements[9]*=c,nn.elements[10]*=c,t.setFromRotationMatrix(nn),n.x=i,n.y=o,n.z=a,this},makePerspective:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,r,i,o){var a=this.elements,s=1/(t-e),l=1/(n-r),c=1/(o-i),u=(t+e)*s,h=(n+r)*l,p=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var un=new cn,hn=new Kt;function pn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||pn.DefaultOrder}function dn(){this.mask=1}pn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],pn.DefaultOrder="XYZ",Object.defineProperties(pn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(pn.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Gt.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],p=i[6],d=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return un.makeRotationFromQuaternion(e),this.setFromRotationMatrix(un,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return hn.setFromEuler(this),this.setFromQuaternion(hn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new en(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(dn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var fn=0,mn=new en,vn=new Kt,gn=new cn,yn=new en,xn=new en,bn=new en,wn=new Kt,Sn=new en(1,0,0),Tn=new en(0,1,0),_n=new en(0,0,1),Mn={type:"added"},En={type:"removed"};function An(){Object.defineProperty(this,"id",{value:fn++}),this.uuid=Gt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=An.DefaultUp.clone();var e=new en,t=new pn,n=new Kt,r=new en(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new cn},normalMatrix:{value:new Vt}}),this.matrix=new cn,this.matrixWorld=new cn,this.matrixAutoUpdate=An.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new dn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Rn(){An.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}An.DefaultUp=new en(0,1,0),An.DefaultMatrixAutoUpdate=!0,An.prototype=Object.assign(Object.create(Ut.prototype),{constructor:An,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return vn.setFromAxisAngle(e,t),this.quaternion.multiply(vn),this},rotateOnWorldAxis:function(e,t){return vn.setFromAxisAngle(e,t),this.quaternion.premultiply(vn),this},rotateX:function(e){return this.rotateOnAxis(Sn,e)},rotateY:function(e){return this.rotateOnAxis(Tn,e)},rotateZ:function(e){return this.rotateOnAxis(_n,e)},translateOnAxis:function(e,t){return mn.copy(e).applyQuaternion(this.quaternion),this.position.add(mn.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Sn,e)},translateY:function(e){return this.translateOnAxis(Tn,e)},translateZ:function(e){return this.translateOnAxis(_n,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(gn.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?yn.copy(e):yn.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),xn.setFromMatrixPosition(this.matrixWorld),this.isCamera?gn.lookAt(xn,yn,this.up):gn.lookAt(yn,xn,this.up),this.quaternion.setFromRotationMatrix(gn),r&&(gn.extractRotation(r.matrixWorld),vn.setFromRotationMatrix(gn),this.quaternion.premultiply(vn.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Mn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(En)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),gn.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),gn.multiply(e.parent.matrixWorld)),e.applyMatrix4(gn),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new en),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Kt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xn,e,bn),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new en),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xn,wn,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new en),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];i(e.shapes,c)}else i(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,l=this.material.length;s<l;s++)u.push(i(e.materials,this.material[s]));r.material=u}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),p=m(e.materials),d=m(e.textures),f=m(e.images);a=m(e.shapes);h.length>0&&(n.geometries=h),p.length>0&&(n.materials=p),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),a.length>0&&(n.shapes=a)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),Rn.prototype=Object.assign(Object.create(An.prototype),{constructor:Rn,isScene:!0,copy:function(e,t){return An.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Cn=[new en,new en,new en,new en,new en,new en,new en,new en],On=new en,Pn=new Gn,Ln=new en,zn=new en,Fn=new en,In=new en,Dn=new en,kn=new en,Un=new en,Nn=new en,Bn=new en,jn=new en;function Gn(e,t){this.min=void 0!==e?e:new en(1/0,1/0,1/0),this.max=void 0!==t?t:new en(-1/0,-1/0,-1/0)}function Hn(e,t,n,r,i){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){jn.fromArray(e,o);var s=i.x*Math.abs(jn.x)+i.y*Math.abs(jn.y)+i.z*Math.abs(jn.z),l=t.dot(jn),c=n.dot(jn),u=r.dot(jn);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}Object.assign(Gn.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=On.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new en),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new en),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Pn.copy(t.boundingBox),Pn.applyMatrix4(e.matrixWorld),this.union(Pn));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new en),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,On),On.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Un),Nn.subVectors(this.max,Un),Ln.subVectors(e.a,Un),zn.subVectors(e.b,Un),Fn.subVectors(e.c,Un),In.subVectors(zn,Ln),Dn.subVectors(Fn,zn),kn.subVectors(Ln,Fn);var t=[0,-In.z,In.y,0,-Dn.z,Dn.y,0,-kn.z,kn.y,In.z,0,-In.x,Dn.z,0,-Dn.x,kn.z,0,-kn.x,-In.y,In.x,0,-Dn.y,Dn.x,0,-kn.y,kn.x,0];return!!Hn(t,Ln,zn,Fn,Nn)&&(!!Hn(t=[1,0,0,0,1,0,0,0,1],Ln,zn,Fn,Nn)&&(Bn.crossVectors(In,Dn),Hn(t=[Bn.x,Bn.y,Bn.z],Ln,zn,Fn,Nn)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new en),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return On.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(On).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(Cn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Cn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Cn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Cn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Cn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Cn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Cn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Cn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Cn),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Vn=new Gn;function Wn(e,t){this.center=void 0!==e?e:new en,this.radius=void 0!==t?t:0}function qn(){}Object.assign(Wn.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):Vn.setFromPoints(e).getCenter(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new en),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Gn),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Yn=new en,Xn=new en,Zn=new Vt;function Jn(e,t){this.normal=void 0!==e?e:new en(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Jn.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var r=Yn.subVectors(n,t).cross(Xn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new en),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new en);var n=e.delta(Yn),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new en),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||Zn.getNormalMatrix(e),r=this.coplanarPoint(Yn).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Kn=new en,Qn=new en,$n=new en,er=new en,tr=new en,nr=new en,rr=new en,ir=new en,or=new en,ar=new en;function sr(e,t,n){this.a=void 0!==e?e:new en,this.b=void 0!==t?t:new en,this.c=void 0!==n?n:new en}Object.assign(sr,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new en),r.subVectors(n,t),Kn.subVectors(e,t),r.cross(Kn);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){Kn.subVectors(r,t),Qn.subVectors(n,t),$n.subVectors(e,t);var o=Kn.dot(Kn),a=Kn.dot(Qn),s=Kn.dot($n),l=Qn.dot(Qn),c=Qn.dot($n),u=o*l-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new en),0===u)return i.set(-2,-1,-1);var h=1/u,p=(l*s-a*c)*h,d=(o*c-a*s)*h;return i.set(1-p-d,d,p)},containsPoint:function(e,t,n,r){return sr.getBarycoord(e,t,n,r,er),er.x>=0&&er.y>=0&&er.x+er.y<=1},getUV:function(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,er),s.set(0,0),s.addScaledVector(i,er.x),s.addScaledVector(o,er.y),s.addScaledVector(a,er.z),s},isFrontFacing:function(e,t,n,r){return Kn.subVectors(n,t),Qn.subVectors(e,t),Kn.cross(Qn).dot(r)<0}}),Object.assign(sr.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Kn.subVectors(this.c,this.b),Qn.subVectors(this.a,this.b),.5*Kn.cross(Qn).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new en),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return sr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Jn),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return sr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return sr.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return sr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return sr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new en);var n,r,i=this.a,o=this.b,a=this.c;tr.subVectors(o,i),nr.subVectors(a,i),ir.subVectors(e,i);var s=tr.dot(ir),l=nr.dot(ir);if(s<=0&&l<=0)return t.copy(i);or.subVectors(e,o);var c=tr.dot(or),u=nr.dot(or);if(c>=0&&u<=c)return t.copy(o);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(i).addScaledVector(tr,n);ar.subVectors(e,a);var p=tr.dot(ar),d=nr.dot(ar);if(d>=0&&p<=d)return t.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return r=l/(l-d),t.copy(i).addScaledVector(nr,r);var m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return rr.subVectors(a,o),r=(u-c)/(u-c+(p-d)),t.copy(o).addScaledVector(rr,r);var v=1/(m+f+h);return n=f*v,r=h*v,t.copy(i).addScaledVector(tr,n).addScaledVector(nr,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var lr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cr={h:0,s:0,l:0},ur={h:0,s:0,l:0};function hr(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function pr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function dr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function fr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function mr(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new en,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new hr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(hr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Gt.euclideanModulo(e,1),t=Gt.clamp(t,0,1),n=Gt.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=pr(i,r,e+1/3),this.g=pr(i,r,e),this.b=pr(i,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=n[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=lr[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=dr(e.r),this.g=dr(e.g),this.b=dr(e.b),this},copyLinearToSRGB:function(e){return this.r=fr(e.r),this.g=fr(e.g),this.b=fr(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),l=(s+a)/2;if(s===a)t=0,n=0;else{var c=a-s;switch(n=l<=.5?c/(a+s):c/(2-a-s),a){case r:t=(i-o)/c+(i<o?6:0);break;case i:t=(o-r)/c+2;break;case o:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(cr),cr.h+=e,cr.s+=t,cr.l+=n,this.setHSL(cr.h,cr.s,cr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(cr),e.getHSL(ur);var n=Gt.lerp(cr.h,ur.h,t),r=Gt.lerp(cr.s,ur.s,t),i=Gt.lerp(cr.l,ur.l,t);return this.setHSL(n,r,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),hr.NAMES=lr,Object.assign(mr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var vr=0;function gr(){Object.defineProperty(this,"id",{value:vr++}),this.uuid=Gt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=z,this.side=C,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Y,this.blendDst=X,this.blendEquation=U,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=re,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Dt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=It,this.stencilZFail=It,this.stencilZPass=It,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function yr(){}gr.prototype=Object.assign(Object.create(Ut.prototype),{constructor:gr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==z&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==C&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(gr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var xr=new en;function br(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=kt,this.updateRange={offset:0,count:-1},this.version=0}function wr(e,t,n){br.call(this,new Int8Array(e),t,n)}function Sr(e,t,n){br.call(this,new Uint8Array(e),t,n)}function Tr(e,t,n){br.call(this,new Uint8ClampedArray(e),t,n)}function _r(e,t,n){br.call(this,new Int16Array(e),t,n)}function Mr(e,t,n){br.call(this,new Uint16Array(e),t,n)}function Er(e,t,n){br.call(this,new Int32Array(e),t,n)}function Ar(e,t,n){br.call(this,new Uint32Array(e),t,n)}function Rr(e,t,n){br.call(this,new Float32Array(e),t,n)}function Cr(e,t,n){br.call(this,new Float64Array(e),t,n)}function Or(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(br.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(br.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new hr),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Ht),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new en),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Xt),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)xr.x=this.getX(t),xr.y=this.getY(t),xr.z=this.getZ(t),xr.applyMatrix3(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)xr.x=this.getX(t),xr.y=this.getY(t),xr.z=this.getZ(t),xr.applyMatrix4(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)xr.x=this.getX(t),xr.y=this.getY(t),xr.z=this.getZ(t),xr.applyNormalMatrix(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)xr.x=this.getX(t),xr.y=this.getY(t),xr.z=this.getZ(t),xr.transformDirection(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),wr.prototype=Object.create(br.prototype),wr.prototype.constructor=wr,Sr.prototype=Object.create(br.prototype),Sr.prototype.constructor=Sr,Tr.prototype=Object.create(br.prototype),Tr.prototype.constructor=Tr,_r.prototype=Object.create(br.prototype),_r.prototype.constructor=_r,Mr.prototype=Object.create(br.prototype),Mr.prototype.constructor=Mr,Er.prototype=Object.create(br.prototype),Er.prototype.constructor=Er,Ar.prototype=Object.create(br.prototype),Ar.prototype.constructor=Ar,Rr.prototype=Object.create(br.prototype),Rr.prototype.constructor=Rr,Cr.prototype=Object.create(br.prototype),Cr.prototype.constructor=Cr;var Pr=1,Lr=new cn,zr=new An,Fr=new en,Ir=new Gn,Dr=new Gn,kr=new en;function Ur(){Object.defineProperty(this,"id",{value:Pr+=2}),this.uuid=Gt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ur.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Ur,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Or(e)>65535?Ar:Mr)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Vt).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Lr.makeRotationX(e),this.applyMatrix4(Lr),this},rotateY:function(e){return Lr.makeRotationY(e),this.applyMatrix4(Lr),this},rotateZ:function(e){return Lr.makeRotationZ(e),this.applyMatrix4(Lr),this},translate:function(e,t,n){return Lr.makeTranslation(e,t,n),this.applyMatrix4(Lr),this},scale:function(e,t,n){return Lr.makeScale(e,t,n),this.applyMatrix4(Lr),this},lookAt:function(e){return zr.lookAt(e),zr.updateMatrix(),this.applyMatrix4(zr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fr).negate(),this.translate(Fr.x,Fr.y,Fr.z),this},setFromObject:function(e){var t=e.geometry;return e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t),this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Rr(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new function(){}).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new br(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new br(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new br(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new br(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new br(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,!1){for(var s=[],l=(!1)[a],c=0,u=l.length;c<u;c++){var h=l[c],p=new Rr(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var d=new Rr(4*e.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Rr(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Gn);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Ir.setFromBufferAttribute(i),this.morphTargetsRelative?(kr.addVectors(this.boundingBox.min,Ir.min),this.boundingBox.expandByPoint(kr),kr.addVectors(this.boundingBox.max,Ir.max),this.boundingBox.expandByPoint(kr)):(this.boundingBox.expandByPoint(Ir.min),this.boundingBox.expandByPoint(Ir.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Wn);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(Ir.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];Dr.setFromBufferAttribute(o),this.morphTargetsRelative?(kr.addVectors(Ir.min,Dr.min),Ir.expandByPoint(kr),kr.addVectors(Ir.max,Dr.max),Ir.expandByPoint(kr)):(Ir.expandByPoint(Dr.min),Ir.expandByPoint(Dr.max))}Ir.getCenter(n);var a=0;for(r=0,i=e.count;r<i;r++)kr.fromBufferAttribute(e,r),a=Math.max(a,n.distanceToSquared(kr));if(t)for(r=0,i=t.length;r<i;r++){o=t[r];for(var s=this.morphTargetsRelative,l=0,c=o.count;l<c;l++)kr.fromBufferAttribute(o,l),s&&(Fr.fromBufferAttribute(e,l),kr.add(Fr)),a=Math.max(a,n.distanceToSquared(kr))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new br(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;var a,s,l,c=t.normal.array,u=new en,h=new en,p=new en,d=new en,f=new en;if(e){var m=e.array;for(i=0,o=e.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(n,a),h.fromArray(n,s),p.fromArray(n,l),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[a]+=d.x,c[a+1]+=d.y,c[a+2]+=d.z,c[s]+=d.x,c[s+1]+=d.y,c[s+2]+=d.z,c[l]+=d.x,c[l+1]+=d.y,c[l+2]+=d.z}else for(i=0,o=n.length;i<o;i+=9)u.fromArray(n,i),h.fromArray(n,i+3),p.fromArray(n,i+6),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[i]=d.x,c[i+1]=d.y,c[i+2]=d.z,c[i+3]=d.x,c[i+4]=d.y,c[i+5]=d.z,c[i+6]=d.x,c[i+7]=d.y,c[i+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,i.length-s),c=0,u=s;c<l;c++,u++)i[u]=a[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)kr.x=e.getX(t),kr.y=e.getY(t),kr.z=e.getZ(t),kr.normalize(),e.setXYZ(t,kr.x,kr.y,kr.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*r;for(var c=0;c<r;c++)i[a++]=n[o++]}return new br(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Ur,n=this.index.array,r=this.attributes;for(var i in r){var o=e(r[i],n);t.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],l=a[i],c=0,u=l.length;c<u;c++){o=e(l[c],n);s.push(o)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,p=(c=0,h.length);c<p;c++){var d=h[c];t.addGroup(d.start,d.count,d.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var o=(p=i[n]).toJSON();""!==p.name&&(o.name=p.name),e.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var l=this.morphAttributes[n],c=[],u=0,h=l.length;u<h;u++){var p;o=(p=l[u]).toJSON();""!==p.name&&(o.name=p.name),c.push(o)}c.length>0&&(a[n]=c,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(e.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new Ur).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(n=0,r=c.length;n<r;n++)l.push(c[n].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var u=e.groups;for(n=0,r=u.length;n<r;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Nr=new cn,Br=new qn,jr=new Wn,Gr=new en,Hr=new en,Vr=new en,Wr=new Ht,qr=new Ht,Yr=new Ht,Xr=new en,Zr=new en;function Jr(e,t){An.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ur,this.material=void 0!==t?t:new yr,this.updateMorphTargets()}function Kr(e,t,n,r,i,o,a,s){if(null===(t.side===O?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,t.side!==P,s)))return null;Zr.copy(s),Zr.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Zr);return l<n.near||l>n.far?null:{distance:l,point:Zr.clone(),object:e}}function Qr(e,t,n,r,i,o,a,s,l,c,u,h){Gr.fromBufferAttribute(i,c),Hr.fromBufferAttribute(i,u),Vr.fromBufferAttribute(i,h);e.morphTargetInfluences;var p=Kr(e,t,n,r,Gr,Hr,Vr,Xr);if(p){s&&(Wr.fromBufferAttribute(s,c),qr.fromBufferAttribute(s,u),Yr.fromBufferAttribute(s,h),p.uv=sr.getUV(Xr,Gr,Hr,Vr,Wr,qr,Yr,new Ht)),l&&(Wr.fromBufferAttribute(l,c),qr.fromBufferAttribute(l,u),Yr.fromBufferAttribute(l,h),p.uv2=sr.getUV(Xr,Gr,Hr,Vr,Wr,qr,Yr,new Ht));var d=new mr(c,u,h);sr.getNormal(Gr,Hr,Vr,d.normal),p.face=d}return p}Jr.prototype=Object.assign(Object.create(An.prototype),{constructor:Jr,isMesh:!0,copy:function(e){return An.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{(!1).length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),jr.copy(r.boundingSphere),jr.applyMatrix4(o),!1!==e.ray.intersectsSphere(jr)&&(Nr.getInverse(o),Br.copy(e.ray).applyMatrix4(Nr),null===r.boundingBox||!1!==Br.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a,s,l,c,u,h,p,d,f,m=r.index,v=r.attributes.position,g=r.morphAttributes.position,y=r.morphTargetsRelative,x=r.attributes.uv,b=r.attributes.uv2,w=r.groups,S=r.drawRange;if(null!==m)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(f=i[(d=w[c]).materialIndex],u=Math.max(d.start,S.start),p=Math.min(d.start+d.count,S.start+S.count);u<p;u+=3)a=m.getX(u),s=m.getX(u+1),l=m.getX(u+2),(n=Qr(this,f,e,Br,v,g,y,x,b,a,s,l))&&(n.faceIndex=Math.floor(u/3),n.face.materialIndex=d.materialIndex,t.push(n));else for(c=Math.max(0,S.start),h=Math.min(m.count,S.start+S.count);c<h;c+=3)a=m.getX(c),s=m.getX(c+1),l=m.getX(c+2),(n=Qr(this,i,e,Br,v,g,y,x,b,a,s,l))&&(n.faceIndex=Math.floor(c/3),t.push(n));else if(void 0!==v)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(f=i[(d=w[c]).materialIndex],u=Math.max(d.start,S.start),p=Math.min(d.start+d.count,S.start+S.count);u<p;u+=3)(n=Qr(this,f,e,Br,v,g,y,x,b,a=u,s=u+1,l=u+2))&&(n.faceIndex=Math.floor(u/3),n.face.materialIndex=d.materialIndex,t.push(n));else for(c=Math.max(0,S.start),h=Math.min(v.count,S.start+S.count);c<h;c+=3)(n=Qr(this,i,e,Br,v,g,y,x,b,a=c,s=c+1,l=c+2))&&(n.faceIndex=Math.floor(c/3),t.push(n))}else if(r.isGeometry){var T,_,M,E,A=Array.isArray(i),R=r.vertices,C=r.faces,O=r.faceVertexUvs[0];O.length>0&&(E=O);for(var P=0,L=C.length;P<L;P++){var z=C[P],F=A?i[z.materialIndex]:i;if(void 0!==F&&(T=R[z.a],_=R[z.b],M=R[z.c],n=Kr(this,F,e,Br,T,_,M,Xr))){if(E&&E[P]){var I=E[P];Wr.copy(I[0]),qr.copy(I[1]),Yr.copy(I[2]),n.uv=sr.getUV(Xr,T,_,M,Wr,qr,Yr,new Ht)}n.face=z,n.faceIndex=P,t.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var $r=0,ei=new cn,ti=new An,ni=new en;function ri(){Object.defineProperty(this,"id",{value:$r+=2}),this.uuid=Gt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}ri.prototype=Object.assign(Object.create(Ut.prototype),{constructor:ri,isGeometry:!0,applyMatrix4:function(e){for(var t=(new Vt).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return ei.makeRotationX(e),this.applyMatrix4(ei),this},rotateY:function(e){return ei.makeRotationY(e),this.applyMatrix4(ei),this},rotateZ:function(e){return ei.makeRotationZ(e),this.applyMatrix4(ei),this},translate:function(e,t,n){return ei.makeTranslation(e,t,n),this.applyMatrix4(ei),this},scale:function(e,t,n){return ei.makeScale(e,t,n),this.applyMatrix4(ei),this},lookAt:function(e){return ti.lookAt(e),ti.updateMatrix(),this.applyMatrix4(ti.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)t.vertices.push((new en).fromArray(i,c)),void 0!==a&&t.colors.push((new hr).fromArray(a,c));function u(e,n,r,i){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],u=new mr(e,n,r,void 0===o?[]:[(new en).fromArray(o,3*e),(new en).fromArray(o,3*n),(new en).fromArray(o,3*r)],c,i);t.faces.push(u),void 0!==s&&t.faceVertexUvs[0].push([(new Ht).fromArray(s,2*e),(new Ht).fromArray(s,2*n),(new Ht).fromArray(s,2*r)]),void 0!==l&&t.faceVertexUvs[1].push([(new Ht).fromArray(l,2*e),(new Ht).fromArray(l,2*n),(new Ht).fromArray(l,2*r)])}var h=e.groups;if(h.length>0)for(c=0;c<h.length;c++)for(var p=h[c],d=p.start,f=d,m=d+p.count;f<m;f+=3)void 0!==n?u(n[f],n[f+1],n[f+2],p.materialIndex):u(f,f+1,f+2,p.materialIndex);else if(void 0!==n)for(c=0;c<n.length;c+=3)u(n[c],n[c+1],n[c+2]);else for(c=0;c<i.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ni).negate(),this.translate(ni.x,ni.y,ni.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new cn;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new en,t=new en,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new en;if(e){var s,l,c,u=new en,h=new en;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var p=(o=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new ri;for(o.faces=this.faces,e=0,t=(!1).length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new en,c={a:new en,b:new en,c:new en},a.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=(!1)[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Gn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Wn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.colors,u=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new Vt).getNormalMatrix(t));for(var h=0,p=a.length;h<p;h++){var d=a[h].clone();void 0!==t&&d.applyMatrix4(t),o.push(d)}for(h=0,p=u.length;h<p;h++)c.push(u[h].clone());for(h=0,p=l.length;h<p;h++){var f,m,v,g=l[h],y=g.vertexNormals,x=g.vertexColors;(f=new mr(g.a+i,g.b+i,g.c+i)).normal.copy(g.normal),void 0!==r&&f.normal.applyMatrix3(r).normalize();for(var b=0,w=y.length;b<w;b++)m=y[b].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),f.vertexNormals.push(m);f.color.copy(g.color);for(b=0,w=x.length;b<w;b++)v=x[b],f.vertexColors.push(v.clone());f.materialIndex=g.materialIndex+n,s.push(f)}for(h=0,p=e.faceVertexUvs.length;h<p;h++){var S=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(b=0,w=S.length;b<w;b++){for(var T=S[b],_=[],M=0,E=T.length;M<E;M++)_.push(T[M].clone());this.faceVertexUvs[h].push(_)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):u[n]=u[l[t]];var p=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(n);break}}for(n=p.length-1;n>=0;n--){var f=p[n];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new en(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],p={};for(i=0;i<this.faces.length;i++){var d=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=d.normal.length()>0,v=d.vertexNormals.length>0,g=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,x=0;if(x=T(x=T(x=T(x=T(x=T(x=T(x=T(x=T(x,0,0),1,!0),2,!1),3,f),4,m),5,v),6,g),7,y),a.push(x),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var b=this.faceVertexUvs[0][i];a.push(E(b[0]),E(b[1]),E(b[2]))}if(m&&a.push(_(d.normal)),v){var w=d.vertexNormals;a.push(_(w[0]),_(w[1]),_(w[2]))}if(g&&a.push(M(d.color)),y){var S=d.vertexColors;a.push(M(S[0]),M(S[1]),M(S[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function E(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/2,h.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new ri).copy(this)},copy:function(e){var t,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=u.length;r<i;r++){var h=u[r],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}for(t=0,n=(!1).length;t<n;t++){var f={};if(f.name=(!1)[t].name,void 0!==(!1)[t].vertices)for(f.vertices=[],r=0,i=(!1)[t].vertices.length;r<i;r++)f.vertices.push((!1)[t].vertices[r].clone());if(void 0!==(!1)[t].normals)for(f.normals=[],r=0,i=(!1)[t].normals.length;r<i;r++)f.normals.push((!1)[t].normals[r].clone());(!1).push(f)}var m=e.morphNormals;for(t=0,n=m.length;t<n;t++){var v={};if(void 0!==m[t].vertexNormals)for(v.vertexNormals=[],r=0,i=m[t].vertexNormals.length;r<i;r++){var g=m[t].vertexNormals[r],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[t].faceNormals)for(v.faceNormals=[],r=0,i=m[t].faceNormals.length;r<i;r++)v.faceNormals.push(m[t].faceNormals[r].clone());this.morphNormals.push(v)}var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());var b=e.skinIndices;for(t=0,n=b.length;t<n;t++)this.skinIndices.push(b[t].clone());var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class ii extends ri{constructor(e,t,n,r,i,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new oi(e,t,n,r,i,o)),this.mergeVertices()}}class oi extends Ur{constructor(e,t,n,r,i,o){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var a=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1;var s=[],l=[],c=[],u=[],h=0,p=0;function d(e,t,n,r,i,o,d,f,m,v,g){var y,x,b=o/m,w=d/v,S=o/2,T=d/2,_=f/2,M=m+1,E=v+1,A=0,R=0,C=new en;for(x=0;x<E;x++){var O=x*w-T;for(y=0;y<M;y++){var P=y*b-S;C[e]=P*r,C[t]=O*i,C[n]=_,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(y/m),u.push(1-x/v),A+=1}}for(x=0;x<v;x++)for(y=0;y<m;y++){var L=h+y+M*x,z=h+y+M*(x+1),F=h+(y+1)+M*(x+1),I=h+(y+1)+M*x;s.push(L,z,I),s.push(z,F,I),R+=6}a.addGroup(p,R,g),p+=R,h+=A}d("z","y","x",-1,-1,n,t,e,o=Math.floor(o)||1,i,0),d("z","y","x",1,-1,n,t,-e,o,i,1),d("x","z","y",1,1,e,n,t,r,o,2),d("x","z","y",1,-1,e,n,-t,r,o,3),d("x","y","z",1,-1,e,t,n,r,i,4),d("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new Rr(l,3)),this.setAttribute("normal",new Rr(c,3)),this.setAttribute("uv",new Rr(u,2))}}function ai(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function si(e){for(var t={},n=0;n<e.length;n++){var r=ai(e[n]);for(var i in r)t[i]=r[i]}return t}var li={clone:ai,merge:si},ci="",ui="";function hi(e){gr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=ci,this.fragmentShader=ui,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function pi(){An.call(this),this.type="Camera",this.matrixWorldInverse=new cn,this.projectionMatrix=new cn,this.projectionMatrixInverse=new cn}function di(e,t,n,r){pi.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}hi.prototype=Object.create(gr.prototype),hi.prototype.constructor=hi,hi.prototype.isShaderMaterial=!0,hi.prototype.copy=function(e){return gr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ai(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},hi.prototype.toJSON=function(e){var t=gr.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},pi.prototype=Object.assign(Object.create(An.prototype),{constructor:pi,isCamera:!0,copy:function(e,t){return An.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new en),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){An.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){An.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),di.prototype=Object.assign(Object.create(pi.prototype),{constructor:di,isPerspectiveCamera:!0,copy:function(e,t){return pi.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Gt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Gt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Gt.RAD2DEG*Math.atan(Math.tan(.5*Gt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Gt.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var fi=90,mi=1;function vi(e,t,n,r){An.call(this),this.type="CubeCamera";var i=new di(fi,mi,e,t);i.up.set(0,-1,0),i.lookAt(new en(1,0,0)),this.add(i);var o=new di(fi,mi,e,t);o.up.set(0,-1,0),o.lookAt(new en(-1,0,0)),this.add(o);var a=new di(fi,mi,e,t);a.up.set(0,0,1),a.lookAt(new en(0,1,0)),this.add(a);var s=new di(fi,mi,e,t);s.up.set(0,0,-1),s.lookAt(new en(0,-1,0)),this.add(s);var l=new di(fi,mi,e,t);l.up.set(0,-1,0),l.lookAt(new en(0,0,1)),this.add(l);var c=new di(fi,mi,e,t);c.up.set(0,-1,0),c.lookAt(new en(0,0,-1)),this.add(c),r=r||{format:ze,magFilter:ge,minFilter:ge},this.renderTarget=new gi(n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=u,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,n,r);e.setRenderTarget(i)}}function gi(){}function yi(e,t,n,r,i,o,a,s,l,c,u,h){Yt.call(this,null,o,a,s,l,c,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:fe,this.minFilter=void 0!==c?c:fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}vi.prototype=Object.create(An.prototype),vi.prototype.constructor=vi,yi.prototype=Object.create(Yt.prototype),yi.prototype.constructor=yi,yi.prototype.isDataTexture=!0;var xi=new Wn,bi=new en;function wi(e,t,n,r,i,o){this.planes=[void 0!==e?e:new Jn,void 0!==t?t:new Jn,void 0!==n?n:new Jn,void 0!==r?r:new Jn,void 0!==i?i:new Jn,void 0!==o?o:new Jn]}Object.assign(wi.prototype,{set:function(e,t,n,r,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(a-r,u-s,f-h,y-m).normalize(),t[1].setComponents(a+r,u+s,f+h,y+m).normalize(),t[2].setComponents(a+i,u+l,f+p,y+v).normalize(),t[3].setComponents(a-i,u-l,f-p,y-v).normalize(),t[4].setComponents(a-o,u-c,f-d,y-g).normalize(),t[5].setComponents(a+o,u+c,f+d,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),xi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(xi)},intersectsSprite:function(e){return xi.center.set(0,0,0),xi.radius=.7071067811865476,xi.applyMatrix4(e.matrixWorld),this.intersectsSphere(xi)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(bi.x=r.normal.x>0?e.max.x:e.min.x,bi.y=r.normal.y>0?e.max.y:e.min.y,bi.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(bi)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var Si={common:{diffuse:{value:new hr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vt},uv2Transform:{value:new Vt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ht(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new hr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new hr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Vt}},sprite:{diffuse:{value:new hr(15658734)},opacity:{value:1},center:{value:new Ht(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Vt}}};function Ti(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,n){var r=t.array,i=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){var o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,i),o.version=t.version)}}}function _i(e,t,n,r){Ur.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,c=Math.floor(r)||1,u=l+1,h=c+1,p=e/l,d=t/c,f=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*d-s;for(i=0;i<u;i++){var x=i*p-a;m.push(x,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/c)}}for(o=0;o<c;o++)for(i=0;i<l;i++){var b=i+u*o,w=i+u*(o+1),S=i+1+u*(o+1),T=i+1+u*o;f.push(b,w,T),f.push(w,S,T)}this.setIndex(f),this.setAttribute("position",new Rr(m,3)),this.setAttribute("normal",new Rr(v,3)),this.setAttribute("uv",new Rr(g,2))}_i.prototype=Object.create(Ur.prototype),_i.prototype.constructor=_i;var Mi={alphamap_fragment:"",alphamap_pars_fragment:"",alphatest_fragment:"",aomap_fragment:"",aomap_pars_fragment:"",begin_vertex:"",beginnormal_vertex:"",bsdfs:"",bumpmap_pars_fragment:"",clipping_planes_fragment:"",clipping_planes_pars_fragment:"",clipping_planes_pars_vertex:"",clipping_planes_vertex:"",color_fragment:"",color_pars_fragment:"",color_pars_vertex:"",color_vertex:"",common:"",cube_uv_reflection_fragment:"",defaultnormal_vertex:"",displacementmap_pars_vertex:"",displacementmap_vertex:"",emissivemap_fragment:"",emissivemap_pars_fragment:"",encodings_fragment:"",encodings_pars_fragment:"",envmap_fragment:"",envmap_common_pars_fragment:"",envmap_pars_fragment:"",envmap_pars_vertex:"",envmap_physical_pars_fragment:"",envmap_vertex:"",fog_vertex:"",fog_pars_vertex:"",fog_fragment:"",fog_pars_fragment:"",gradientmap_pars_fragment:"",lightmap_fragment:"",lightmap_pars_fragment:"",lights_lambert_vertex:"",lights_pars_begin:"",lights_toon_fragment:"",lights_toon_pars_fragment:"",lights_phong_fragment:"",lights_phong_pars_fragment:"",lights_physical_fragment:"",lights_physical_pars_fragment:"",lights_fragment_begin:"",lights_fragment_maps:"",lights_fragment_end:"",logdepthbuf_fragment:"",logdepthbuf_pars_fragment:"",logdepthbuf_pars_vertex:"",logdepthbuf_vertex:"",map_fragment:"",map_pars_fragment:"",map_particle_fragment:"",map_particle_pars_fragment:"",metalnessmap_fragment:"",metalnessmap_pars_fragment:"",morphnormal_vertex:"",morphtarget_pars_vertex:"",morphtarget_vertex:"",normal_fragment_begin:"",normal_fragment_maps:"",normalmap_pars_fragment:"",clearcoat_normal_fragment_begin:"",clearcoat_normal_fragment_maps:"",clearcoat_normalmap_pars_fragment:"",packing:"",premultiplied_alpha_fragment:"",project_vertex:"",dithering_fragment:"",dithering_pars_fragment:"",roughnessmap_fragment:"",roughnessmap_pars_fragment:"",shadowmap_pars_fragment:"",shadowmap_pars_vertex:"",shadowmap_vertex:"",shadowmask_pars_fragment:"",skinbase_vertex:"",skinning_pars_vertex:"",skinning_vertex:"",skinnormal_vertex:"",specularmap_fragment:"",specularmap_pars_fragment:"",tonemapping_fragment:"",tonemapping_pars_fragment:"",uv_pars_fragment:"",uv_pars_vertex:"",uv_vertex:"",uv2_pars_fragment:"",uv2_pars_vertex:"",uv2_vertex:"",worldpos_vertex:"",background_frag:"",background_vert:"",cube_frag:"",cube_vert:"",depth_frag:"",depth_vert:"",distanceRGBA_frag:"",distanceRGBA_vert:"",equirect_frag:"",equirect_vert:"",linedashed_frag:"",linedashed_vert:"",meshbasic_frag:"",meshbasic_vert:"",meshlambert_frag:"",meshlambert_vert:"",meshmatcap_frag:"",meshmatcap_vert:"",meshtoon_frag:"",meshtoon_vert:"",meshphong_frag:"",meshphong_vert:"",meshphysical_frag:"",meshphysical_vert:"",normal_frag:"",normal_vert:"",points_frag:"",points_vert:"",shadow_frag:"",shadow_vert:"",sprite_frag:"",sprite_vert:""},Ei={basic:{uniforms:si([Si.common,Si.specularmap,Si.envmap,Si.aomap,Si.lightmap,Si.fog]),vertexShader:Mi.meshbasic_vert,fragmentShader:Mi.meshbasic_frag},lambert:{uniforms:si([Si.common,Si.specularmap,Si.envmap,Si.aomap,Si.lightmap,Si.emissivemap,Si.fog,Si.lights,{emissive:{value:new hr(0)}}]),vertexShader:Mi.meshlambert_vert,fragmentShader:Mi.meshlambert_frag},phong:{uniforms:si([Si.common,Si.specularmap,Si.envmap,Si.aomap,Si.lightmap,Si.emissivemap,Si.bumpmap,Si.normalmap,Si.displacementmap,Si.fog,Si.lights,{emissive:{value:new hr(0)},specular:{value:new hr(1118481)},shininess:{value:30}}]),vertexShader:Mi.meshphong_vert,fragmentShader:Mi.meshphong_frag},standard:{uniforms:si([Si.common,Si.envmap,Si.aomap,Si.lightmap,Si.emissivemap,Si.bumpmap,Si.normalmap,Si.displacementmap,Si.roughnessmap,Si.metalnessmap,Si.fog,Si.lights,{emissive:{value:new hr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Mi.meshphysical_vert,fragmentShader:Mi.meshphysical_frag},toon:{uniforms:si([Si.common,Si.specularmap,Si.aomap,Si.lightmap,Si.emissivemap,Si.bumpmap,Si.normalmap,Si.displacementmap,Si.gradientmap,Si.fog,Si.lights,{emissive:{value:new hr(0)},specular:{value:new hr(1118481)},shininess:{value:30}}]),vertexShader:Mi.meshtoon_vert,fragmentShader:Mi.meshtoon_frag},matcap:{uniforms:si([Si.common,Si.bumpmap,Si.normalmap,Si.displacementmap,Si.fog,{matcap:{value:null}}]),vertexShader:Mi.meshmatcap_vert,fragmentShader:Mi.meshmatcap_frag},points:{uniforms:si([Si.points,Si.fog]),vertexShader:Mi.points_vert,fragmentShader:Mi.points_frag},dashed:{uniforms:si([Si.common,Si.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mi.linedashed_vert,fragmentShader:Mi.linedashed_frag},depth:{uniforms:si([Si.common,Si.displacementmap]),vertexShader:Mi.depth_vert,fragmentShader:Mi.depth_frag},normal:{uniforms:si([Si.common,Si.bumpmap,Si.normalmap,Si.displacementmap,{opacity:{value:1}}]),vertexShader:Mi.normal_vert,fragmentShader:Mi.normal_frag},sprite:{uniforms:si([Si.sprite,Si.fog]),vertexShader:Mi.sprite_vert,fragmentShader:Mi.sprite_frag},background:{uniforms:{uvTransform:{value:new Vt},t2D:{value:null}},vertexShader:Mi.background_vert,fragmentShader:Mi.background_frag},cube:{uniforms:si([Si.envmap,{opacity:{value:1}}]),vertexShader:Mi.cube_vert,fragmentShader:Mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mi.equirect_vert,fragmentShader:Mi.equirect_frag},distanceRGBA:{uniforms:si([Si.common,Si.displacementmap,{referencePosition:{value:new en},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mi.distanceRGBA_vert,fragmentShader:Mi.distanceRGBA_frag},shadow:{uniforms:si([Si.lights,Si.fog,{color:{value:new hr(0)},opacity:{value:1}}]),vertexShader:Mi.shadow_vert,fragmentShader:Mi.shadow_frag}};function Ai(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ri(){}function Ci(){}function Oi(){}Object.defineProperty(Ri.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Pi=new Yt,Li=new Ci,zi=new Oi,Fi=new Ri,Ii=[],Di=[],ki=new Float32Array(16),Ui=new Float32Array(9),Ni=new Float32Array(4);function Bi(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=Ii[i];if(void 0===o&&(o=new Float32Array(i),Ii[i]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function ji(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Gi(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Hi(e,t){var n=Di[t];void 0===n&&(n=new Int32Array(t),Di[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Vi(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Wi(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ji(n,t))return;e.uniform2fv(this.addr,t),Gi(n,t)}}function qi(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ji(n,t))return;e.uniform3fv(this.addr,t),Gi(n,t)}}function Yi(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ji(n,t))return;e.uniform4fv(this.addr,t),Gi(n,t)}}function Xi(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(ji(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Gi(n,t)}else{if(ji(n,r))return;Ni.set(r),e.uniformMatrix2fv(this.addr,!1,Ni),Gi(n,r)}}function Zi(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(ji(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Gi(n,t)}else{if(ji(n,r))return;Ui.set(r),e.uniformMatrix3fv(this.addr,!1,Ui),Gi(n,r)}}function Ji(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(ji(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Gi(n,t)}else{if(ji(n,r))return;ki.set(r),e.uniformMatrix4fv(this.addr,!1,ki),Gi(n,r)}}function Ki(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Pi,i)}function Qi(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Li,i)}function $i(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||zi,i)}function eo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Fi,i)}function to(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function no(e,t){var n=this.cache;ji(n,t)||(e.uniform2iv(this.addr,t),Gi(n,t))}function ro(e,t){var n=this.cache;ji(n,t)||(e.uniform3iv(this.addr,t),Gi(n,t))}function io(e,t){var n=this.cache;ji(n,t)||(e.uniform4iv(this.addr,t),Gi(n,t))}function oo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ao(e,t){e.uniform1fv(this.addr,t)}function so(e,t){e.uniform1iv(this.addr,t)}function lo(e,t){e.uniform2iv(this.addr,t)}function co(e,t){e.uniform3iv(this.addr,t)}function uo(e,t){e.uniform4iv(this.addr,t)}function ho(e,t){var n=Bi(t,this.size,2);e.uniform2fv(this.addr,n)}function po(e,t){var n=Bi(t,this.size,3);e.uniform3fv(this.addr,n)}function fo(e,t){var n=Bi(t,this.size,4);e.uniform4fv(this.addr,n)}function mo(e,t){var n=Bi(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function vo(e,t){var n=Bi(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function go(e,t){var n=Bi(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function yo(e,t,n){var r=t.length,i=Hi(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(t[o]||Pi,i[o])}function xo(e,t,n){var r=t.length,i=Hi(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(t[o]||Fi,i[o])}function bo(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Vi;case 35664:return Wi;case 35665:return qi;case 35666:return Yi;case 35674:return Xi;case 35675:return Zi;case 35676:return Ji;case 5124:case 35670:return to;case 35667:case 35671:return no;case 35668:case 35672:return ro;case 35669:case 35673:return io;case 5125:return oo;case 35678:case 36198:case 36298:case 36306:case 35682:return Ki;case 35679:case 36299:case 36307:return $i;case 35680:case 36300:case 36308:case 36293:return eo;case 36289:case 36303:case 36311:case 36292:return Qi}}(t.type)}function wo(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ao;case 35664:return ho;case 35665:return po;case 35666:return fo;case 35674:return mo;case 35675:return vo;case 35676:return go;case 5124:case 35670:return so;case 35667:case 35671:return lo;case 35668:case 35672:return co;case 35669:case 35673:return uo;case 35678:case 36198:case 36298:case 36306:case 35682:return yo;case 35680:case 36300:case 36308:case 36293:return xo}}(t.type)}function So(e){this.id=e,this.seq=[],this.map={}}wo.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Gi(t,e)},So.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(e,t[a.id],n)}};var To=/([\w\d_]+)(\])?(\[|\.)?/g;function _o(e,t){e.seq.push(t),e.map[t.id]=t}function Mo(e,t,n){var r=e.name,i=r.length;for(To.lastIndex=0;;){var o=To.exec(r),a=To.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===i){_o(n,void 0===c?new bo(s,e,t):new wo(s,e,t));break}var u=n.map[s];void 0===u&&_o(n,u=new So(s)),n=u}}function Eo(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);Mo(i,e.getUniformLocation(t,i.name),this)}}function Ao(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Eo.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Eo.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},Eo.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},Eo.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var Ro=0;function Co(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Oo(e){return""!==e}function Po(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Lo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var zo=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fo(e){return e.replace(zo,Io)}function Io(e,t){var n=Mi[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Fo(n)}var Do=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function ko(e){return e.replace(Do,Uo)}function Uo(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function No(e,t,n){var r,i,o=e.getContext(),a=n.defines,s=n.vertexShader,l=n.fragmentShader,c=(e.gammaFactor>0&&e.gammaFactor,n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",e.extensionShaderTextureLOD&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Oo).join("\n")}(n)),u=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),h=o.createProgram();(r=[u].filter(Oo).join("\n")).length>0&&(r+="\n"),(i=[c,u].filter(Oo).join("\n")).length>0&&(i+="\n"),s=Lo(s=Po(s=Fo(s),n),n),l=Lo(l=Po(l=Fo(l),n),n),s=ko(s),l=ko(l),n.isWebGL2;var p,d,f=i+l,m=Ao(o,35633,r+s),v=Ao(o,35632,f);if(o.attachShader(h,m),o.attachShader(h,v),void 0!==n.index0AttributeName&&o.bindAttribLocation(h,0,n.index0AttributeName),o.linkProgram(h),e.debug.checkShaderErrors){var g=o.getProgramInfoLog(h).trim(),y=o.getShaderInfoLog(m).trim(),x=o.getShaderInfoLog(v).trim(),b=!0,w=!0;if(!1===o.getProgramParameter(h,35714)){b=!1;var S=Co(o,m,"vertex"),T=Co(o,v,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(h,35715),"gl.getProgramInfoLog",g,S,T)}else""!==g?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",g):""!==y&&""!==x||(w=!1);w&&(this.diagnostics={runnable:b,programLog:g,vertexShader:{log:y,prefix:r},fragmentShader:{log:x,prefix:i}})}return o.detachShader(h,m),o.detachShader(h,v),o.deleteShader(m),o.deleteShader(v),this.getUniforms=function(){return void 0===p&&(p=new Eo(o,h)),p},this.getAttributes=function(){return void 0===d&&(d=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var o=e.getActiveAttrib(t,i).name;n[o]=e.getAttribLocation(t,o)}return n}(o,h)),d},this.destroy=function(){o.deleteProgram(h),this.program=void 0},this.name=n.shaderName,this.id=Ro++,this.cacheKey=t,this.usedTimes=1,this.program=h,this.vertexShader=m,this.fragmentShader=v,this}function Bo(e,t,n){var r=[],i=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,s=n.precision,l=(n.maxVertexUniforms,n.vertexTextures),c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function u(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Pt,t}this.getParameters=function(r,h,p,d,f,m,v){var g=d.fog,y=c[r.type];null!==r.precision&&(s=n.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",s,"instead.");var x=function(e,t){var n;if(t){var r=Ei[t];n={name:e.type,uniforms:li.clone(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}}else n={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return n}(r,y);r.onBeforeCompile(x,e);var b=e.getRenderTarget();return{isWebGL2:i,shaderID:y,shaderName:x.name,uniforms:x.uniforms,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,defines:r.defines,isRawShaderMaterial:!0,isShaderMaterial:!0,precision:s,instancing:!1,supportsVertexTextures:l,outputEncoding:null!==b?u(b.texture):e.outputEncoding,map:!!r.map,mapEncoding:u(r.map),matcap:!!r.matcap,matcapEncoding:u(r.matcap),envMap:!1,envMapMode:null,envMapEncoding:u(null),envMapCubeUV:!1,lightMap:!!r.lightMap,lightMapEncoding:u(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:u(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===Ft,tangentSpaceNormalMap:r.normalMapType===zt,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.displacementMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||!r.displacementMap),fog:!!g,useFog:r.fog,fogExp2:g&&g.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:o,skinning:r.skinning&&!1,maxBones:0,useVertexTexture:a,morphTargets:!1,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:f,numClipIntersection:m,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:le,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===P,flipSided:r.side===O,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawbuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:r.onBeforeCompile}},this.getProgramCacheKey=function(e){var t=[];if(e.shaderID?t.push(e.shaderID):(t.push(e.fragmentShader),t.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)t.push(n),t.push(e.defines[n]);return t.push(e.onBeforeCompile.toString()),t.join()},this.acquireProgram=function(t,n){for(var i,o=0,a=r.length;o<a;o++){var s=r[o];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new No(e,n,t),r.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function jo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Go(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ho(){var e=[],t=0,n=[],r=[],i={id:-1};function o(n,r,o,a,s,l){var c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:o,program:o.program||i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:l},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=o,c.program=o.program||i,c.groupOrder=a,c.renderOrder=n.renderOrder,c.z=s,c.group=l),t++,c}return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(e,t,i,a,s,l){var c=o(e,t,i,a,s,l);(!0===i.transparent?r:n).push(c)},unshift:function(e,t,i,a,s,l){var c=o(e,t,i,a,s,l);(!0===i.transparent?r:n).unshift(c)},finish:function(){for(var n=t,r=e.length;n<r;n++){var i=e[n];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||jo),r.length>1&&r.sort(t||Go)}}}var Vo=0;function Wo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function qo(){var e=new function(){for(var e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},t=0;t<9;t++)e.probe.push(new en);return new cn,new cn,{setup:function(t,n,r){for(var i=0;i<9;i++)e.probe[i].set(0,0,0);r.matrixWorldInverse,t.sort(Wo),i=0;for(var o=t.length;i<o;i++){var a=t[i];a.color,a.intensity,a.distance,a.shadow&&a.shadow.map&&a.shadow.map.texture}e.ambient[0]=0,e.ambient[1]=0,e.ambient[2]=0;var s=e.hash;0===s.directionalLength&&0===s.pointLength&&0===s.spotLength&&0===s.rectAreaLength&&0===s.hemiLength&&0===s.numDirectionalShadows&&0===s.numPointShadows&&0===s.numSpotShadows||(e.directional.length=0,e.spot.length=0,e.rectArea.length=0,e.point.length=0,e.hemi.length=0,e.directionalShadow.length=0,e.directionalShadowMap.length=0,e.pointShadow.length=0,e.pointShadowMap.length=0,e.spotShadow.length=0,e.spotShadowMap.length=0,e.directionalShadowMatrix.length=0,e.pointShadowMatrix.length=0,e.spotShadowMatrix.length=0,s.directionalLength=0,s.pointLength=0,s.spotLength=0,s.rectAreaLength=0,s.hemiLength=0,s.numDirectionalShadows=0,s.numPointShadows=0,s.numSpotShadows=0,e.version=Vo++)},state:e}},t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function Yo(e){gr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Lt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Xo(){this.render=function(){}}function Zo(e,t,n,r,i,o,a){var s,l=i.isWebGL2,c=i.maxTextures,u=(i.maxCubemapSize,i.maxTextureSize),h=i.maxSamples,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function d(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function f(e){return Gt.isPowerOfTwo(e.width)&&Gt.isPowerOfTwo(e.height)}function m(e,t){return e.generateMipmaps&&t&&e.minFilter!==fe&&e.minFilter!==ge}function v(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function g(n,r,i){if(!1===l)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325===o||33326===o||34842===o||34836===o?t.get("EXT_color_buffer_float"):34843!==o&&34837!==o||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function y(e){return e===fe||e===me||e===ve?9728:9729}function x(t){var n=t.target;n.removeEventListener("dispose",x),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),a.memory.textures--}function b(t){var n=t.target;n.removeEventListener("dispose",b),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}(n),a.memory.textures--}var w=0;function S(e,t){var i=r.get(e);if(e.version>0&&i.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void E(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeAndBindTexture(33984+t,3553,i.__webglTexture)}var T={[he]:10497,[pe]:33071,[de]:33648},_={[fe]:9728,[me]:9984,[ve]:9986,[ge]:9729,[ye]:9985,[xe]:9987};function M(n,o,a){a?(e.texParameteri(n,10242,T[o.wrapS]),e.texParameteri(n,10243,T[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,T[o.wrapR]),e.texParameteri(n,10240,_[o.magFilter]),e.texParameteri(n,10241,_[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===pe&&o.wrapT===pe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,y(o.magFilter)),e.texParameteri(n,10241,y(o.minFilter)),o.minFilter!==fe&&o.minFilter!==ge&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===Ee&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ae&&null===(l||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function E(t,r,i){var c=3553;r.isDataTexture2DArray&&(c=35866),r.isDataTexture3D&&(c=32879),function(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",x),t.__webglTexture=e.createTexture(),a.memory.textures++)}(t,r),n.activeTexture(33984+i),n.bindTexture(c,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var h=function(e){return!l&&(e.wrapS!==pe||e.wrapT!==pe||e.minFilter!==fe&&e.minFilter!==ge)}(r)&&!1===f(r.image),p=function(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Gt.floorPowerOfTwo:Math.floor,a=o(i*e.width),l=o(i*e.height);void 0===s&&(s=d(a,l));var c=n?d(a,l):s;return c.width=a,c.height=l,c.getContext("2d").drawImage(e,0,0,a,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+l+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}(r.image,h,!1,u),y=f(p)||l,b=o.convert(r.format),w=o.convert(r.type),S=g(r.internalFormat,b,w);M(c,r,y);var T,_=r.mipmaps;if(r.isDepthTexture){if(S=6402,r.type===Ee){if(!1===l)throw new Error("Float Depth Texture only supported in WebGL2.0");S=36012}else l&&(S=33189);r.format===Ue&&6402===S&&r.type!==Te&&r.type!==Me&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Te,w=o.convert(r.type)),r.format===Ne&&(S=34041,r.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Pe,w=o.convert(r.type))),n.texImage2D(3553,0,S,p.width,p.height,0,b,w,null)}else if(r.isDataTexture)if(_.length>0&&y){for(var E=0,A=_.length;E<A;E++)T=_[E],n.texImage2D(3553,E,S,T.width,T.height,0,b,w,T.data);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,S,p.width,p.height,0,b,w,p.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(E=0,A=_.length;E<A;E++)T=_[E],r.format!==Fe&&r.format!==ze?null!==b?n.compressedTexImage2D(3553,E,S,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,E,S,T.width,T.height,0,b,w,T.data);t.__maxMipLevel=_.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,S,p.width,p.height,p.depth,0,b,w,p.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,S,p.width,p.height,p.depth,0,b,w,p.data),t.__maxMipLevel=0;else if(_.length>0&&y){for(E=0,A=_.length;E<A;E++)T=_[E],n.texImage2D(3553,E,S,b,w,T);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,S,b,w,p),t.__maxMipLevel=0;m(r,y)&&v(c,r,p.width,p.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function A(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(r){var i=C(n);e.renderbufferStorageMultisample(36161,i,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){i=C(n);e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=o.convert(n.texture.format),s=o.convert(n.texture.type),l=g(n.texture.internalFormat,a,s);if(r){i=C(n);e.renderbufferStorageMultisample(36161,i,l,n.width,n.height)}else e.renderbufferStorage(36161,l,n.width,n.height)}e.bindRenderbuffer(36161,null)}function R(t){var n=r.get(t);t.depthTexture?function(t,n){0;if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ue)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Ne)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t):(e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),A(n.__webglDepthbuffer,t)),e.bindFramebuffer(36160,null)}function C(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}var O=!1;this.allocateTextureUnit=function(){var e=w;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),w+=1,e},this.resetTextureUnits=function(){w=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?E(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?E(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(){},this.setTextureCubeDynamic=function(){},this.setupRenderTarget=function(t){var i=r.get(t),s=r.get(t.texture);t.addEventListener("dispose",b),s.__webglTexture=e.createTexture(),a.memory.textures++;var c=!0===t.isWebGLMultisampleRenderTarget,u=f(t)||l;if(i.__webglFramebuffer=e.createFramebuffer(),c)if(l){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var h=o.convert(t.texture.format),p=o.convert(t.texture.type),d=g(t.texture.internalFormat,h,p),y=C(t);e.renderbufferStorageMultisample(36161,y,d,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),A(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");n.bindTexture(3553,s.__webglTexture),M(3553,t.texture,u),function(t,i,a,s){var l=o.convert(i.texture.format),c=o.convert(i.texture.type),u=g(i.texture.internalFormat,l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}(i.__webglFramebuffer,t,36064,3553),m(t.texture,u)&&v(3553,t.texture,t.width,t.height),n.bindTexture(3553,null),t.depthBuffer&&R(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(m(t,f(e)||l)){var i=r.get(t).__webglTexture;n.bindTexture(3553,i),v(3553,t,e.width,e.height),n.bindTexture(3553,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(l){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){Array.isArray(e.image)&&e.image.length}}function Jo(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===be)return 5121;if(e===Re)return 32819;if(e===Ce)return 32820;if(e===Oe)return 33635;if(e===we)return 5120;if(e===Se)return 5122;if(e===Te)return 5123;if(e===_e)return 5124;if(e===Me)return 5125;if(e===Ee)return 5126;if(e===Ae)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===Le)return 6406;if(e===ze)return 6407;if(e===Fe)return 6408;if(e===Ie)return 6409;if(e===De)return 6410;if(e===Ue)return 6402;if(e===Ne)return 34041;if(e===Be)return 6403;if(e===je)return 36244;if(e===Ge)return 33319;if(e===He)return 33320;if(e===Ve)return 36248;if(e===We)return 36249;if(e===qe||e===Ye||e===Xe||e===Ze){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===qe)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ye)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Xe)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ze)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Je||e===Ke||e===Qe||e===$e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===Je)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ke)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Qe)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===$e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===et)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===tt||e===nt)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(e===tt)return n.COMPRESSED_RGB8_ETC2;if(e===nt)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===rt||e===it||e===ot||e===at||e===st||e===lt||e===ct||e===ut||e===ht||e===pt||e===dt||e===ft||e===mt||e===vt||e===gt||e===yt||e===xt||e===bt||e===wt||e===St||e===Tt||e===_t||e===Mt||e===Et||e===At||e===Rt||e===Ct||e===Ot?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Pe?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Ko(){An.call(this),this.type="Group"}function Qo(){this.getDevice=function(){}}function $o(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,p=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Pt,this.physicallyCorrectLights=!1,this.toneMapping=ce,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,m,v,g,y,x,b,w,S,T,_,M,le,he,pe,de,fe,me=this,ve=!1,ge=null,ye=0,xe=0,we=null,Se=null,Te=-1,_e={geometry:null,program:null,wireframe:!1},Me=null,Re=null,Ce=new Xt,Oe=new Xt,Pe=null,Le=t.width,ze=t.height,Ie=1,De=null,ke=null,Ue=new Xt(0,0,Le,ze),Ne=new Xt(0,0,Le,ze),Be=!1,je=new wi,Ge=new function(){var e=this,t=null,n=0,r=!1,i=!1,o=new Jn,a=new Vt,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,n,r,i){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=r+4*l,h=n.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var p=0,d=r;p!==l;++p,d+=4)o.copy(t[p]).applyMatrix4(h,a),o.normal.toArray(c,d),c[d+3]=o.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,e.numIntersection=0,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var a=0!==e.length||i||0!==n||r;return r=i,t=c(e,o,0),n=e.length,a},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,o,a,u,h,p){if(!r||null===e||0===e.length||i&&!a)i?c(null):l();else{var d=i?0:n,f=4*d,m=h.clippingState||null;s.value=m,m=c(e,u,f,p);for(var v=0;v!==f;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}},He=!1,Ve=!1,We=new cn,qe=new en;try{var Ye={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u,xrCompatible:!0};if(t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",Qe,!1),null===(d=n||t.getContext("webgl",Ye)||t.getContext("experimental-webgl",Ye)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Xe(){f=new function(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}(d),!1===(m=new function(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(36183):0}}(d,f,e)).isWebGL2&&(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),fe=new Jo(d,f,m),(v=new function(e,t,n){var r=n.isWebGL2,i=new function(){var t=!1,n=new Xt,r=null,i=new Xt(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?xe(2929):be(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case ee:e.depthFunc(512);break;case te:e.depthFunc(519);break;case ne:e.depthFunc(513);break;case re:e.depthFunc(515);break;case ie:e.depthFunc(514);break;case oe:e.depthFunc(518);break;case ae:e.depthFunc(516);break;case se:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){var t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?xe(2960):be(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&l===r||(e.stencilOp(t,n,r),a=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null}}},s=e.getParameter(34921),l=new Uint8Array(s),c=new Uint8Array(s),u=new Uint8Array(s),h={},p=null,d=null,f=null,m=null,v=null,g=null,y=null,x=null,b=null,w=!1,S=null,T=null,_=null,M=null,C=null,le=e.getParameter(35661),ce=!1,ue=0,he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(ue=parseFloat(/^WebGL\ ([0-9])/.exec(he)[1]),ce=ue>=1):-1!==he.indexOf("OpenGL ES")&&(ue=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(he)[1]),ce=ue>=2);var pe=null,de={},fe=new Xt,me=new Xt;function ve(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var ge={};function ye(n,i){l[n]=1,0===c[n]&&(e.enableVertexAttribArray(n),c[n]=1),u[n]!==i&&((r?e:t.get("ANGLE_instanced_arrays"))[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),u[n]=i)}function xe(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function be(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),xe(2929),o.setFunc(re),Me(!1),Ee(A),xe(2884),_e(L);var we={[U]:32774,[N]:32778,[B]:32779};if(r)we[j]=32775,we[G]=32776;else{var Se=t.get("EXT_blend_minmax");null!==Se&&(we[j]=Se.MIN_EXT,we[G]=Se.MAX_EXT)}var Te={[H]:0,[V]:1,[W]:768,[Y]:770,[$]:776,[K]:774,[Z]:772,[q]:769,[X]:771,[Q]:775,[J]:773};function _e(t,n,r,i,o,a,s,l){if(t!==L){if(d||(xe(3042),d=!0),t===k)o=o||n,a=a||r,s=s||i,n===m&&o===y||(e.blendEquationSeparate(we[n],we[o]),m=n,y=o),r===v&&i===g&&a===x&&s===b||(e.blendFuncSeparate(Te[r],Te[i],Te[a],Te[s]),v=r,g=i,x=a,b=s),f=t,w=null;else if(t!==f||l!==w){if(m===U&&y===U||(e.blendEquation(32774),m=U,y=U),l)switch(t){case z:e.blendFuncSeparate(1,771,1,771);break;case F:e.blendFunc(1,1);break;case I:e.blendFuncSeparate(0,0,769,771);break;case D:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case z:e.blendFuncSeparate(770,771,1,771);break;case F:e.blendFunc(770,1);break;case I:e.blendFunc(0,769);break;case D:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,g=null,x=null,b=null,f=t,w=l}}else d&&(be(3042),d=!1)}function Me(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function Ee(t){t!==E?(xe(2884),t!==T&&(t===A?e.cullFace(1029):t===R?e.cullFace(1028):e.cullFace(1032))):be(2884),T=t}function Ae(t,n,r){t?(xe(32823),M===n&&C===r||(e.polygonOffset(n,r),M=n,C=r)):be(32823)}function Re(t){void 0===t&&(t=33984+le-1),pe!==t&&(e.activeTexture(t),pe=t)}function Ce(t,n){null===pe&&Re();var r=de[pe];void 0===r&&(r={type:void 0,texture:void 0},de[pe]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)}return{buffers:{color:i,depth:o,stencil:a},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,n=c.length;t!==n;++t)c[t]!==l[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:xe,disable:be,useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:_e,setMaterial:function(e,t){e.side===P?be(2884):xe(2884);var n=e.side===O;t&&(n=!n),Me(n),e.blending===z&&!1===e.transparent?_e(L):_e(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);var r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ae(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Me,setCullFace:Ee,setLineWidth:function(t){t!==_&&(ce&&e.lineWidth(t),_=t)},setPolygonOffset:Ae,setScissorTest:function(e){e?xe(3089):be(3089)},activeTexture:Re,bindTexture:Ce,activeAndBindTexture:function(e,t,n){const r=de[e];(void 0===r||r.type!==t||r.texture!==n)&&(Re(e),Ce(t,n))},unbindTexture:function(){var t=de[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);h={},pe=null,de={},p=null,f=null,S=null,T=null,i.reset(),o.reset(),a.reset()}}}(d,f,m)).scissor(Oe.copy(Ne).multiplyScalar(Ie).floor()),v.viewport(Ce.copy(Ue).multiplyScalar(Ie).floor()),g=new function(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(r=r||1,t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}(d),y=new function(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}},x=new Zo(d,f,v,y,m,fe,g),b=new Ti(d,m),w=new function(e,t,n){var r=new WeakMap,i=new WeakMap;function o(e){var a=e.target,s=r.get(a);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),r.delete(a);var c=i.get(s);c&&(t.remove(c),i.delete(s)),n.memory.geometries--}function a(e){var n=[],r=e.index,o=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],p=s[l+2];n.push(u,h,h,p,p,u)}}else for(s=o.array,a=o.version,l=0,c=s.length/3-1;l<c;l+=3)u=l+0,h=l+1,p=l+2,n.push(u,h,h,p,p,u);var d=new(Or(n)>65535?Ar:Mr)(n,1);d.version=a,t.update(d,34963);var f=i.get(e);f&&t.remove(f),i.set(e,d)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ur).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.index,r=e.attributes;for(var i in null!==n&&t.update(n,34963),r)t.update(r[i],34962);var o=e.morphAttributes;for(var i in o)for(var a=o[i],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return i.get(e)}}}(d,b,g),S=new function(e,t,n,r){var i=new WeakMap;return{update:function(e){var n=r.render.frame,o=e.geometry,a=t.get(e,o);return i.get(a)!==n&&(o.isGeometry&&a.updateFromObject(e),t.update(a),i.set(a,n)),a},dispose:function(){i=new WeakMap}}}(d,w,b,g),he=new function(e){var t={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,l=void 0===s?0:s.length,c=t[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}var h=o.morphNormals&&i.morphAttributes.normal;for(u=0;u<l;u++)0!==(d=c[u])[1]&&h&&i.deleteAttribute("morphNormal"+u);for(u=0;u<l;u++)(d=c[u])[0]=u,d[1]=s[u];c.sort(Ai);var p=0;for(u=0;u<8;u++){var d;if(d=c[u]){var f=d[0],m=d[1];if(m){h&&i.setAttribute("morphNormal"+u,h[f]),n[u]=m,p+=m;continue}}n[u]=0}var v=i.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",v),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}(d),T=new Bo(me,f,m),_=new function(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i,o=e.get(n);return void 0===o?(i=new Ho,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):void 0===(i=o.get(r))&&(i=new Ho,o.set(r,i)),i},dispose:function(){e=new WeakMap}}},M=new function(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i;return!1===e.has(n)?(i=new qo,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):!1===e.get(n).has(r)?(i=new qo,e.get(n).set(r,i)):i=e.get(n).get(r),i},dispose:function(){e=new WeakMap}}},le=new function(e,t,n,r){var i,o,a=new hr(0),s=0,l=null,c=0,u=null;function h(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),h(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(a,s=e)},render:function(t,r,p,d){var f=r.background,m=e.xr,v=m.getSession&&m.getSession();if(v&&"additive"===v.environmentBlendMode&&(f=null),null===f?h(a,s):f&&f.isColor&&(h(f,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&f.mapping===ue){void 0===o&&((o=new Jr(new oi(1,1,1),new hi({type:"BackgroundCubeMaterial",uniforms:ai(Ei.cube.uniforms),vertexShader:Ei.cube.vertexShader,fragmentShader:Ei.cube.fragmentShader,side:O,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return(!1).value}}),n.update(o));var g=f;(!1).value=g,o.material.uniforms.flipEnvMap.value=1,l===f&&c===g.version&&u===e.toneMapping||(o.material.needsUpdate=!0,l=f,c=g.version,u=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null)}else f&&f.isTexture&&(void 0===i&&((i=new Jr(new _i(2,2),new hi({type:"BackgroundMaterial",uniforms:ai(Ei.background.uniforms),vertexShader:Ei.background.vertexShader,fragmentShader:Ei.background.fragmentShader,side:C,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(i)),i.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),i.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&c===f.version&&u===e.toneMapping||(i.material.needsUpdate=!0,l=f,c=f.version,u=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}(me,v,S,s),pe=new function(e,t,n,r){var i,o=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function(r,a,s,l){if(0!==l){var c,u;if(o)c=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](i,a,s,l),n.update(s,i,l)}}}(d,f,g,m),de=new function(e,t,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,o,t*a),n.update(r,i)},this.renderInstances=function(r,l,c,u){if(0!==u){var h,p;if(s)h=e,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[p](i,c,o,l*a,u),n.update(c,i,u)}}}(d,f,g,m),g.programs=T.programs,me.capabilities=m,me.extensions=f,me.properties=y,me.renderLists=_,me.state=v,me.info=g}Xe();var Ze=new Qo(me,d);this.xr=Ze;var Je=new Xo(me,S,m.maxTextureSize);function Ke(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ve=!0}function Qe(){console.log("THREE.WebGLRenderer: Context Restored."),ve=!1,Xe()}function $e(e){var t=e.target;t.removeEventListener("dispose",$e),function(e){et(e),y.remove(e)}(t)}function et(e){var t=y.get(e).program;e.program=void 0,void 0!==t&&T.releaseProgram(t)}this.shadowMap=Je,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Ie},this.setPixelRatio=function(e){void 0!==e&&(Ie=e,this.setSize(Le,ze,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Ht),e.set(Le,ze)},this.setSize=function(e,n,r){Ze.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Le=e,ze=n,t.width=Math.floor(e*Ie),t.height=Math.floor(n*Ie),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Ht),e.set(Le*Ie,ze*Ie).floor()},this.setDrawingBufferSize=function(e,n,r){Le=e,ze=n,Ie=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Xt),e.copy(Ce)},this.getViewport=function(e){return e.copy(Ue)},this.setViewport=function(e,t,n,r){e.isVector4?Ue.set(e.x,e.y,e.z,e.w):Ue.set(e,t,n,r),v.viewport(Ce.copy(Ue).multiplyScalar(Ie).floor())},this.getScissor=function(e){return e.copy(Ne)},this.setScissor=function(e,t,n,r){e.isVector4?Ne.set(e.x,e.y,e.z,e.w):Ne.set(e,t,n,r),v.scissor(Oe.copy(Ne).multiplyScalar(Ie).floor())},this.getScissorTest=function(){return Be},this.setScissorTest=function(e){v.setScissorTest(Be=e)},this.setOpaqueSort=function(e){De=e},this.setTransparentSort=function(e){ke=e},this.getClearColor=function(){return le.getClearColor()},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),d.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",Qe,!1),_.dispose(),M.dispose(),y.dispose(),S.dispose(),Ze.dispose(),rt.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=y.get(e);e.hasPositions&&!n.position&&(n.position=d.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=d.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=d.createBuffer()),e.hasColors&&!n.color&&(n.color=d.createBuffer());var r=t.getAttributes();e.hasPositions&&(d.bindBuffer(34962,n.position),d.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),d.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(d.bindBuffer(34962,n.normal),d.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),d.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(d.bindBuffer(34962,n.uv),d.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),d.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(d.bindBuffer(34962,n.color),d.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),d.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),d.drawArrays(4,0,e.count),e.count=0};var tt=new Rn;this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=tt);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=st(e,t,r,i);v.setMaterial(r,a);var l=!1;_e.geometry===n.id&&_e.program===s.id&&_e.wireframe===(!0===r.wireframe)||(_e.geometry=n.id,_e.program=s.id,_e.wireframe=!0===r.wireframe,l=!0),r.morphNormals&&(he.update(i,n,r,s),l=!0);var c=n.index,u=n.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;var h,p=1;!0===r.wireframe&&(c=w.getWireframeAttribute(n),p=2);var g=pe;null!==c&&(h=b.get(c),(g=de).setIndex(h)),l&&(!function(e,t,n,r){if(!1===m.isWebGL2&&t.isInstancedBufferGeometry&&null===f.get("ANGLE_instanced_arrays"))return;v.initAttributes();var i=t.attributes,o=r.getAttributes(),a=n.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var c=i[s];if(void 0!==c){var u=c.normalized,h=c.itemSize,p=b.get(c);if(void 0===p)continue;var g=p.buffer,y=p.type,x=p.bytesPerElement;if(c.isInterleavedBufferAttribute){var w=c.data,S=w.stride,T=c.offset;w&&w.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(l,w.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=w.meshPerAttribute*w.count)):v.enableAttribute(l),d.bindBuffer(34962,g),d.vertexAttribPointer(l,h,y,u,S*x,T*x)}else c.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=c.meshPerAttribute*c.count)):v.enableAttribute(l),d.bindBuffer(34962,g),d.vertexAttribPointer(l,h,y,u,0,0)}else if("instanceMatrix"===s){var p=b.get(e.instanceMatrix);if(void 0===p)continue;var g=p.buffer,y=p.type;v.enableAttributeAndDivisor(l+0,1),v.enableAttributeAndDivisor(l+1,1),v.enableAttributeAndDivisor(l+2,1),v.enableAttributeAndDivisor(l+3,1),d.bindBuffer(34962,g),d.vertexAttribPointer(l+0,4,y,!1,64,0),d.vertexAttribPointer(l+1,4,y,!1,64,16),d.vertexAttribPointer(l+2,4,y,!1,64,32),d.vertexAttribPointer(l+3,4,y,!1,64,48)}else if(void 0!==a){var _=a[s];if(void 0!==_)switch(_.length){case 2:d.vertexAttrib2fv(l,_);break;case 3:d.vertexAttrib3fv(l,_);break;case 4:d.vertexAttrib4fv(l,_);break;default:d.vertexAttrib1fv(l,_)}}}}v.disableUnusedAttributes()}(i,n,r,s),null!==c&&d.bindBuffer(34963,h.buffer));var y=null!==c?c.count:u.count,x=n.drawRange.start*p,S=n.drawRange.count*p,T=null!==o?o.start*p:0,_=null!==o?o.count*p:1/0,M=Math.max(x,T),E=Math.min(y,x+S,T+_)-1,A=Math.max(0,E-M+1);0!==A&&(i.isMesh?!0===r.wireframe?(v.setLineWidth(r.wireframeLinewidth*(null===we?Ie:1)),g.setMode(1)):g.setMode(4):i.isSprite&&g.setMode(4),n.isInstancedBufferGeometry?g.renderInstances(n,M,A,n.maxInstancedCount):g.render(M,A))},this.compile=function(e,t){(p=M.get(e,t)).init(),e.traverse(function(e){}),p.setupLights(t);var n={};e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)t.material[r].uuid in n==!1&&(at(t.material[r],e,t),n[t.material[r].uuid]=!0);else t.material.uuid in n==!1&&(at(t.material,e,t),n[t.material.uuid]=!0)})};var nt=null;var rt=new function(){var e=null,t=!1,n=null;function r(i,o){!1!==t&&(n(i,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}};function it(e,t,n,r){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,l=a.geometry,c=void 0===r?a.material:r,u=a.group;if(n.isArrayCamera){Re=n;for(var h=n.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(v.viewport(Ce.copy(m.viewport)),p.setupLights(m),ot(s,t,m,l,c,u))}}else Re=null,ot(s,t,n,l,c,u)}}function ot(e,t,n,r,i,o){if(e.onBeforeRender(me,t,n,r,i,o),p=M.get(t,Re||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=st(n,t,i,e);v.setMaterial(i),_e.geometry=null,_e.program=null,_e.wireframe=!1,function(e,t){e.render(function(e){me.renderBufferImmediate(e,t)})}(e,a)}else me.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(me,t,n,r,i,o),p=M.get(t,Re||n)}function at(e,t,n){var r=y.get(e),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=T.getParameters(e,i.state,o,t,Ge.numPlanes,Ge.numIntersection,n),l=T.getProgramCacheKey(s),c=r.program,u=!0;if(void 0===c)e.addEventListener("dispose",$e);else if(c.cacheKey!==l)et(e);else if(r.lightsStateVersion!==a)r.lightsStateVersion=a,u=!1;else{if(void 0!==s.shaderID)return;u=!1}u&&(c=T.acquireProgram(s,l),r.program=c,r.uniforms=s.uniforms,r.environment=null,r.outputEncoding=me.outputEncoding,e.program=c);var h=c.getAttributes();if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<me.maxMorphNormals;d++)h["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var f=r.uniforms;!0===e.clipping&&(r.numClippingPlanes=Ge.numPlanes,r.numIntersection=Ge.numIntersection,f.clippingPlanes=Ge.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isShadowMaterial||!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=r.program.getUniforms(),v=Eo.seqWithValue(m.seq,f);r.uniformsList=v}function st(e,t,n,r){x.resetTextureUnits();var i=t.fog,o=y.get(n),a=p.state.lights;if(He&&(Ve||e!==Me)){var s=e===Me&&n.id===Te;Ge.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,o,s)}n.version===o.__version?void 0===o.program?at(n,t,r):n.fog&&o.fog!==i?at(n,t,r):null!==o.environment?at(n,t,r):o.needsLights&&o.lightsStateVersion!==a.state.version?at(n,t,r):void 0===o.numClippingPlanes||o.numClippingPlanes===Ge.numPlanes&&o.numIntersection===Ge.numIntersection?o.outputEncoding!==me.outputEncoding&&at(n,t,r):at(n,t,r):(at(n,t,r),o.__version=n.version);var l,c,u=!1,h=!1,f=!1,g=o.program,b=g.getUniforms(),w=o.uniforms;if(v.useProgram(g.program)&&(u=!0,h=!0,f=!0),n.id!==Te&&(Te=n.id,h=!0),u||Me!==e){b.setValue(d,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&b.setValue(d,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),Me!==e&&(Me=e,h=!0,f=!0);var S=b.map.cameraPosition;void 0!==S&&S.setValue(d,qe.setFromMatrixPosition(e.matrixWorld)),n.isMeshBasicMaterial,b.setValue(d,"isOrthographic",!0===e.isOrthographicCamera),n.isMeshBasicMaterial,b.setValue(d,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){b.setOptional(d,r,"bindMatrix"),b.setOptional(d,r,"bindMatrixInverse");var T=r.skeleton;if(T){var _=T.bones;if(m.floatVertexTextures){if(void 0===T.boneTexture){var M=Math.sqrt(4*_.length);M=Gt.ceilPowerOfTwo(M),M=Math.max(M,4);var E=new Float32Array(M*M*4);E.set(T.boneMatrices);var A=new yi(E,M,M,Fe,Ee);T.boneMatrices=E,T.boneTexture=A,T.boneTextureSize=M}b.setValue(d,"boneTexture",T.boneTexture,x),b.setValue(d,"boneTextureSize",T.boneTextureSize)}else b.setOptional(d,T,"boneMatrices")}}return(h||o.receiveShadow!==r.receiveShadow)&&(o.receiveShadow=r.receiveShadow,b.setValue(d,"receiveShadow",r.receiveShadow)),h&&(b.setValue(d,"toneMappingExposure",me.toneMappingExposure),b.setValue(d,"toneMappingWhitePoint",me.toneMappingWhitePoint),o.needsLights&&(c=f,(l=w).ambientLightColor.needsUpdate=c,l.lightProbe.needsUpdate=c,l.directionalLights.needsUpdate=c,l.directionalLightShadows.needsUpdate=c,l.pointLights.needsUpdate=c,l.pointLightShadows.needsUpdate=c,l.spotLights.needsUpdate=c,l.spotLightShadows.needsUpdate=c,l.rectAreaLights.needsUpdate=c,l.hemisphereLights.needsUpdate=c),i&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(w,i),n.isMeshBasicMaterial?lt(w,n):n.isMeshMatcapMaterial?(lt(w,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===O&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===O&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isMeshDepthMaterial?(lt(w,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isMeshNormalMaterial?(lt(w,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===O&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===O&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(w,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(w,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Ie,e.scale.value=.5*ze,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(w,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(w,n):n.isShadowMaterial&&(w.color.value.copy(n.color),w.opacity.value=n.opacity),void 0!==w.ltc_1&&(w.ltc_1.value=Si.LTC_1),void 0!==w.ltc_2&&(w.ltc_2.value=Si.LTC_2),Eo.upload(d,o.uniformsList,w,x),n.uniformsNeedUpdate=!1),!0===n.uniformsNeedUpdate&&(Eo.upload(d,o.uniformsList,w,x),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(d,"center",r.center),b.setValue(d,"modelViewMatrix",r.modelViewMatrix),b.setValue(d,"normalMatrix",r.normalMatrix),b.setValue(d,"modelMatrix",r.matrixWorld),g}function lt(e,t,n){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r,i,o=n;o&&((!1).value=o,e.flipEnvMap.value=1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=y.get(o).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}rt.setAnimationLoop(function(e){Ze.isPresenting||nt&&nt(e)}),"undefined"!=typeof window&&rt.setContext(window),this.setAnimationLoop=function(e){nt=e,Ze.setAnimationLoop(e),rt.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!ve){_e.geometry=null,_e.program=null,_e.wireframe=!1,Te=-1,Me=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Ze.enabled&&Ze.isPresenting&&(t=Ze.getCamera(t)),(p=M.get(e,t)).init(),e.onBeforeRender(me,e,t,n||we),We.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),je.setFromProjectionMatrix(We),Ve=this.localClippingEnabled,He=Ge.init(this.clippingPlanes,Ve,t),(h=_.get(e,t)).init(),function e(t,n,r,i){if(!1===t.visible)return;var o=t.layers.test(n.layers);if(o)if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isSprite){if(!t.frustumCulled||je.intersectsSprite(t)){i&&qe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(We);var a=S.update(t),s=t.material;s.visible&&h.push(t,a,s,r,qe.z,null)}}else if(t.isImmediateRenderObject)i&&qe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(We),h.push(t,null,t.material,r,qe.z,null);else if(t.isMesh&&(!t.frustumCulled||je.intersectsObject(t))){i&&qe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(We);var a=S.update(t),s=t.material;if(Array.isArray(s))for(var l=a.groups,c=0,u=l.length;c<u;c++){var p=l[c],d=s[p.materialIndex];d&&d.visible&&h.push(t,a,d,r,qe.z,p)}else s.visible&&h.push(t,a,s,r,qe.z,null)}var f=t.children;for(var c=0,u=f.length;c<u;c++)e(f[c],n,r,i)}(e,t,0,me.sortObjects),h.finish(),!0===me.sortObjects&&h.sort(De,ke),He&&Ge.beginShadows();var i=p.state.shadowsArray;Je.render(i,e,t),p.setupLights(t),He&&Ge.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),le.render(h,e,t,r);var o=h.opaque,a=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&it(o,e,t,s),a.length&&it(a,e,t,s)}else o.length&&it(o,e,t),a.length&&it(a,e,t);e.onAfterRender(me,e,t),null!==we&&(x.updateRenderTargetMipmap(we),x.updateMultisampleRenderTarget(we)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),h=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){ge!==e&&null===we&&d.bindFramebuffer(36160,e),ge=e},this.getActiveCubeFace=function(){return ye},this.getActiveMipmapLevel=function(){return xe},this.getRenderTarget=function(){return we},this.setRenderTarget=function(e,t,n){we=e,ye=t,xe=n,e&&void 0===y.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var r=ge;if(e){var i=y.get(e).__webglFramebuffer;r=e.isWebGLMultisampleRenderTarget?y.get(e).__webglMultisampledFramebuffer:i,Ce.copy(e.viewport),Oe.copy(e.scissor),Pe=e.scissorTest}else Ce.copy(Ue).multiplyScalar(Ie).floor(),Oe.copy(Ne).multiplyScalar(Ie).floor(),Pe=Be;Se!==r&&(d.bindFramebuffer(36160,r),Se=r),v.viewport(Ce),v.scissor(Oe),v.setScissorTest(Pe)},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(e&&e.isWebGLRenderTarget){var s=y.get(e).__webglFramebuffer;if(s){var l=!1;s!==Se&&(d.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,u=c.format,h=c.type;if(u!==Fe&&fe.convert(u)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===be||fe.convert(h)===d.getParameter(35738)||h===Ee&&(m.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||h===Ae&&(m.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&d.readPixels(t,n,r,i,fe.convert(u),fe.convert(h),o)}finally{l&&d.bindFramebuffer(36160,Se)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=fe.convert(t.format);x.setTexture2D(t,0),d.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,o=t.image.height,a=fe.convert(n.format),s=fe.convert(n.type);x.setTexture2D(n,0),d.pixelStorei(37440,n.flipY),d.pixelStorei(37441,n.premultiplyAlpha),d.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?d.texSubImage2D(3553,r||0,e.x,e.y,i,o,a,s,t.image.data):d.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image),v.unbindTexture()},this.initTexture=function(e){x.setTexture2D(e,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ea(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=kt,this.updateRange={offset:0,count:-1},this.version=0}Yo.prototype=Object.create(gr.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isMeshDepthMaterial=!0,Yo.prototype.copy=function(e){return gr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Ko.prototype=Object.assign(Object.create(An.prototype),{constructor:Ko,isGroup:!0}),Object.assign(Qo.prototype,Ut.prototype),Object.defineProperty(ea.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ea.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var ta=new en;function na(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}Object.defineProperties(na.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(na.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)ta.x=this.getX(t),ta.y=this.getY(t),ta.z=this.getZ(t),ta.applyMatrix4(e),this.setXYZ(t,ta.x,ta.y,ta.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}});new cn;var ra=new en,ia=new en;function oa(){An.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}oa.prototype=Object.assign(Object.create(An.prototype),{constructor:oa,isLOD:!0,copy:function(e){An.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){ra.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(ra);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){ra.setFromMatrixPosition(e.matrixWorld),ia.setFromMatrixPosition(this.matrixWorld);var n=ra.distanceTo(ia)/e.zoom;t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}});new cn,new cn;function aa(){}new cn,new cn,new Jr;new cn;new cn;function sa(e,t,n,r,i,o,a,s,l,c,u,h){Yt.call(this,null,o,a,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function la(e,t,n,r,i,o,a,s,l,c){if((c=void 0!==c?c:Ue)!==Ue&&c!==Ne)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ue&&(n=Te),void 0===n&&c===Ne&&(n=Pe),Yt.call(this,null,r,i,o,a,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:fe,this.minFilter=void 0!==s?s:fe,this.flipY=!1,this.generateMipmaps=!1}sa.prototype=Object.create(Yt.prototype),sa.prototype.constructor=sa,sa.prototype.isCompressedTexture=!0,la.prototype=Object.create(Yt.prototype),la.prototype.constructor=la,la.prototype.isDepthTexture=!0;var ca={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return ca.area(e)<0},triangulateShape:""};function ua(){}function ha(e,t,n,r,i,o,a){Ur.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=Math.min(o+a,Math.PI),u=0,h=[],p=new en,d=new en,f=[],m=[],v=[],g=[];for(l=0;l<=n;l++){var y=[],x=l/n,b=0;for(0==l&&0==o?b=.5/t:l==n&&c==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var w=s/t;p.x=-e*Math.cos(r+w*i)*Math.sin(o+x*a),p.y=e*Math.cos(o+x*a),p.z=e*Math.sin(r+w*i)*Math.sin(o+x*a),m.push(p.x,p.y,p.z),d.copy(p).normalize(),v.push(d.x,d.y,d.z),g.push(w+b,1-x),y.push(u++)}h.push(y)}for(l=0;l<n;l++)for(s=0;s<t;s++){var S=h[l][s+1],T=h[l][s],_=h[l+1][s],M=h[l+1][s+1];(0!==l||o>0)&&f.push(S,T,M),(l!==n-1||c<Math.PI)&&f.push(T,_,M)}this.setIndex(f),this.setAttribute("position",new Rr(m,3)),this.setAttribute("normal",new Rr(v,3)),this.setAttribute("uv",new Rr(g,2))}function pa(){}function da(e){hi.call(this,e),this.type="RawShaderMaterial"}function fa(){}function ma(e){gr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new hr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zt,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}ha.prototype=Object.create(Ur.prototype),ha.prototype.constructor=ha,da.prototype=Object.create(hi.prototype),da.prototype.constructor=da,da.prototype.isRawShaderMaterial=!0,ma.prototype=Object.create(gr.prototype),ma.prototype.constructor=ma,ma.prototype.isMeshMatcapMaterial=!0,ma.prototype.copy=function(e){return gr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};var va={arraySlice:function(e,t,n){return va.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*t,l=0;l!==t;++l)i[a++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,n,r,i){i=i||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],c=l.getValueSize(),u=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*i;if(!(d<n||d>=r)){u.push(l.times[p]);for(var f=0;f<c;++f)h.push(l.values[p*c+f])}}0!==u.length&&(l.times=va.convertArray(u,l.times.constructor),l.values=va.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function ga(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function ya(e,t,n,r){ga.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function xa(e,t,n,r){ga.call(this,e,t,n,r)}function ba(e,t,n,r){ga.call(this,e,t,n,r)}function wa(){}Object.assign(ga.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,e<(r=t[++n]))break t}o=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=i,e>=(i=t[--n-1]))break t}o=n,n=0}for(;n<o;){var l=n+o>>>1;e<t[l]?o=l:n=l+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ga.prototype,{beforeStart_:ga.prototype.copySampleValue_,afterEnd_:ga.prototype.copySampleValue_}),ya.prototype=Object.assign(Object.create(ga.prototype),{constructor:ya,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:a=t+r[i=r.length-2]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-t)/(r-t),f=d*d,m=f*d,v=-h*m+2*h*f-h*d,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,x=p*m-p*f,b=0;b!==a;++b)i[b]=v*o[c+b]+g*o[l+b]+y*o[s+b]+x*o[u+b];return i}}),xa.prototype=Object.assign(Object.create(ga.prototype),{constructor:xa,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(n-t)/(r-t),u=1-c,h=0;h!==a;++h)i[h]=o[l+h]*u+o[s+h]*c;return i}}),ba.prototype=Object.assign(Object.create(ga.prototype),{constructor:ba,interpolate_:function(e){return this.copySampleValue_(e-1)}});var Sa={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Ta(e,t,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var _a=new Ta;function Ma(e){this.manager=void 0!==e?e:_a,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Ma.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var Ea={};function Aa(e){Ma.call(this,e)}function Ra(e){Ma.call(this,e)}function Ca(e){Ma.call(this,e)}function Oa(e){Ma.call(this,e)}function Pa(){}function La(e){Ma.call(this,e)}function za(){this.type="Curve",this.arcLengthDivisions=200}function Fa(e,t,n,r,i,o,a,s){za.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Ia(e,t,n,r,i,o){Fa.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function Da(){var e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){var l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,c=(n-t)/a-(r-t)/(a+s)+(r-n)/s;i(t,n,l*=a,c*=a)},calc:function(i){var o=i*i;return e+t*i+n*o+r*(o*i)}}}Aa.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Aa,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Sa.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;if(void 0===Ea[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);u="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{Ea[e]=[],Ea[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var n=this.response,r=Ea[e];if(delete Ea[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Sa.add(e,n);for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var n=Ea[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var n=Ea[e];delete Ea[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var n=Ea[e];delete Ea[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}Ea[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Ra.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Ra,load:function(e,t,n,r){var i=this,o=new Aa(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=wa.parse(e[n]);t.push(r)}return t}}),Ca.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Ca,load:function(e,t,n,r){var i=this,o=[],a=new sa;a.image=o;var s=new Aa(this.manager);function l(l){s.load(e[l],function(e){var n=i.parse(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(a.minFilter=ge),a.format=n.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else s.load(e,function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=ge),a.format=n.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}),Oa.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Oa,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Sa.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Sa.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),La.prototype=Object.assign(Object.create(Ma.prototype),{constructor:La,load:function(e,t,n,r){var i=new Yt,o=new Oa(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?ze:Fe,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}),Object.assign(za.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(o-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,o=new en,a=[],s=[],l=[],c=new en,u=new cn;for(n=0;n<=e;n++)r=n/e,a[n]=this.getTangentAt(r),a[n].normalize();s[0]=new en,l[0]=new en;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),c.crossVectors(a[n-1],a[n]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(Gt.clamp(a[n-1].dot(a[n]),-1,1)),s[n].applyMatrix4(u.makeRotationAxis(c,i))),l[n].crossVectors(a[n],s[n]);if(!0===t)for(i=Math.acos(Gt.clamp(s[0].dot(s[e]),-1,1)),i/=e,a[0].dot(c.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)s[n].applyMatrix4(u.makeRotationAxis(a[n],i*n)),l[n].crossVectors(a[n],s[n]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Fa.prototype=Object.create(za.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isEllipseCurve=!0,Fa.prototype.getPoint=function(e,t){for(var n=t||new Ht,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*c-p*u+this.aX,l=h*u+p*c+this.aY}return n.set(s,l)},Fa.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Fa.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Fa.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ia.prototype=Object.create(Fa.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isArcCurve=!0;var ka=new en,Ua=new Da,Na=new Da,Ba=new Da;function ja(e,t,n,r){za.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Ga(e,t,n,r,i){var o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function Ha(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Va(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Wa(e,t,n,r){za.call(this),this.type="CubicBezierCurve",this.v0=e||new Ht,this.v1=t||new Ht,this.v2=n||new Ht,this.v3=r||new Ht}function qa(e,t,n,r){za.call(this),this.type="CubicBezierCurve3",this.v0=e||new en,this.v1=t||new en,this.v2=n||new en,this.v3=r||new en}function Ya(e,t){za.call(this),this.type="LineCurve",this.v1=e||new Ht,this.v2=t||new Ht}function Xa(e,t){za.call(this),this.type="LineCurve3",this.v1=e||new en,this.v2=t||new en}function Za(e,t,n){za.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ht,this.v1=t||new Ht,this.v2=n||new Ht}function Ja(e,t,n){za.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new en,this.v1=t||new en,this.v2=n||new en}function Ka(e){za.call(this),this.type="SplineCurve",this.points=e||[]}ja.prototype=Object.create(za.prototype),ja.prototype.constructor=ja,ja.prototype.isCatmullRomCurve3=!0,ja.prototype.getPoint=function(e,t){var n,r,i,o,a=t||new en,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?n=s[(u-1)%l]:(ka.subVectors(s[0],s[1]).add(s[0]),n=ka),r=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?o=s[(u+2)%l]:(ka.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=ka),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(n.distanceToSquared(r),p),f=Math.pow(r.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Ua.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,d,f,m),Na.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,d,f,m),Ba.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(Ua.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Na.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Ba.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(Ua.calc(h),Na.calc(h),Ba.calc(h)),a},ja.prototype.copy=function(e){za.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ja.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},ja.prototype.fromJSON=function(e){za.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new en).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Wa.prototype=Object.create(za.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isCubicBezierCurve=!0,Wa.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Va(e,r.x,i.x,o.x,a.x),Va(e,r.y,i.y,o.y,a.y)),n},Wa.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Wa.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Wa.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},qa.prototype=Object.create(za.prototype),qa.prototype.constructor=qa,qa.prototype.isCubicBezierCurve3=!0,qa.prototype.getPoint=function(e,t){var n=t||new en,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Va(e,r.x,i.x,o.x,a.x),Va(e,r.y,i.y,o.y,a.y),Va(e,r.z,i.z,o.z,a.z)),n},qa.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},qa.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},qa.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ya.prototype=Object.create(za.prototype),Ya.prototype.constructor=Ya,Ya.prototype.isLineCurve=!0,Ya.prototype.getPoint=function(e,t){var n=t||new Ht;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ya.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ya.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Ya.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ya.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ya.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Xa.prototype=Object.create(za.prototype),Xa.prototype.constructor=Xa,Xa.prototype.isLineCurve3=!0,Xa.prototype.getPoint=function(e,t){var n=t||new en;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Xa.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Xa.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xa.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xa.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Za.prototype=Object.create(za.prototype),Za.prototype.constructor=Za,Za.prototype.isQuadraticBezierCurve=!0,Za.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.v0,i=this.v1,o=this.v2;return n.set(Ha(e,r.x,i.x,o.x),Ha(e,r.y,i.y,o.y)),n},Za.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Za.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Za.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ja.prototype=Object.create(za.prototype),Ja.prototype.constructor=Ja,Ja.prototype.isQuadraticBezierCurve3=!0,Ja.prototype.getPoint=function(e,t){var n=t||new en,r=this.v0,i=this.v1,o=this.v2;return n.set(Ha(e,r.x,i.x,o.x),Ha(e,r.y,i.y,o.y),Ha(e,r.z,i.z,o.z)),n},Ja.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ja.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ja.prototype.fromJSON=function(e){return za.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ka.prototype=Object.create(za.prototype),Ka.prototype.constructor=Ka,Ka.prototype.isSplineCurve=!0,Ka.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(Ga(a,s.x,l.x,c.x,u.x),Ga(a,s.y,l.y,c.y,u.y)),n},Ka.prototype.copy=function(e){za.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Ka.prototype.toJSON=function(){var e=za.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Ka.prototype.fromJSON=function(e){za.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Ht).fromArray(r))}return this};var Qa=Object.freeze({__proto__:null,ArcCurve:Ia,CatmullRomCurve3:ja,CubicBezierCurve:Wa,CubicBezierCurve3:qa,EllipseCurve:Fa,LineCurve:Ya,LineCurve3:Xa,QuadraticBezierCurve:Za,QuadraticBezierCurve3:Ja,SplineCurve:Ka});function $a(){za.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function es(e){$a.call(this),this.type="Path",this.currentPoint=new Ht,e&&this.setFromPoints(e)}function ts(e){es.call(this,e),this.uuid=Gt.generateUUID(),this.type="Shape",this.holes=[]}function ns(){}function rs(e,t,n,r,i,o){pi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}$a.prototype=Object.assign(Object.create(za.prototype),{constructor:$a,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ya(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(n.push(c),t=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){za.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=za.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){za.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Qa[r.type]).fromJSON(r))}return this}}),es.prototype=Object.assign(Object.create($a.prototype),{constructor:es,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Ya(this.currentPoint.clone(),new Ht(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new Za(this.currentPoint.clone(),new Ht(e,t),new Ht(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){var a=new Wa(this.currentPoint.clone(),new Ht(e,t),new Ht(n,r),new Ht(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){var t=new Ka([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){var l=new Fa(e,t,n,r,i,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this},copy:function(e){return $a.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=$a.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return $a.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),ts.prototype=Object.assign(Object.create(es.prototype),{constructor:ts,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){es.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=es.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){es.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new es).fromJSON(r))}return this}}),rs.prototype=Object.assign(Object.create(pi.prototype),{constructor:rs,isOrthographicCamera:!0,copy:function(e,t){return pi.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=l*this.view.offsetX)+l*this.view.width,s=(a-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}});var is,os={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function as(){Ur.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function ss(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),br.call(this,e,t,n),this.meshPerAttribute=r||1}function ls(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ma.call(this,e),this.options=void 0}function cs(){this.type="ShapePath",this.color=new hr,this.subPaths=[],this.currentPath=null}function us(e){this.type="Font",this.data=e}function hs(e,t,n,r,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,l,c,u,h,p,d,f=new cs;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":a=m[v++]*t+n,s=m[v++]*t+r,f.moveTo(a,s);break;case"l":a=m[v++]*t+n,s=m[v++]*t+r,f.lineTo(a,s);break;case"q":l=m[v++]*t+n,c=m[v++]*t+r,u=m[v++]*t+n,h=m[v++]*t+r,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[v++]*t+n,c=m[v++]*t+r,u=m[v++]*t+n,h=m[v++]*t+r,p=m[v++]*t+n,d=m[v++]*t+r,f.bezierCurveTo(u,h,p,d,l,c)}}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}as.prototype=Object.assign(Object.create(Ur.prototype),{constructor:as,isInstancedBufferGeometry:!0,copy:function(e){return Ur.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Ur.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),ss.prototype=Object.assign(Object.create(br.prototype),{constructor:ss,isInstancedBufferAttribute:!0,copy:function(e){return br.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=br.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),ls.prototype=Object.assign(Object.create(Ma.prototype),{constructor:ls,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Sa.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(n){Sa.add(e,n),t&&t(n),i.manager.itemEnd(e)}).catch(function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}),Object.assign(cs.prototype,{moveTo:function(e,t){return this.currentPath=new es,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new ts;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=t[i],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[i],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0===u)return!0;if(u<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i=ca.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new ts).curves=s.curves,c.push(l),c;var u=!i(o[0].getPoints());u=e?!u:u;var h,p,d=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=e?!a:a)?(!u&&f[v]&&v++,f[v]={s:new ts,p:h},f[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return n(o);if(f.length>1){for(var x=!1,b=[],w=0,S=f.length;w<S;w++)d[w]=[];for(w=0,S=f.length;w<S;w++)for(var T=m[w],_=0;_<T.length;_++){for(var M=T[_],E=!0,A=0;A<f.length;A++)r(M.p,f[A].p)&&(w!==A&&b.push({froms:w,tos:A,hole:_}),E?(E=!1,d[A].push(M)):x=!0);E&&d[w].push(M)}b.length>0&&(x||(m=d))}g=0;for(var R=f.length;g<R;g++){l=f[g].s,c.push(l);for(var C=0,O=(p=m[g]).length;C<O;C++)l.holes.push(p[C].h)}return c}}),Object.assign(us.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,l=0,c=0;c<r.length;c++){var u=r[c];if("\n"===u)s=0,l-=o;else{var h=hs(u,i,s,l,n);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}});var ps={getContext:function(){return void 0===is&&(is=new(window.AudioContext||window.webkitAudioContext)),is},setContext:function(e){is=e}};function ds(){}function fs(){}function ms(e,t,n){fs.call(this,void 0,n);var r=(new hr).set(e),i=(new hr).set(t),o=new en(r.r,r.g,r.b),a=new en(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function vs(e,t){fs.call(this,void 0,t);var n=(new hr).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}ms.prototype=Object.assign(Object.create(fs.prototype),{constructor:ms,isHemisphereLightProbe:!0,copy:function(e){return fs.prototype.copy.call(this,e),this},toJSON:function(e){return fs.prototype.toJSON.call(this,e)}}),vs.prototype=Object.assign(Object.create(fs.prototype),{constructor:vs,isAmbientLightProbe:!0,copy:function(e){return fs.prototype.copy.call(this,e),this},toJSON:function(e){return fs.prototype.toJSON.call(this,e)}});var gs=new cn,ys=new cn;function xs(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new di,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new di,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function bs(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(xs.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(Gt.DEG2RAD*t.fov*.5)/t.zoom;ys.elements[12]=-o,gs.elements[12]=o,n=-s*t.aspect+a,r=s*t.aspect+a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-a,r=s*t.aspect-a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ys),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(gs)}}),Object.assign(bs.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var ws=new en,Ss=new Kt,Ts=new en,_s=new en;function Ms(){An.call(this),this.type="AudioListener",this.context=ps.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bs}function Es(e){An.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Ms.prototype=Object.assign(Object.create(An.prototype),{constructor:Ms,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){An.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ws,Ss,Ts),_s.set(0,0,-1).applyQuaternion(Ss),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ws.x,r),t.positionY.linearRampToValueAtTime(ws.y,r),t.positionZ.linearRampToValueAtTime(ws.z,r),t.forwardX.linearRampToValueAtTime(_s.x,r),t.forwardY.linearRampToValueAtTime(_s.y,r),t.forwardZ.linearRampToValueAtTime(_s.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(ws.x,ws.y,ws.z),t.setOrientation(_s.x,_s.y,_s.z,n.x,n.y,n.z)}}),Es.prototype=Object.assign(Object.create(An.prototype),{constructor:Es,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var As=new en,Rs=new Kt,Cs=new en,Os=new en;function Ps(e){Es.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Ls(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Ps.prototype=Object.assign(Object.create(Es.prototype),{constructor:Ps,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(An.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(As,Rs,Cs),Os.set(0,0,1).applyQuaternion(Rs);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(As.x,n),t.positionY.linearRampToValueAtTime(As.y,n),t.positionZ.linearRampToValueAtTime(As.z,n),t.orientationX.linearRampToValueAtTime(Os.x,n),t.orientationY.linearRampToValueAtTime(Os.y,n),t.orientationZ.linearRampToValueAtTime(Os.z,n)}else t.setPosition(As.x,As.y,As.z),t.setOrientation(Os.x,Os.y,Os.z)}}}),Object.assign(Ls.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}});var zs=new RegExp("[\\[\\]\\.:\\/]","g"),Fs="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Is=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ds=/(WCOD+)?/.source.replace("WCOD",Fs),ks=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Us=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ns=new RegExp("^"+Is+Ds+ks+Us+"$"),Bs=["material","materials","bones"];function js(e,t,n){this.path=t,this.parsedPath=n||js.parseTrackName(t),this.node=js.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Gs(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Hs(e,t,n){ea.call(this,e,t),this.meshPerAttribute=n||1}function Vs(){}function Ws(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function qs(e){An.call(this),this.material=e,this.render=function(){}}Object.assign(js,{Composite:function(){},create:function(e,t,n){return new js(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(zs,"")},parseTrackName:function(e){var t=Ns.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Bs.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var o=r(i.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(js.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=js.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this)}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(js.prototype,{_getValue_unbound:js.prototype.getValue,_setValue_unbound:js.prototype.setValue}),Gs.prototype.clone=function(){return new Gs(void 0===this.value.clone?this.value:this.value.clone())},Hs.prototype=Object.assign(Object.create(ea.prototype),{constructor:Hs,isInstancedInterleavedBuffer:!0,copy:function(e){return ea.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Ws.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Gt.clamp(t/this.radius,-1,1))),this}}),qs.prototype=Object.create(An.prototype),qs.prototype.constructor=qs,qs.prototype.isImmediateRenderObject=!0;new cn,new cn;new hr,new hr;new pi;new rs;function Ys(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom",this.closed=!0}function Xs(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom"}function Zs(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom"}za.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(za.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign($a.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new ri,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new en(i.x,i.y,i.z||0))}return t}}),Object.assign(es.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Ys.prototype=Object.create(ja.prototype),Xs.prototype=Object.create(ja.prototype),Zs.prototype=Object.create(ja.prototype),Object.assign(Zs.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Object.assign(Ma.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),os.extractUrlBase(e)}}),Ma.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Gn.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),wi.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Object.assign(Gt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Gt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Gt.ceilPowerOfTwo(e)}}),Object.assign(Vt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(cn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new en).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)}}),Jn.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Kt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(sr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(sr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),sr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),sr.getNormal(e,t,n,r)}}),Object.assign(ts.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ua(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new pa(this,e)}}),Object.assign(Ht.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(en.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Xt.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ri.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(An.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(An.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Jr.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Jr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(oa.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(aa.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(za.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),di.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ns.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(br.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(br.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:kt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ur.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new br(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Ur.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Vs.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(ea.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ea.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:kt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.defineProperties(Gs.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(gr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new hr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(fa.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(hi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign($o.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties($o.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:Pt}}}),Object.defineProperties(Xo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Zt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Es.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new ds).load(e,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Ls.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},vi.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Js={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Wt.crossOrigin=void 0,Wt.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new La;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Wt.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Pa;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Wt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Ks={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"114"}}));var Qs=Object.freeze({__proto__:null,ACESFilmicToneMapping:5,AddEquation:U,AddOperation:2,AdditiveBlending:F,AlphaFormat:Le,AlwaysDepth:te,AlwaysStencilFunc:Dt,AmbientLight:function(){},AmbientLightProbe:vs,AnimationClip:wa,AnimationLoader:Ra,AnimationMixer:function(){},AnimationObjectGroup:function(){},AnimationUtils:va,ArcCurve:Ia,ArrayCamera:function(){},ArrowHelper:function(){},Audio:Es,AudioAnalyser:Ls,AudioContext:ps,AudioListener:Ms,AudioLoader:ds,AxesHelper:function(){},AxisHelper:function(){},BackSide:O,BasicDepthPacking:Lt,BasicShadowMap:0,BinaryTextureLoader:function(){},Bone:function(){},BooleanKeyframeTrack:function(){},BoundingBoxHelper:function(){},Box2:function(){},Box3:Gn,Box3Helper:function(){},BoxBufferGeometry:oi,BoxGeometry:ii,BoxHelper:function(){},BufferAttribute:br,BufferGeometry:Ur,BufferGeometryLoader:function(){},ByteType:we,Cache:Sa,Camera:pi,CameraHelper:function(){},CanvasRenderer:function(){},CanvasTexture:function(){},CatmullRomCurve3:ja,CineonToneMapping:4,CircleBufferGeometry:function(){},CircleGeometry:function(){},ClampToEdgeWrapping:pe,Clock:bs,ClosedSplineCurve3:Ys,Color:hr,ColorKeyframeTrack:function(){},CompressedTexture:sa,CompressedTextureLoader:Ca,ConeBufferGeometry:function(){},ConeGeometry:function(){},CubeCamera:vi,CubeGeometry:ii,CubeReflectionMapping:301,CubeRefractionMapping:302,CubeTexture:Ri,CubeTextureLoader:Pa,CubeUVReflectionMapping:ue,CubeUVRefractionMapping:307,CubicBezierCurve:Wa,CubicBezierCurve3:qa,CubicInterpolant:ya,CullFaceBack:A,CullFaceFront:R,CullFaceFrontBack:3,CullFaceNone:E,Curve:za,CurvePath:$a,CustomBlending:k,CylinderBufferGeometry:function(){},CylinderGeometry:function(){},Cylindrical:function(){},DataTexture:yi,DataTexture2DArray:Ci,DataTexture3D:Oi,DataTextureLoader:function(){},DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:_a,DepthFormat:Ue,DepthStencilFormat:Ne,DepthTexture:la,DirectionalLight:function(){},DirectionalLightHelper:function(){},DirectionalLightShadow:function(){},DiscreteInterpolant:ba,DodecahedronBufferGeometry:function(){},DodecahedronGeometry:function(){},DoubleSide:P,DstAlphaFactor:Z,DstColorFactor:K,DynamicBufferAttribute:function(){},DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:function(){},EdgesHelper:function(){},EllipseCurve:Fa,EqualDepth:ie,EqualStencilFunc:514,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,Euler:pn,EventDispatcher:Ut,ExtrudeBufferGeometry:function(){},ExtrudeGeometry:ua,Face3:mr,Face4:function(e,t,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new mr(e,t,n,i,o,a)},FaceColors:1,FileLoader:Aa,FlatShading:1,Float32Attribute:function(){},Float32BufferAttribute:Rr,Float64Attribute:function(){},Float64BufferAttribute:Cr,FloatType:Ee,Fog:function(){},FogExp2:function(){},Font:us,FontLoader:function(){},FrontFaceDirectionCCW:1,FrontFaceDirectionCW:0,FrontSide:C,Frustum:wi,GammaEncoding:3007,Geometry:ri,GeometryUtils:Js,GreaterDepth:ae,GreaterEqualDepth:oe,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:function(){},Group:Ko,HalfFloatType:Ae,HemisphereLight:function(){},HemisphereLightHelper:function(){},HemisphereLightProbe:ms,IcosahedronBufferGeometry:function(){},IcosahedronGeometry:function(){},ImageBitmapLoader:ls,ImageLoader:Oa,ImageUtils:Wt,ImmediateRenderObject:qs,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:ss,InstancedBufferGeometry:as,InstancedInterleavedBuffer:Hs,InstancedMesh:function(){},Int16Attribute:function(){},Int16BufferAttribute:_r,Int32Attribute:function(){},Int32BufferAttribute:Er,Int8Attribute:function(){},Int8BufferAttribute:wr,IntType:_e,InterleavedBuffer:ea,InterleavedBufferAttribute:na,Interpolant:ga,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,InvertStencilOp:5386,JSONLoader:function(){},KeepStencilOp:It,KeyframeTrack:function(){},LOD:oa,LatheBufferGeometry:function(){},LatheGeometry:function(){},Layers:dn,LensFlare:function(){},LessDepth:ne,LessEqualDepth:re,LessEqualStencilFunc:515,LessStencilFunc:513,Light:ns,LightProbe:fs,LightShadow:function(){},Line:function(){},Line3:function(){},LineBasicMaterial:function(){},LineCurve:Ya,LineCurve3:Xa,LineDashedMaterial:function(){},LineLoop:function(){},LinePieces:1,LineSegments:function(){},LineStrip:0,LinearEncoding:Pt,LinearFilter:ge,LinearInterpolant:xa,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:xe,LinearMipmapNearestFilter:ye,LinearToneMapping:ce,Loader:Ma,LoaderUtils:os,LoadingManager:Ta,LogLuvEncoding:3003,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:De,LuminanceFormat:Ie,MOUSE:_,Material:gr,MaterialLoader:function(){},Math:Gt,MathUtils:Gt,Matrix3:Vt,Matrix4:cn,MaxEquation:G,Mesh:Jr,MeshBasicMaterial:yr,MeshDepthMaterial:Yo,MeshDistanceMaterial:function(){},MeshFaceMaterial:function(){},MeshLambertMaterial:function(){},MeshMatcapMaterial:ma,MeshNormalMaterial:function(){},MeshPhongMaterial:fa,MeshPhysicalMaterial:function(){},MeshStandardMaterial:function(){},MeshToonMaterial:function(){},MinEquation:j,MirroredRepeatWrapping:de,MixOperation:1,MultiMaterial:function(){},MultiplyBlending:D,MultiplyOperation:0,NearestFilter:fe,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:ve,NearestMipmapNearestFilter:me,NeverDepth:ee,NeverStencilFunc:512,NoBlending:L,NoColors:0,NoToneMapping:le,NormalBlending:z,NotEqualDepth:se,NotEqualStencilFunc:517,NumberKeyframeTrack:function(){},Object3D:An,ObjectLoader:function(){},ObjectSpaceNormalMap:Ft,OctahedronBufferGeometry:function(){},OctahedronGeometry:function(){},OneFactor:V,OneMinusDstAlphaFactor:J,OneMinusDstColorFactor:Q,OneMinusSrcAlphaFactor:X,OneMinusSrcColorFactor:q,OrthographicCamera:rs,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:function(){},ParametricBufferGeometry:function(){},ParametricGeometry:function(){},Particle:function(){},ParticleBasicMaterial:function(){},ParticleSystem:function(){},ParticleSystemMaterial:function(){},Path:es,PerspectiveCamera:di,Plane:Jn,PlaneBufferGeometry:_i,PlaneGeometry:function(){},PlaneHelper:function(){},PointCloud:function(){},PointCloudMaterial:function(){},PointLight:function(){},PointLightHelper:function(){},Points:function(){},PointsMaterial:function(){},PolarGridHelper:function(){},PolyhedronBufferGeometry:function(){},PolyhedronGeometry:function(){},PositionalAudio:Ps,PropertyBinding:js,PropertyMixer:function(){},QuadraticBezierCurve:Za,QuadraticBezierCurve3:Ja,Quaternion:Kt,QuaternionKeyframeTrack:function(){},QuaternionLinearInterpolant:function(){},REVISION:"114",RGBADepthPacking:3201,RGBAFormat:Fe,RGBAIntegerFormat:We,RGBA_ASTC_10x10_Format:ft,RGBA_ASTC_10x5_Format:ht,RGBA_ASTC_10x6_Format:pt,RGBA_ASTC_10x8_Format:dt,RGBA_ASTC_12x10_Format:mt,RGBA_ASTC_12x12_Format:vt,RGBA_ASTC_4x4_Format:rt,RGBA_ASTC_5x4_Format:it,RGBA_ASTC_5x5_Format:ot,RGBA_ASTC_6x5_Format:at,RGBA_ASTC_6x6_Format:st,RGBA_ASTC_8x5_Format:lt,RGBA_ASTC_8x6_Format:ct,RGBA_ASTC_8x8_Format:ut,RGBA_ETC2_EAC_Format:nt,RGBA_PVRTC_2BPPV1_Format:$e,RGBA_PVRTC_4BPPV1_Format:Qe,RGBA_S3TC_DXT1_Format:Ye,RGBA_S3TC_DXT3_Format:Xe,RGBA_S3TC_DXT5_Format:Ze,RGBDEncoding:3006,RGBEEncoding:3002,RGBEFormat:ke,RGBFormat:ze,RGBIntegerFormat:Ve,RGBM16Encoding:3005,RGBM7Encoding:3004,RGB_ETC1_Format:et,RGB_ETC2_Format:tt,RGB_PVRTC_2BPPV1_Format:Ke,RGB_PVRTC_4BPPV1_Format:Je,RGB_S3TC_DXT1_Format:qe,RGFormat:Ge,RGIntegerFormat:He,RawShaderMaterial:da,Ray:qn,Raycaster:Vs,RectAreaLight:function(){},RedFormat:Be,RedIntegerFormat:je,ReinhardToneMapping:2,RepeatWrapping:he,ReplaceStencilOp:7681,ReverseSubtractEquation:B,RingBufferGeometry:function(){},RingGeometry:function(){},SRGB8_ALPHA8_ASTC_10x10_Format:Rt,SRGB8_ALPHA8_ASTC_10x5_Format:Mt,SRGB8_ALPHA8_ASTC_10x6_Format:Et,SRGB8_ALPHA8_ASTC_10x8_Format:At,SRGB8_ALPHA8_ASTC_12x10_Format:Ct,SRGB8_ALPHA8_ASTC_12x12_Format:Ot,SRGB8_ALPHA8_ASTC_4x4_Format:gt,SRGB8_ALPHA8_ASTC_5x4_Format:yt,SRGB8_ALPHA8_ASTC_5x5_Format:xt,SRGB8_ALPHA8_ASTC_6x5_Format:bt,SRGB8_ALPHA8_ASTC_6x6_Format:wt,SRGB8_ALPHA8_ASTC_8x5_Format:St,SRGB8_ALPHA8_ASTC_8x6_Format:Tt,SRGB8_ALPHA8_ASTC_8x8_Format:_t,Scene:Rn,SceneUtils:Ks,ShaderChunk:Mi,ShaderLib:Ei,ShaderMaterial:hi,ShadowMaterial:function(){},Shape:ts,ShapeBufferGeometry:function(){},ShapeGeometry:pa,ShapePath:cs,ShapeUtils:ca,ShortType:Se,Skeleton:aa,SkeletonHelper:function(){},SkinnedMesh:function(){},SmoothShading:2,Sphere:Wn,SphereBufferGeometry:ha,SphereGeometry:function(){},Spherical:Ws,SphericalHarmonics3:function(){},SphericalReflectionMapping:305,Spline:Zs,SplineCurve:Ka,SplineCurve3:Xs,SpotLight:function(){},SpotLightHelper:function(){},SpotLightShadow:function(){},Sprite:function(){},SpriteMaterial:function(){},SrcAlphaFactor:Y,SrcAlphaSaturateFactor:$,SrcColorFactor:W,StaticCopyUsage:35046,StaticDrawUsage:kt,StaticReadUsage:35045,StereoCamera:xs,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:function(){},SubtractEquation:N,SubtractiveBlending:I,TOUCH:M,TangentSpaceNormalMap:zt,TetrahedronBufferGeometry:function(){},TetrahedronGeometry:function(){},TextBufferGeometry:function(){},TextGeometry:function(){},Texture:Yt,TextureLoader:La,TorusBufferGeometry:function(){},TorusGeometry:function(){},TorusKnotBufferGeometry:function(){},TorusKnotGeometry:function(){},Triangle:sr,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:function(){},TubeGeometry:function(){},UVMapping:300,Uint16Attribute:function(){},Uint16BufferAttribute:Mr,Uint32Attribute:function(){},Uint32BufferAttribute:Ar,Uint8Attribute:function(){},Uint8BufferAttribute:Sr,Uint8ClampedAttribute:function(){},Uint8ClampedBufferAttribute:Tr,Uncharted2ToneMapping:3,Uniform:Gs,UniformsLib:Si,UniformsUtils:li,UnsignedByteType:be,UnsignedInt248Type:Pe,UnsignedIntType:Me,UnsignedShort4444Type:Re,UnsignedShort5551Type:Ce,UnsignedShort565Type:Oe,UnsignedShortType:Te,VSMShadowMap:3,Vector2:Ht,Vector3:en,Vector4:Xt,VectorKeyframeTrack:function(){},Vertex:function(){},VertexColors:2,VideoTexture:function(){},WebGLCubeRenderTarget:gi,WebGLMultisampleRenderTarget:Jt,WebGLRenderTarget:Zt,WebGLRenderTargetCube:function(){},WebGLRenderer:$o,WebGLUtils:Jo,WireframeGeometry:function(){},WireframeHelper:function(){},WrapAroundEnding:2402,XHRLoader:function(){},ZeroCurvatureEnding:2400,ZeroFactor:H,ZeroSlopeEnding:2401,ZeroStencilOp:0,sRGBEncoding:3001});cn.prototype.getInverse=function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],x=r[15],b=i*c,w=i*d,S=i*g,T=i*u,_=l*o,M=l*d,E=l*g,A=l*a,R=p*o,C=p*c,O=p*g,P=p*a,L=p*u,z=v*d,F=v*f,I=v*s,D=v*m,k=o*u,U=o*h,N=c*a,B=c*f,j=d*a,G=d*u,H=d*y,V=g*a,W=g*u,q=g*f,Y=f*x,X=y*s,Z=y*h,J=y*m,K=d*Z-q*h+W*m-c*J-G*x+c*Y,Q=F*h-p*Z-D*u+l*J+L*x-l*Y,$=O*h-z*h+D*c-E*m-C*x+M*x,ee=v*G-p*W-F*c+l*q+C*y-M*y,te=i*K+o*Q+a*$+s*ee;if(0===te){var ne="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(ne);return console.warn(ne),this.identity()}return n[0]=K,n[1]=q*s-H*s-V*m+o*J+j*x-o*Y,n[2]=c*X-W*s+V*h-o*Z-N*x+k*x,n[3]=G*s-B*s-j*h+U*f+N*m-k*m,n[4]=Q,n[5]=p*X-F*s+D*a-i*J-P*x+i*Y,n[6]=I*u-l*X-v*a*h+i*Z+A*x-T*x,n[7]=l*f*s-L*s+P*h-i*f*h-A*m+T*m,n[8]=$,n[9]=z*s-O*s-D*o+S*m+R*x-w*x,n[10]=E*s-I*c+v*U-S*h-_*x+b*x,n[11]=C*s-M*s-p*U+w*h+_*m-b*m,n[12]=ee,n[13]=O*a-z*a+F*o-i*q-R*y+i*H,n[14]=v*N-E*a-v*k+i*W+_*y-b*y,n[15]=M*a-C*a+L*o-i*G-_*f+i*B,this.multiplyScalar(1/te)};var $s=Math.PI/180,el=180/Math.PI;function tl(e){var t=nl(e[0]+1,e[2]);return[nl(e[0],e[2]),rl(e[1]+1,e[2]),t,rl(e[1],e[2])]}function nl(e,t){return e/Math.pow(2,t)*360-180}function rl(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return el*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function il(e,t,n){var r=ul(e,t,n);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function ol(e){return[[2*e[0],2*e[1],e[2]+1],[2*e[0]+1,2*e[1],e[2]+1],[2*e[0]+1,2*e[1]+1,e[2]+1],[2*e[0],2*e[1]+1,e[2]+1]]}function al(e){return e[0]%2==0&&e[1]%2==0?[e[0]/2,e[1]/2,e[2]-1]:e[0]%2==0&&!e[1]%2==0?[e[0]/2,(e[1]-1)/2,e[2]-1]:!e[0]%2==0&&e[1]%2==0?[(e[0]-1)/2,e[1]/2,e[2]-1]:[(e[0]-1)/2,(e[1]-1)/2,e[2]-1]}function sl(e){return ol(al(e))}function ll(e,t){for(var n=0;n<e.length;n++)if(cl(e[n],t))return!0;return!1}function cl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ul(e,t,n){var r=Math.sin(t*$s),i=Math.pow(2,n);return[i*(e/360+.5),i*(.5-.25*Math.log((1+r)/(1-r))/Math.PI),n]}var hl={tileToGeoJSON:function(e){var t=tl(e);return{type:"Polygon",coordinates:[[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]]}},tileToBBOX:tl,getChildren:ol,getParent:al,getSiblings:sl,hasTile:ll,hasSiblings:function(e,t){for(var n=sl(e),r=0;r<n.length;r++)if(!ll(t,n[r]))return!1;return!0},tilesEqual:cl,tileToQuadkey:function(e){for(var t="",n=e[2];n>0;n--){var r=0,i=1<<n-1;0!=(e[0]&i)&&r++,0!=(e[1]&i)&&(r+=2),t+=r.toString()}return t},quadkeyToTile:function(e){for(var t=0,n=0,r=e.length,i=r;i>0;i--){var o=1<<i-1,a=+e[r-i];1===a&&(t|=o),2===a&&(n|=o),3===a&&(t|=o,n|=o)}return[t,n,r]},pointToTile:il,bboxToTile:function(e){var t=il(e[0],e[1],32),n=il(e[2],e[3],32),r=[t[0],t[1],n[0],n[1]],i=function(e){for(var t=0;t<28;t++){var n=1<<32-(t+1);if((e[0]&n)!=(e[2]&n)||(e[1]&n)!=(e[3]&n))return t}return 28}(r);return 0===i?[0,0,0]:[r[0]>>>32-i,r[1]>>>32-i,i]},pointToTileFraction:ul},pl={center:new Qs.Vector2(0,0),center3035:new Qs.Vector2(0,0),projector:null,calculateGlobalOffset:function(e,t){const[n,r,i]=hl.pointToTileFraction(e,t,7),o=Math.pow(2,15-i)*pl.calculateSceneScale(e,t);return new Qs.Vector2(-n,r).multiplyScalar(o)},calculateSceneScale:function(e,t){var n=hl.pointToTile(e,t,15),r=hl.tileToBBOX(n);return pl.project([r[2],r[3]]).sub(pl.project([r[0],r[1]])).x},project:function(e,t){if("number"!=typeof e[0])return e.map(function(e){return pl.project(e,t)});var n=pl.projector.forward(e);return t||(n[0]-=pl.center.x,n[1]-=pl.center.y),new Qs.Vector3(n[0],n[1],e[2])},unproject:function(e,t){if(Array.isArray(e))return e.map(function(e){return pl.unproject(e,t)});var n=[e.x,e.y];t||(n[0]+=pl.center.x,n[1]+=pl.center.y);var r=pl.projector.inverse(n);return[r[0],r[1],e.z]},unproject3035:function(e,t){if(Array.isArray(e[0]))return e.map(function(e){return pl.unproject3035(e,t)});var n=[e[0],e[1]];t||(n[0]+=pl.center3035.x,n[1]+=pl.center3035.y);var r=pl.projector3035.inverse(n);return[r[0],r[1],e.z]},vectorize:function(e){if("number"!=typeof e[0]){for(var t=new Array(e.length),n=0,r=e.length;n<r;n++)t[n]=pl.vectorize(e[n]);return t}return new Qs.Vector3(e[0],e[1],e[2])},vectorizeFeature:function(e){return e.projected?pl.vectorize(e.geometry.coordinates):pl.project(e.geometry.coordinates)}};let dl;var fl=dl={event:()=>{},timing:()=>{},onload:null,now:()=>0};function ml(){this.bindListeners({clearFeatures:s.setCurrentPlace,setFeatures:h.setFeatures}),this.clearFeatures()}ml.prototype.clearFeatures=function(){return this.buildings=[],this.forests=[],this.highways=[],this.lifts=[],this.peaks=[],this.places=[],this.pistes=[],this.lakes=[],this.rivers=[],this.unknown=[],!1},ml.prototype.classify=function(e){if(T.isLineString(e))return T.hasTag(e,"piste:type")?this.pistes:T.hasTag(e,"highway")?this.highways:T.hasTag(e,"waterway")?this.rivers:T.hasTag(e,"aerialway")?this.lifts:this.pistes;if(T.isPolygon(e)){return T.hasTag(e,"building")?this.buildings:"water"===T.tagValue(e,"natural")?this.lakes:"riverbank"===T.tagValue(e,"waterway")?this.lakes:this.forests}else{if(T.isMultiPolygon(e))return this.forests;if(T.isPoint(e)){var t=e.properties.tags;return"peak"===t.natural&&t.name?this.peaks:t.place?this.places:this.unknown}}return this.unknown},ml.prototype.normalize=function(e){if(void 0!==e.properties.tags){var t=e.properties,n=t.tags;delete t.tags,n.name&&(t.name=n.name),"peak"===n.natural?(t.icon="caret-up",t.fadeDistance=1e4,n.ele&&t.name&&(t.name+=" - "+n.ele+"m")):n.place&&(t.icon="dot-circle-o",t.fadeDistance=15e3),t.collapseDistance=.5*t.fadeDistance,t.priority=-10,t.borderRadius=20,t.background="rgba(0, 0, 0, 0.6)",t.color="#fff",t.clipping="object",t.anchor="left",t.padding=2}},ml.prototype.setFeatures=function(e){for(var t,n=!!e.crs,r=fl.now();e.features.length>0;)t=e.features.pop(),n&&(t.geometry.coordinates=pl.unproject3035(t.geometry.coordinates)),void 0===t.projected&&(t.projected=!1),this.classify(t).push(t);this.peaks.forEach(this.normalize.bind(this)),this.places.forEach(this.normalize.bind(this));var i=fl.now()-r;fl.timing("geodata","classify","osm",i)},ml.displayName="OSMAdapter";var vl=o.createStore(ml);function gl(){this.bindListeners({addBuiltinOverlay:h.addBuiltinOverlay,addOverlay:h.addOverlay,updateOverlay:h.updateOverlay,featureCreated:a.featureCreated,removeOverlay:h.removeOverlay,setFeatures:h.setFeatures}),this.overlays={},this.overlayTracker={},this.builtinOverlays=[],this.supportedBuiltinOverlays=["lifts","peaks","pistes","places"],this.referenceOnlyBuiltinOverlays=["lifts","pistes"],this.lines=[],this.markers=[]}gl.prototype.classify=function(e){return T.isLineString(e)?this.lines:T.isPoint(e)?this.markers:null},gl.prototype.removeFeature=function(e){var t=this.classify(e);if(null!==t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},gl.prototype.addOverlay=function(e){var t=-1!==this.builtinOverlays.indexOf(e.name);this.removeOverlay(e.name),t&&this.builtinOverlays.unshift(e.name),void 0===e.name&&(e.name="____default____"),this.overlays[e.name]=e;for(var n,r=e.features.concat(),o=fl.now();r.length>0;){n=r.pop(),e.defaults&&e.defaults.properties&&i.defaults(n.properties,e.defaults.properties),void 0===n.projected&&(n.projected=!1);var a=this.classify(n);a&&(a.push(n),n.overlayName=e.name,this.featureClassified(n))}var s=fl.now()-o;fl.timing("geodata","classify","overlay",s)},gl.prototype.updateOverlay=function(e){if(!(void 0!==this.overlays[e.name]))return console.error(name+" overlay has not been added, so cannot be updated"),!1;var t=e.features,n=this.overlays[e.name].features,r=t.length,i=n.length;if(r!==i)return console.error("Tried to call updateOverlay on overlay "+e.name+", but number of features does not match. Original: "+i+", new: "+r),!1;for(var o=!!e.crs,a=0;a<r;a++){var s=n[a],l=t[a];s.projected=void 0===l.projected?o:l.projected,s.geometry.coordinates=l.geometry.coordinates}},gl.prototype.addBuiltinOverlay=function(e){Array.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;t++){var r=e[t],i=this.supportedBuiltinOverlays.indexOf(r);if(-1===i)return console.error(r+" is not a supported built-in overlay"),!1;-1===(i=this.builtinOverlays.indexOf(r))&&this.builtinOverlays.push(r)}return this.updateBuiltinOverlays()},gl.prototype.updateBuiltinOverlays=function(){this.waitFor(vl);for(var e=vl.getState(),t=0,n=this.builtinOverlays.length;t<n;t++){var r=this.builtinOverlays[t];-1===this.referenceOnlyBuiltinOverlays.indexOf(r)&&this.addOverlay({name:r,type:"FeatureCollection",features:e[r]})}},gl.prototype.setFeatures=function(){return this.updateBuiltinOverlays()},gl.prototype.removeOverlay=function(e){void 0===e&&(e=["____default____"]),Array.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;t++){var r=e[t],i=this.builtinOverlays.indexOf(r);if(-1!==i&&this.builtinOverlays.splice(i,1),void 0!==this.overlays[r]){for(var o=this.overlays[r],a=0,s=o.features.length;a<s;a++)this.removeFeature(o.features[a]);delete this.overlays[r]}}},gl.prototype.featureClassified=function(e){void 0===this.overlayTracker[e.overlayName]?this.overlayTracker[e.overlayName]=1:this.overlayTracker[e.overlayName]+=1},gl.prototype.featureCreated=function(e){if(void 0===this.overlayTracker[e.overlayName])return!1;if(this.overlayTracker[e.overlayName]-=1,0===this.overlayTracker[e.overlayName]){var t=e.overlayName;delete this.overlayTracker[e.overlayName],b(function(){a.overlayDisplayed(t)})}delete e.overlayName},gl.displayName="OverlayAdapter";var yl=o.createStore(gl);function xl(){this.paused=!1,this.time=0,this.bindListeners({play:a.play,pause:a.pause});const e=t=>{window.requestAnimationFrame(e),this.paused||(this.time=t,this.emitChange())};window.requestAnimationFrame(e)}xl.prototype.play=function(){return this.paused=!1,!1},xl.prototype.pause=function(){return this.paused=!0,!1},xl.displayName="AnimationStore";var bl=o.createStore(xl),wl=o.generateActions("panToPosition","setPosition","toggleTracking");function Sl(){this.needsRender=!1,this.animating=!1,this.env=!1,this.clock=new Qs.Clock,this.bindListeners({scheduleRender:[wl.panToPosition,wl.setPosition,h.addBuiltinOverlay,h.addOverlay,h.setFeatures,h.setImageryBig,a.containerMounted,a.containerResized,a.needsRender,a.setHD,s.featureSelected,s.focusOnLocation,s.inputEnded,s.setCameraMode,s.setCamera,s.setCameraTarget,s.setCameraPosition,s.setTerrainEffectContours,s.setTerrainEffectFlats,s.setTerrainEffectGrade,s.setTerrainEffectHeight,s.setTerrainEffectNone],scheduleRenderAnimated:h.updateOverlay}),bl.listen(this.tick.bind(this))}Sl.prototype.scheduleRender=function(e){return e&&(e.animating&&(this.animating=!0),e.env&&(this.env=!0)),this.needsRender=!0,!1},Sl.prototype.scheduleRenderAnimated=function(){return this.scheduleRender({animating:!0})},console.warn("Need to fix controls&render loop"),Sl.prototype.tick=function(){this.needsRender&&(this.clock.getElapsedTime(),this.emitChange()),this.animating=!1,this.env=!1},Sl.displayName="RenderStore";var Tl=o.createStore(Sl),_l=document.createElement("canvas"),Ml=_l.getContext("webgl")||_l.getContext("experimental-webgl");_l=void 0;var El=function(e,t){var n=Ml.createShader(e);if(Ml.shaderSource(n,t),Ml.compileShader(n),!Ml.getShaderParameter(n,Ml.COMPILE_STATUS)){var r=Ml.getShaderInfoLog(n);return console.error("Error compiling shader:\n\n",t,r),null}return n},Al=function(e,t){var n=Ml.createProgram(),r=Ml.attachShader(n,El(Ml.VERTEX_SHADER,e)),i=Ml.attachShader(n,El(Ml.FRAGMENT_SHADER,t));if(Ml.linkProgram(n),!Ml.getProgramParameter(n,Ml.LINK_STATUS)){var o=Ml.getProgramInfoLog(n);return console.error("Error linking program",n,o),null}return Ml.deleteShader(r),Ml.deleteShader(i),n},Rl=null!==Ml?Ml.getSupportedExtensions():[],Cl=["ANGLE_instanced_arrays","OES_standard_derivatives"].filter(function(e){return-1===Rl.indexOf(e)}),Ol=["WEBGL_depth_texture"].filter(function(e){return-1===Rl.indexOf(e)});fl.onload=function(){if(fl.event("webgl","supported",Pl.supported?"yes":"no"),fl.event("webgl","render_565",Pl.render565?"yes":"no"),Pl.missing.length>0)for(var e=0;e<Pl.missing.length;e++)fl.event("webgl","missing_extension",Pl.missing[e]);if(Pl.missingOptional.length>0)for(e=0;e<Pl.missingOptional.length;e++)fl.event("webgl","missing_optional_extension",Pl.missingOptional[e])};var Pl={supported:null!==Ml,supports:function(e){return-1!==Rl.indexOf(e)},extensions:Rl,render565:!1,s3tc:!1,pvrtc:!1,missing:Cl,missingOptional:Ol,workers:!!window.Worker};if(Pl.supported){var Ll=Al("void main() { gl_Position = vec4( 1.0, 1.0, 1.0, 1.0); }","precision mediump float; uniform sampler2D uiiii_tex; void main() { gl_FragColor = texture2D( uiiii_tex, vec2( 0.5, 0.5 ) ); }");Pl.render565=function(e,t){var n,r,i=!1;try{if(e&&!Ml.getExtension(e))return!1;n=Ml.createTexture(),Ml.bindTexture(Ml.TEXTURE_2D,n),Ml.texImage2D(Ml.TEXTURE_2D,0,Ml.RGB,1,1,0,Ml.RGB,t,null),Ml.texParameteri(Ml.TEXTURE_2D,Ml.TEXTURE_MIN_FILTER,Ml.NEAREST),Ml.texParameteri(Ml.TEXTURE_2D,Ml.TEXTURE_MAG_FILTER,Ml.NEAREST),r=Ml.createFramebuffer(),Ml.bindFramebuffer(Ml.FRAMEBUFFER,r),Ml.framebufferTexture2D(Ml.FRAMEBUFFER,Ml.COLOR_ATTACHMENT0,Ml.TEXTURE_2D,n,0),i=Ml.checkFramebufferStatus(Ml.FRAMEBUFFER)===Ml.FRAMEBUFFER_COMPLETE}catch(e){i=!1}finally{n&&Ml.deleteTexture(n),r&&Ml.deleteFramebuffer(r)}return i}(null,Ml.UNSIGNED_SHORT_5_6_5),Ml.deleteProgram(Ll),Ll=void 0;var zl=Ml.getExtension("WEBGL_compressed_texture_s3tc")||Ml.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ml.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Fl=Ml.getExtension("WEBGL_compressed_texture_pvrtc")||Ml.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");Pl.s3tc=null!==zl,Pl.pvrtc=null!==Fl,Pl.depthTexture=Pl.supports("WEBGL_depth_texture")}function Il(){this.width=256,this.height=256,this.lastResize=0,this.renderRatio=1,this.renderWidth=256,this.renderHeight=256,this.pixelRatio=window.devicePixelRatio,this.canvasWidth=256,this.canvasHeight=256,this.aspect=1,this.fov=70,this.lodScale=10,this.hd=!0,this.forceHd=!1,this.lowDefMove=Pl.depthTexture,this.lowDefScale=1,this.element=document.createElement("div"),this.element.style.position="relative",this.element.style.width="100%",this.element.style.height="100%",this.bindListeners({containerResized:[a.containerResized,a.containerMounted],featureSelected:s.featureSelected,setFieldOfView:a.setFieldOfView,forceHD:a.forceHD,setHD:a.setHD,setSize:a.setSize,inputStarted:s.inputStarted,inputEnded:s.inputEnded}),this.exportPublicMethods({toClipSpace:this.toClipSpace.bind(this),fromClipSpace:this.fromClipSpace.bind(this),flipY:this.flipY.bind(this)});var e=this;bl.listen(function(){if(0!==e.element.offsetWidth&&0!==e.element.offsetHeight){var t=e.element.getBoundingClientRect();t.width/t.height===e.aspect&&e.element.offsetWidth===e.width&&e.element.offsetHeight===e.height||a.containerResized()}})}Il.prototype.containerResized=function(){if(this.element.offsetWidth>0&&this.element.offsetHeight>0){var e=this.element.getBoundingClientRect();this.aspect=e.width/e.height,this.setSize({width:this.element.offsetWidth,height:this.element.offsetHeight}),this.lastResize=Tl.getState().clock.getElapsedTime()}},Il.prototype.featureSelected=function(e){return this.element.style.cursor=e?"pointer":"auto",!1},Il.prototype.updateSizes=function(){this.renderWidth=this.width*this.renderRatio,this.renderHeight=this.height*this.renderRatio,this.pixelRatio=Pl.depthTexture?window.devicePixelRatio:this.renderRatio,this.canvasWidth=this.width*this.pixelRatio,this.canvasHeight=this.height*this.pixelRatio},Il.prototype.getRenderRatio=function(){if(!Pl.depthTexture)return 1;for(var e=[1,1.2,1.5,2],t=0,n=this,r=function(t){return e[t]*n.width*e[t]*n.height};e[t+1]&&r(t+1)<15e5;)t++;return e[t]},Il.prototype.inputStarted=function(){if(!this.lowDefMove)return!1;var e=this.getRenderRatio();this.renderRatio=Math.max(.8,.75*e),this.lowDefScale=this.renderRatio/e,this.updateSizes()},Il.prototype.inputEnded=function(){if(!this.lowDefMove)return!1;this.renderRatio=this.getRenderRatio(),this.lowDefScale=1,this.updateSizes()},Il.prototype.setSize=function(e){this.width=e.width,this.height=e.height,this.lodScale=1.5*Math.min(1e3/this.width,1),this.renderRatio=this.getRenderRatio(),this.updateSizes()},Il.prototype.forceHD=function(e){this.forceHd=e,this.renderRatio=this.getRenderRatio(),this.updateSizes()},Il.prototype.setHD=function(e){this.hd=e,this.renderRatio=this.getRenderRatio(),this.updateSizes()},Il.prototype.setFieldOfView=function(e){this.fov=e},Il.prototype.toClipSpace=function(e){return new Qs.Vector2(e.x/this.width*2-1,1-e.y/this.height*2)},Il.prototype.fromClipSpace=function(e){return new Qs.Vector2(.5*(1+e.x)*this.width,.5*(1-e.y)*this.height)},Il.prototype.flipY=function(e){return new Qs.Vector2(e.x,this.height-e.y)},Il.displayName="ContainerStore";var Dl=o.createStore(Il),kl=new Qs.PerspectiveCamera(45,1,250,25e5);Dl.listen(function(e){kl.aspect=e.aspect,kl.fov=e.fov/Math.max(kl.aspect,1),kl.updateProjectionMatrix()});var Ul=n(function(e,t){e.exports=function(){function e(e,t){if(e[t])return e[t];for(var n,r=Object.keys(e),i=t.toLowerCase().replace(W,""),o=-1;++o<r.length;)if((n=r[o]).toLowerCase().replace(W,"")===i)return e[n]}function t(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Y}function n(e){return new t(e).output()}function r(e,t,n){Array.isArray(t)&&(n.unshift(t),t=null);var r=t?{}:e,o=n.reduce(function(e,t){return i(t,e),e},r);t&&(e[t]=o)}function i(e,t){if(Array.isArray(e)){var n=e.shift();if("PARAMETER"===n&&(n=e.shift()),1===e.length)return Array.isArray(e[0])?(t[n]={},void i(e[0],t[n])):void(t[n]=e[0]);if(e.length)if("TOWGS84"!==n){if("AXIS"===n)return n in t||(t[n]=[]),void t[n].push(e);var o;switch(Array.isArray(n)||(t[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[n]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&i(e[2],t[n]));case"SPHEROID":case"ELLIPSOID":return t[n]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&i(e[3],t[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void r(t,n,e);default:for(o=-1;++o<e.length;)if(!Array.isArray(e[o]))return i(e,t[n]);return r(t,n,e)}}else t[n]=e;else t[n]=!0}else t[e]=!0}function o(e){return e*$}function a(e){function t(t){return t*(e.to_meter||1)}if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var n="",r=0,i=e.AXIS.length;r<i;++r){var a=e.AXIS[r][0].toLowerCase();-1!==a.indexOf("north")?n+="n":-1!==a.indexOf("south")?n+="s":-1!==a.indexOf("east")?n+="e":-1!==a.indexOf("west")&&(n+="w")}2===n.length&&(n+="u"),3===n.length&&(e.axis=n)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var s=e.GEOGCS;"GEOGCS"===e.type&&(s=e),s&&(s.DATUM?e.datumCode=s.DATUM.name.toLowerCase():e.datumCode=s.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(e.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=s.DATUM.SPHEROID.a,e.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(e.datum_params=s.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",o],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["azimuth","Azimuth"],["alpha","azimuth",o],["srsCode","name"]].forEach(function(t){return function(e,t){var n=t[0],r=t[1];!(n in e)&&r in e&&(e[n]=e[r],3===t.length&&(e[n]=t[2](e[n])))}(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=o(e.lat1>0?90:-90),e.lat_ts=e.lat1)}function s(e){var t=this;if(2===arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?s[e]=q(arguments[1]):s[e]=ee(arguments[1]):s[e]=n}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?s.apply(t,e):s(e)});if("string"==typeof e){if(e in s)return s[e]}else"EPSG"in e?s["EPSG:"+e.EPSG]=e:"ESRI"in e?s["ESRI:"+e.ESRI]=e:"IAU2000"in e?s["IAU2000:"+e.IAU2000]=e:console.log(e);return}}function l(t){var n=e(t,"authority");if(n){var r=e(n,"epsg");return r&&ne.indexOf(r)>-1}}function c(t){var n=e(t,"extension");if(n)return e(n,"proj4")}function u(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in s}(e))return s[e];if(function(e){return te.some(function(t){return e.indexOf(t)>-1})}(e)){var t=ee(e);if(l(t))return s["EPSG:3857"];var n=c(t);return n?q(n):t}return function(e){return"+"===e[0]}(e)?q(e):void 0}function h(e){return e}function p(e,t){var n=se.length;return e.names?(se[n]=e,e.names.forEach(function(e){ae[e.toLowerCase()]=n}),this):(console.log(t),!0)}function d(t,n){if(!(this instanceof d))return new d(t);n=n||function(e){if(e)throw e};var r=u(t);if("object"==typeof r){var i=d.projections.get(r.projName);if(i){if(r.datumCode&&"none"!==r.datumCode){var o=e(he,r.datumCode);o&&(r.datum_params=o.towgs84?o.towgs84.split(","):null,r.ellps=o.ellipse,r.datumName=o.datumName?o.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84";var a=function(t,n,r,i,o){if(!t){var a=e(ce,i);a||(a=ue),t=a.a,n=a.b,r=a.rf}return r&&!n&&(n=(1-1/r)*t),(0===r||Math.abs(t-n)<U)&&(o=!0,n=t),{a:t,b:n,rf:r,sphere:o}}(r.a,r.b,r.rf,r.ellps,r.sphere),s=function(e,t,n,r){var i=e*e,o=t*t,a=(i-o)/i,s=0;return r?(i=(e*=1-a*(I+a*(D+a*k)))*e,a=0):s=Math.sqrt(a),{es:a,e:s,ep2:(i-o)/o}}(a.a,a.b,a.rf,r.R_A),l=r.datum||function(e,t,n,r,i,o){var a={};return a.datum_type=void 0===e||"none"===e?L:P,t&&(a.datum_params=t.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=C),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=O,a.datum_params[3]*=z,a.datum_params[4]*=z,a.datum_params[5]*=z,a.datum_params[6]=a.datum_params[6]/1e6+1))),a.a=n,a.b=r,a.es=i,a.ep2=o,a}(r.datumCode,r.datum_params,a.a,a.b,s.es,s.ep2);re(this,r),re(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=l,this.init(),n(null,this)}else n(t)}else n(t)}function f(e){return e===C||e===O}function m(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function v(e,t,n){var r;return Array.isArray(n)&&(n=fe(n)),me(n),e.datum&&t.datum&&function(e,t){return(e.datum.datum_type===C||e.datum.datum_type===O)&&"WGS84"!==t.datumCode||(t.datum.datum_type===C||t.datum.datum_type===O)&&"WGS84"!==e.datumCode}(e,t)&&(n=v(e,r=new d("WGS84"),n),e=r),"enu"!==e.axis&&(n=de(e,!1,n)),"longlat"===e.projName?n={x:n.x*N,y:n.y*N,z:n.z||0}:(e.to_meter&&(n={x:n.x*e.to_meter,y:n.y*e.to_meter,z:n.z||0}),n=e.inverse(n)),e.from_greenwich&&(n.x+=e.from_greenwich),n=pe(e.datum,t.datum,n),t.from_greenwich&&(n={x:n.x-t.from_greenwich,y:n.y,z:n.z||0}),"longlat"===t.projName?n={x:n.x*B,y:n.y*B,z:n.z||0}:(n=t.forward(n),t.to_meter&&(n={x:n.x/t.to_meter,y:n.y/t.to_meter,z:n.z||0})),"enu"!==t.axis?de(t,!0,n):n}function g(e,t,n){var r,i,o;return Array.isArray(n)?(r=v(e,t,n)||{x:NaN,y:NaN},n.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(i=v(e,t,n),2===(o=Object.keys(n)).length?i:(o.forEach(function(r){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===r||"y"===r||"z"===r)return}else if("x"===r||"y"===r)return;i[r]=n[r]}),i))}function y(e){return e instanceof d?e:e.oProj?e.oProj:d(e)}function x(e,t,n){e=y(e);var r,i=!1;return void 0===t?(t=e,e=ve,i=!0):(void 0!==t.x||Array.isArray(t))&&(n=t,t=e,e=ve,i=!0),t=y(t),n?g(e,t,n):(r={forward:function(n){return g(e,t,n)},inverse:function(n){return g(t,e,n)}},i&&(r.oProj=t),r)}function b(e,t){return t=t||5,function(e,t){var n="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+function(e,t,n){var r=M(n);return function(e,t,n){var r=n-1,i=ye.charCodeAt(r),o=xe.charCodeAt(r),a=i+e-1,s=o+t,l=!1;return a>_e&&(a=a-_e+be-1,l=!0),(a===we||i<we&&a>we||(a>we||i<we)&&l)&&a++,(a===Se||i<Se&&a>Se||(a>Se||i<Se)&&l)&&++a===we&&a++,a>_e&&(a=a-_e+be-1),s>Te?(s=s-Te+be-1,l=!0):l=!1,(s===we||o<we&&s>we||(s>we||o<we)&&l)&&s++,(s===Se||o<Se&&s>Se||(s>Se||o<Se)&&l)&&++s===we&&s++,s>Te&&(s=s-Te+be-1),String.fromCharCode(a)+String.fromCharCode(s)}(Math.floor(e/1e5),Math.floor(t/1e5)%20,r)}(e.easting,e.northing,e.zoneNumber)+n.substr(n.length-5,t)+r.substr(r.length-5,t)}(function(e){var t,n,r,i,o,a,s=e.lat,l=e.lon,c=6378137,u=S(s),h=S(l);a=Math.floor((l+180)/6)+1,180===l&&(a=60),s>=56&&s<64&&l>=3&&l<12&&(a=32),s>=72&&s<84&&(l>=0&&l<9?a=31:l>=9&&l<21?a=33:l>=21&&l<33?a=35:l>=33&&l<42&&(a=37)),o=S(6*(a-1)-180+3),t=c/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),n=Math.tan(u)*Math.tan(u),r=.006739496752268451*Math.cos(u)*Math.cos(u);var p=.9996*t*((i=Math.cos(u)*(h-o))+(1-n+r)*i*i*i/6+(5-18*n+n*n+72*r-.39089081163157013)*i*i*i*i*i/120)+5e5,d=.9996*(c*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u))+t*Math.tan(u)*(i*i/2+(5-n+9*r+4*r*r)*i*i*i*i/24+(61-58*n+n*n+600*r-2.2240339282485886)*i*i*i*i*i*i/720));return s<0&&(d+=1e7),{northing:Math.round(d),easting:Math.round(p),zoneNumber:a,zoneLetter:function(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}(s)}}({lat:e[1],lon:e[0]}),t)}function w(e){var t=_(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function S(e){return e*(Math.PI/180)}function T(e){return e/Math.PI*180}function _(e){var t=e.northing,n=e.easting,r=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,h,p,d=6378137,f=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=n-5e5,v=t;r<"N"&&(v-=1e7),u=6*(i-1)-180+3,p=(h=v/.9996/6367449.145945056)+(3*f/2-27*f*f*f/32)*Math.sin(2*h)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*h)+151*f*f*f/96*Math.sin(6*h),o=d/Math.sqrt(1-.00669438*Math.sin(p)*Math.sin(p)),a=Math.tan(p)*Math.tan(p),s=.006739496752268451*Math.cos(p)*Math.cos(p),l=.99330562*d/Math.pow(1-.00669438*Math.sin(p)*Math.sin(p),1.5),c=m/(.9996*o);var g=p-o*Math.tan(p)/l*(c*c/2-(5+3*a+10*s-4*s*s-.06065547077041606)*c*c*c*c/24+(61+90*a+298*s+45*a*a-1.6983531815716497-3*s*s)*c*c*c*c*c*c/720);g=T(g);var y,x=(c-(1+2*a+s)*c*c*c/6+(5-2*s+28*a-3*s*s+.05391597401814761+24*a*a)*c*c*c*c*c/120)/Math.cos(p);if(x=u+T(x),e.accuracy){var b=_({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});y={top:b.lat,right:b.lon,bottom:g,left:x}}else y={lat:g,lon:x};return y}function M(e){var t=e%ge;return 0===t&&(t=ge),t}function E(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,n=e.length,r=null,i="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,o++}var a=parseInt(i,10);if(0===o||o+3>n)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;r=e.substring(o,o+=2);for(var l=M(a),c=function(e,t){for(var n=ye.charCodeAt(t-1),r=1e5,i=!1;n!==e.charCodeAt(0);){if(++n===we&&n++,n===Se&&n++,n>_e){if(i)throw"Bad character: "+e;n=be,i=!0}r+=1e5}return r}(r.charAt(0),l),u=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var n=xe.charCodeAt(t-1),r=0,i=!1;n!==e.charCodeAt(0);){if(++n===we&&n++,n===Se&&n++,n>Te){if(i)throw"Bad character: "+e;n=be,i=!0}r+=1e5}return r}(r.charAt(1),l);u<A(s);)u+=2e6;var h=n-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var p,d,f,m=h/2,v=0,g=0;return m>0&&(p=1e5/Math.pow(10,m),d=e.substring(o,o+m),v=parseFloat(d)*p,f=e.substring(o+m),g=parseFloat(f)*p),{easting:v+c,northing:g+u,zoneLetter:s,zoneNumber:a,accuracy:p}}function A(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function R(e,t,n){if(!(this instanceof R))return new R(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var C=1,O=2,P=4,L=5,z=484813681109536e-20,F=Math.PI/2,I=.16666666666666666,D=.04722222222222222,k=.022156084656084655,U=1e-10,N=.017453292519943295,B=57.29577951308232,j=Math.PI/4,G=2*Math.PI,H={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},V={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},W=/[\s_\-\/\(\)]/g,q=function(t){var n,r,i,o={},a=t.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var n=t.split("=");return n.push(!0),e[n[0].toLowerCase()]=n[1],e},{}),s={proj:"projName",datum:"datumCode",rf:function(e){o.rf=parseFloat(e)},lat_0:function(e){o.lat0=e*N},lat_1:function(e){o.lat1=e*N},lat_2:function(e){o.lat2=e*N},lat_ts:function(e){o.lat_ts=e*N},lon_0:function(e){o.long0=e*N},lon_1:function(e){o.long1=e*N},lon_2:function(e){o.long2=e*N},alpha:function(e){o.alpha=parseFloat(e)*N},lonc:function(e){o.longc=e*N},x_0:function(e){o.x0=parseFloat(e)},y_0:function(e){o.y0=parseFloat(e)},k_0:function(e){o.k0=parseFloat(e)},k:function(e){o.k0=parseFloat(e)},a:function(e){o.a=parseFloat(e)},b:function(e){o.b=parseFloat(e)},r_a:function(){o.R_A=!0},zone:function(e){o.zone=parseInt(e,10)},south:function(){o.utmSouth=!0},towgs84:function(e){o.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){o.to_meter=parseFloat(e)},units:function(t){o.units=t;var n=e(V,t);n&&(o.to_meter=n.to_meter)},from_greenwich:function(e){o.from_greenwich=e*N},pm:function(t){var n=e(H,t);o.from_greenwich=(n||parseFloat(t))*N},nadgrids:function(e){"@null"===e?o.datumCode="none":o.nadgrids=e},axis:function(e){3===e.length&&-1!=="ewnsud".indexOf(e.substr(0,1))&&-1!=="ewnsud".indexOf(e.substr(1,1))&&-1!=="ewnsud".indexOf(e.substr(2,1))&&(o.axis=e)}};for(n in a)r=a[n],n in s?"function"==typeof(i=s[n])?i(r):o[i]=r:o[n]=r;return"string"==typeof o.datumCode&&"WGS84"!==o.datumCode&&(o.datumCode=o.datumCode.toLowerCase()),o},Y=1,X=/\s/,Z=/[A-Za-z]/,J=/[A-Za-z84]/,K=/[,\]]/,Q=/[\d\.E\-\+]/;t.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;X.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Y:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},t.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(K.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},t.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Y)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Y,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},t.prototype.number=function(e){if(!Q.test(e)){if(K.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},t.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},t.prototype.keyword=function(e){if(J.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=Y)}if(!K.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},t.prototype.neutral=function(e){if(Z.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(Q.test(e))return this.word=e,void(this.state=3);if(!K.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},t.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var $=.017453292519943295,ee=function(e){var t=n(e),r=t.shift(),o=t.shift();t.unshift(["name",o]),t.unshift(["type",r]);var s={};return i(t,s),a(s),s};!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(s);var te=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],ne=["3857","900913","3785","102113"],re=function(e,t){var n,r;if(e=e||{},!t)return e;for(r in t)void 0!==(n=t[r])&&(e[r]=n);return e},ie=function(e){return Math.abs(e)<=3.14159265359?e:e-function(e){return e<0?-1:1}(e)*G},oe=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=function(e,t,n){var r=e*t;return n/Math.sqrt(1-r*r)}(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,n,r=e.x,i=e.y;if(i*B>90&&i*B<-90&&r*B>180&&r*B<-180)return null;if(Math.abs(Math.abs(i)-F)<=U)return null;if(this.sphere)t=this.x0+this.a*this.k0*ie(r-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(j+.5*i));else{var o=Math.sin(i),a=function(e,t,n){var r=e*n,i=.5*e;return r=Math.pow((1-r)/(1+r),i),Math.tan(.5*(F-t))/r}(this.e,i,o);t=this.x0+this.a*this.k0*ie(r-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return e.x=t,e.y=n,e},inverse:function(e){var t,n,r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)n=F-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(n=function(e,t){for(var n,r,i=.5*e,o=F-2*Math.atan(t),a=0;a<=15;a++)if(n=e*Math.sin(o),r=F-2*Math.atan(t*Math.pow((1-n)/(1+n),i))-o,o+=r,Math.abs(r)<=1e-10)return o;return-9999}(this.e,o)))return null}return t=ie(this.long0+r/(this.a*this.k0)),e.x=t,e.y=n,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:h,inverse:h,names:["longlat","identity"]}],ae={},se=[],le={start:function(){oe.forEach(p)},add:p,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==ae[t]&&se[ae[t]]?se[ae[t]]:void 0}},ce={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ue=ce.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ce.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var he={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};d.projections=le,d.projections.start();var pe=function(e,t,n){return function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===C?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==O||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)?n:e.datum_type===L||t.datum_type===L?n:e.es!==t.es||e.a!==t.a||f(e.datum_type)||f(t.datum_type)?(n=function(e,t,n){var r,i,o,a,s=e.x,l=e.y,c=e.z?e.z:0;if(l<-F&&l>-1.001*F)l=-F;else if(l>F&&l<1.001*F)l=F;else{if(l<-F)return{x:-1/0,y:-1/0,z:e.z};if(l>F)return{x:1/0,y:1/0,z:e.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),o=i*i,{x:((r=n/Math.sqrt(1-t*o))+c)*a*Math.cos(s),y:(r+c)*a*Math.sin(s),z:(r*(1-t)+c)*i}}(n,e.es,e.a),f(e.datum_type)&&(n=function(e,t,n){if(t===C)return{x:e.x+n[0],y:e.y+n[1],z:e.z+n[2]};if(t===O){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6];return{x:c*(e.x-l*e.y+s*e.z)+r,y:c*(l*e.x+e.y-a*e.z)+i,z:c*(-s*e.x+a*e.y+e.z)+o}}}(n,e.datum_type,e.datum_params)),f(t.datum_type)&&(n=function(e,t,n){if(t===C)return{x:e.x-n[0],y:e.y-n[1],z:e.z-n[2]};if(t===O){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=(e.x-r)/c,h=(e.y-i)/c,p=(e.z-o)/c;return{x:u+l*h-s*p,y:-l*u+h+a*p,z:s*u-a*h+p}}}(n,t.datum_type,t.datum_params)),function(e,t,n,r){var i,o,a,s,l,c,u,h,p,d,f,m,v,g,y,x,b=e.x,w=e.y,S=e.z?e.z:0;if(i=Math.sqrt(b*b+w*w),o=Math.sqrt(b*b+w*w+S*S),i/n<1e-12){if(g=0,o/n<1e-12)return y=F,x=-r,{x:e.x,y:e.y,z:e.z}}else g=Math.atan2(w,b);a=S/o,h=(s=i/o)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*s*s)),p=a*l,v=0;do{v++,c=t*(u=n/Math.sqrt(1-t*p*p))/(u+(x=i*h+S*p-u*(1-t*p*p))),m=(f=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(d=s*(1-c)*l)*p,h=d,p=f}while(m*m>1e-24&&v<30);return y=Math.atan(f/Math.abs(d)),{x:g,y:y,z:x}}(n,t.es,t.a,t.b)):n},de=function(e,t,n){var r,i,o,a=n.x,s=n.y,l=n.z||0,c={};for(o=0;o<3;o++)if(!t||2!==o||void 0!==n.z)switch(0===o?(r=a,i=-1!=="ew".indexOf(e.axis[o])?"x":"y"):1===o?(r=s,i=-1!=="ns".indexOf(e.axis[o])?"y":"x"):(r=l,i="z"),e.axis[o]){case"e":case"w":case"n":case"s":c[i]=r;break;case"u":void 0!==n[i]&&(c.z=r);break;case"d":void 0!==n[i]&&(c.z=-r);break;default:return null}return c},fe=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t},me=function(e){m(e.x),m(e.y)},ve=d("WGS84"),ge=6,ye="AJSAJS",xe="AFAFAF",be=65,we=73,Se=79,Te=86,_e=90,Me={forward:b,inverse:function(e){var t=_(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:w};R.fromMGRS=function(e){return new R(w(e))},R.prototype.toMGRS=function(e){return b([this.x,this.y],e)};var Ee,Ae=function(e,t){var n;return e>1e-7?(1-e*e)*(t/(1-(n=e*t)*n)-.5/e*Math.log((1-n)/(1+n))):2*t},Re=.3333333333333333,Ce=.17222222222222222,Oe=.10257936507936508,Pe=.06388888888888888,Le=.0664021164021164,ze=.016415012942191543,Fe={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-F)<U?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<U?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Ae(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,n=[];return n[0]=e*Re,t=e*e,n[0]+=t*Ce,n[1]=t*Pe,t*=e,n[0]+=t*Oe,n[1]+=t*Le,n[2]=t*ze,n}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Ae(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,n,r,i,o,a,s,l,c,u,h=e.x,p=e.y;if(h=ie(h-this.long0),this.sphere){if(o=Math.sin(p),u=Math.cos(p),r=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+u*r:1+this.sinph0*o+this.cosph0*u*r)<=U)return null;t=(n=Math.sqrt(2/n))*u*Math.sin(h),n*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*u*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(p+this.phi0)<U)return null;n=j-.5*p,t=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(h),n*=r}}else{switch(s=0,l=0,c=0,r=Math.cos(h),i=Math.sin(h),o=Math.sin(p),a=Ae(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:c=1+this.sinb1*s+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=F+p,a=this.qp-a;break;case this.S_POLE:c=p-F,a=this.qp+a}if(Math.abs(c)<U)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),n=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*s-this.sinb1*l*r):(c=Math.sqrt(2/(1+l*r)))*s*this.ymf,t=this.xmf*c*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(c=Math.sqrt(a))*i,n=r*(this.mode===this.S_POLE?c:-c)):t=n=0}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,n,r,i,o,a,s,l=e.x/this.a,c=e.y/this.a;if(this.sphere){var u,h=0,p=0;if(u=Math.sqrt(l*l+c*c),(n=.5*u)>1)return null;switch(n=2*Math.asin(n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=Math.sin(n),h=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(u)<=U?0:Math.asin(c*p/u),l*=p,c=h*u;break;case this.OBLIQ:n=Math.abs(u)<=U?this.phi0:Math.asin(h*this.sinph0+c*p*this.cosph0/u),l*=p*this.cosph0,c=(h-Math.sin(n)*this.sinph0)*u;break;case this.N_POLE:c=-c,n=F-n;break;case this.S_POLE:n-=F}t=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(a=Math.sqrt(l*l+c*c))<U)return e.x=0,e.y=this.phi0,e;i=2*Math.asin(.5*a/this.rq),r=Math.cos(i),l*=i=Math.sin(i),this.mode===this.OBLIQ?(s=r*this.sinb1+c*i*this.cosb1/a,o=this.qp*s,c=a*this.cosb1*r-c*this.sinb1*i):(s=c*i/a,o=this.qp*s,c=a*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(o=l*l+c*c))return e.x=0,e.y=this.phi0,e;s=1-o/this.qp,this.mode===this.S_POLE&&(s=-s)}t=Math.atan2(l,c),n=function(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)}(Math.asin(s),this.apa)}return e.x=ie(this.long0+t),e.y=n,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Ie=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},De={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,n,r,i,o,a,s,l=e.x,c=e.y;return r=ie(l-this.long0),t=Math.sin(c),n=Math.cos(c),i=Math.cos(r),((o=this.sin_p14*t+this.cos_p14*n*i)>0||Math.abs(o)<=U)&&(a=1*this.a*n*Math.sin(r),s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*i)),e.x=a,e.y=s,e},inverse:function(e){var t,n,r,i,o,a,s;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),n=Ie(t/this.a),r=Math.sin(n),i=Math.cos(n),a=this.long0,Math.abs(t)<=U?(s=this.lat0,e.x=a,e.y=s,e):(s=Ie(i*this.sin_p14+e.y*r*this.cos_p14/t),o=Math.abs(this.lat0)-F,Math.abs(o)<=U?(a=ie(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=s,e):(a=ie(this.long0+Math.atan2(e.x*r,t*this.cos_p14*i-e.y*this.sin_p14*r)),e.x=a,e.y=s,e))},names:["ortho"]};return x.defaultDatum="WGS84",x.Proj=d,x.WGS84=new x.Proj("WGS84"),x.Point=R,x.toPoint=fe,x.defs=s,x.transform=v,x.mgrs=Me,x.version="2.6.2-alpha",(Ee=x).Proj.projections.add(Fe),Ee.Proj.projections.add(De),x}()});function Nl(){this.projection=null,this.location=null,this.globalOffset=new Qs.Vector2,this.sceneScale=1,this.bindListeners({setCurrentPlace:s.setCurrentPlace}),this.exportPublicMethods({positionToTileFraction:this.positionToTileFraction.bind(this)})}Ul.defs([["EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"]]),Nl.prototype.setCurrentPlace=function(e){this.location=e.location,this.projection="EPSG:3857";const t=f.snap(this.location[0]),n=f.snap(this.location[1]);pl.projector=Ul(this.projection),pl.center=pl.project([t,n],!0),pl.projector3035=Ul("EPSG:3035");var r=pl.projector3035.forward([t,n]);pl.center3035={x:r[0],y:r[1]},this.sceneScale=pl.calculateSceneScale(t,n),this.globalOffset=pl.calculateGlobalOffset(t,n)},Nl.prototype.positionToTileFraction=function(e,t){const n=e.clone();return n.x-=this.globalOffset.x,n.y+=this.globalOffset.y,n.divideScalar(this.sceneScale*Math.pow(2,15-t)),[n.x,n.y,t]},Nl.displayName="GeoprojectStore";var Bl=o.createStore(Nl);function jl(){this.appContainer=null,this.datasource={},this.fatalError=!1,this.initialized=!1,this.resourceUrl=null,this.bindListeners({configureElevationDatasource:c.configureElevationDatasource,configureImageryDatasource:c.configureImageryDatasource,setAppContainer:c.setAppContainer,setFatalError:a.fatalError,setResourceUrl:c.setResourceUrl})}jl.prototype.checkInitialized=function(){this.initialized=null!==this.appContainer&&null!==this.resourceUrl},jl.prototype.configureElevationDatasource=function(e){this.datasource.elevation=e},jl.prototype.configureImageryDatasource=function(e){this.datasource.imagery=e},jl.prototype.setFatalError=function(){this.fatalError=!0},jl.prototype.setAppContainer=function(e){this.appContainer=e,this.checkInitialized()},jl.prototype.setResourceUrl=function(e){this.resourceUrl=e,this.checkInitialized()},jl.displayName="AppStore";var Gl=o.createStore(jl);let Hl=new URLSearchParams(window.location.search.slice(1)),Vl=16,Wl=256;Hl.has("elevationPoolSize")&&(Vl=Number.parseInt(Hl.get("elevationPoolSize"))),Hl.has("imageryPoolSize")&&(Wl=Number.parseInt(Hl.get("imageryPoolSize")));const ql=Vl,Yl=Wl,Xl=Hl.has("interpolateFloat");var Zl=new Qs.WebGLRenderer({alpha:!0,antialias:!1,clearColor:0,logarithmicDepthBuffer:!1});Zl.sortObjects=!0,Zl.autoClear=!1,Zl.autoClearColor=!1,Zl.autoClearDepth=!0,Zl.autoClearStencil=!1,Zl.domElement.selectable=!1,Zl.toneMapping=Qs.NoToneMapping;var Jl=Dl.getState();Zl.setPixelRatio(Jl.pixelRatio),Zl.setSize(Jl.width,Jl.height),Dl.listen(function(e){Zl.setPixelRatio(e.pixelRatio),Zl.setSize(e.width,e.height)});class Kl{constructor(e){this.capacity=e,this.index=0,this.items=[]}next(){let e;return e=this.index>=this.capacity?this.items.splice(0,1)[0]:this.index++,this.items.push(e),e}tap(e){let t=this.items.indexOf(e);-1!==t&&(this.items.splice(t,1),this.items.push(e))}}var Ql=new("undefined"==typeof createImageBitmap?Qs.ImageLoader:Qs.ImageBitmapLoader);function $l(e){return.1*(256*e[0]*256+256*e[1]+e[2])-1e3}const ec=document.createElement("canvas");ec.width=256,ec.height=256;const tc=ec.getContext("2d"),nc=(e,t,n)=>{const r=e.image.width/e.__blocks,i=e.image.height/e.__blocks,o=r*(Math.floor(t)%e.__blocks),a=i*Math.floor(Math.floor(t)/e.__blocks);if(e.useFloat){tc.drawImage(n,0,0);let t=tc.getImageData(0,0,256,256).data,r=new Float32Array(65536),i=new DataView(t.buffer);for(let e=0;e<65536;++e){let t=[i.getUint8(4*e,!1),i.getUint8(4*e+1,!1),i.getUint8(4*e+2,!1)];r[e]=$l(t)}Zl.copyTextureToTexture({x:o,y:a},{image:{data:r,width:256,height:256},isDataTexture:!0},e)}else Zl.copyTextureToTexture({x:o,y:a},{image:n},e)};class rc{constructor({apiKey:e,poolSize:t,textureSize:n,useFloat:r,urlFormat:i}){this.apiKey=e,this.urlFormat=i,this.useFloat=!!r,this.hasUpdates=!1,this.listeners=[],this.lookup={},this.fetching={},this.imgCache={},this.indexPool=new Kl(t);let o=Math.sqrt(t);o%1&&console.error("poolSize needs to be a power of 2");let a=n*o;const s=this.useFloat&&!Xl?Qs.NearestFilter:Qs.LinearFilter;if(this.textureArray=new Qs.DataTexture(null,a,a,this.useFloat?Qs.AlphaFormat:Qs.RGBAFormat,this.useFloat?Qs.FloatType:Qs.UnsignedByteType,Qs.UVMapping,Qs.ClampToEdgeWrapping,Qs.ClampToEdgeWrapping,s,s,Zl.capabilities.getMaxAnisotropy()),this.textureArray.__blocks=o,this.textureArray.useFloat=this.useFloat,this.useFloat){const e=1024;this.indirectionTexture=new Qs.DataTexture(null,e,e,Qs.RGBAFormat,Qs.FloatType,Qs.UVMapping,Qs.ClampToEdgeWrapping,Qs.ClampToEdgeWrapping,Qs.NearestFilter,Qs.NearestFilter,1)}}urlForTile(e,t,n){return this.urlFormat.replace("{x}",e).replace("{y}",t).replace("{z}",n).replace("{apiKey}",this.apiKey)}fetchIfNeeded(e){if(void 0!==this.lookup[e]||void 0!==this.fetching[e])return;if(Object.values(this.fetching).length>32)return void S("throttling...");let t=this.findNewIndex(e);this.fetching[e]=t;let n=this.urlForTile(...hl.quadkeyToTile(e));Ql.load(n,n=>{if(this.imgCache[e]=n,nc(this.textureArray,t,n),delete this.fetching[e],this.lookup[e]=t,this.useFloat){let e=document.getElementById("elevation-tile-count");if(e){let t=parseInt(e.innerHTML);isNaN(t)&&(t=0),e.innerHTML=++t}}this.updateIndirectionTexture(),this.notifyUpdate()},()=>{console.error("Failed to get image",e),delete this.fetching[e]})}findNewIndex(e){let t,n,r=Object.values(this.fetching),i=!0;for(let o=32;o>0;o--){t=this.indexPool.next();let o=-1===r.indexOf(t),a=Object.values(this.lookup).indexOf(t),s=void 0!==(n=Object.keys(this.lookup)[a])&&e.slice(0,n.length-1)===n.slice(0,-1);if(o&&!s){i=!1;break}}return i&&(S(`Failed to find index (${this.indexPool.capacity})`),S("Downloads: ",r.length),n=Object.keys(this.lookup).sort((e,t)=>e.length-t.length)[0],t=this.lookup[n]),void 0!==n&&delete this.lookup[n],t}updateIndirectionTexture(){if(this.indirectionTexture){let e=Object.keys(this.lookup);e.sort((e,t)=>Math.sign(e.length-t.length));for(let t of e){let[e,n,r]=hl.quadkeyToTile(t),i=this.lookup[t],o=Math.pow(2,10-r);e*=o,n*=o;let a=new Float32Array(4*o*o),s=Math.pow(2,r),l=-s/this.indirectionTexture.image.width;for(let t=0;t<a.length;t++)a[4*t]=i,a[4*t+1]=s,a[4*t+2]=e*l,a[4*t+3]=n*l;Zl.copyTextureToTexture({x:e,y:n},{image:{data:a,width:o,height:o},isDataTexture:!0},this.indirectionTexture)}}}findBestAvailableData(e,t){for(let t=0;t<20;t++){let n=this.lookup[e];if(void 0!==n)return{index:n,downsample:t,quadkey:e};if(0===(e=e.slice(0,-1)).length)break}return t||S("Failed to find data",e),{index:null,downsample:20,quadkey:null}}dataAtPoint(e){let t;t=e.longitude?hl.pointToTileFraction(e.longitude,e.latitude,10):Bl.positionToTileFraction(e,10);const n=hl.tileToQuadkey(t),{quadkey:r}=this.findBestAvailableData(n);if(!r)return null;const i=Math.pow(2,r.length-t[2]);t[0]*=i,t[1]*=i;const o=this.imgCache[r],a=document.createElement("canvas");a.width=1,a.height=1,t[0]=t[0]%1*o.width,t[1]=t[1]%1*o.height;const s=a.getContext("2d");return s.drawImage(o,t[0],t[1],1,1,0,0,1,1),s.getImageData(0,0,1,1).data}addListener(e){this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}notifyUpdate(){this.hasUpdates=!0}broadcastUpdate(){this.listeners.forEach(e=>e()),this.hasUpdates=!1}}const ic=new rc({urlFormat:"https://vt-cm01.mapion.co.jp/gl-server/proxy/{z}/{x}/{y}.png?pathPattern=deep&format=m-tech/mapion/!prefix!-terrain-rgb-v20200910/&access_token=mt-pk.eyJ1IjoibWFwaW9uIiwiYSI6InJ5ZXFiOWJyZ3J2MjV3ZDcyNXY3Z3dmYzYifQ.XoOA7fe-5nUi8ALSyCl277",textureSize:256,poolSize:ql,useFloat:!0});Gl.listen(({datasource:e})=>{e.elevation&&(ic.apiKey=e.elevation.apiKey)});const oc=.0008176665341588574;function ac(e){const t=Bl.getState().sceneScale;let n;const r=3.141592653589793-.006135923151542565*(n=e.longitude?hl.pointToTile(e.longitude,e.latitude,10):Bl.positionToTileFraction(e,10))[1];return Math.cosh(r)/(oc*t)}function sc(e,t){const n=ic.dataAtPoint(e);if(!n){if("function"==typeof t){const n=()=>{const r=ic.dataAtPoint(e);r&&(ic.removeListener(n),t($l(r)*ac(e)))};ic.addListener(n)}return 0}const r=$l(n)*ac(e);return"function"==typeof t&&t(r),r}const lc={elevationArray:{value:ic.textureArray},indirectionTexture:{value:ic.indirectionTexture},uGlobalOffset:{type:"v2",value:new Qs.Vector2},uSceneScale:{type:"f",value:1}};Bl.listen(({globalOffset:e,sceneScale:t})=>{lc.uGlobalOffset.value.copy(e),lc.uSceneScale.value=t});const cc=function(e){this.value=e};cc.prototype.define=function(e,t){var n=new RegExp("#define "+e+" .*","g"),r="#define "+e+(t?" "+t:"");this.value.match(n)?this.value=this.value.replace(n,r):this.value=r+"\n"+this.value},cc.prototype.clone=function(){return new cc(this.value)};var uc=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform float uAccuracy;\n\nvarying vec3 vPosition;\nvarying vec3 vCenter; // Center of beacon\nvarying float vRingRadius; // Radius to draw inner ring at\n\n// Radius of beacon geometry, as defined in JS\n#define BEACON_RADIUS 50.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nfloat saturate( float t ) { return clamp( t, 0.0, 1.0 ); }\nvec2 saturate( vec2 t ) { return clamp( t, 0.0, 1.0 ); }\nvec3 saturate( vec3 t ) { return clamp( t, 0.0, 1.0 ); }\nvec4 saturate( vec4 t ) { return clamp( t, 0.0, 1.0 ); }\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\nvoid main() {\n  vCenter = position - BEACON_RADIUS * normal;\n  vec4 c4 = modelMatrix * vec4( vCenter, 1.0 );\n  vec3 worldCenter = c4.xyz / c4.w;\n  vCenter = worldCenter;\n\n  // Get distance to camera, and scale so that all beacon has constant screen size\n  float D = abs( ( viewMatrix * vec4( worldCenter, 1.0 ) ).z );\n  vRingRadius = 25.0 * clamp( D / 1000.0, 0.01, 10.0 ); // Cap size at so don't get artifacts when zooming\n\n  // Now have the minimum visible radius for beacon, adjust if smaller than accuracy\n  float radius = max( vRingRadius, uAccuracy );\n\n  vPosition = vCenter + radius * normal;\n\n  // Correct height\n  float height = getHeight( vPosition.xy );\n\n  // Place at correct height (flattening sphere in process)\n  float delta = height - vPosition.z + D / 1000.0 - 0.3 * radius; // Lift up at large distance so terrain doesn't swallow us & sink into ground\n  vPosition.z = height;\n\n\n  // To ensure beacon appears on top of forests & pistes, move towards camera\n  vec3 view = cameraPosition - vPosition;\n  float d = length( view );\n  view = normalize( view );\n  // Do not apply if too close, as it screws up geometry too much\n  float scale = 230.0 * smoothstep( 50.0, 250.0, d );\n\n  gl_Position = projectionMatrix * viewMatrix * vec4( vPosition + scale * view, 1.0 );\n}\n"),hc=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform float uTime;\n\nvarying vec3 vPosition;\nvarying vec3 vCenter;\nvarying float vRingRadius;\n\nconst vec4 white = vec4( 1.0, 1.0, 1.0, 0.9 );\n\nvoid main() {\n  float fractionalR = distance( vPosition.xy, vCenter.xy ) / vRingRadius;\n  vec3 baseColor = mix( vec3( 0.0, 0.0, 1.0 ), vec3( 0.0, 0.5, 1.0 ), 0.2 * fractionalR );\n  vec4 color = vec4( baseColor * sin( uTime ), 0.5 );\n  \n  // White ring\n  color = mix( color, white, smoothstep( 0.75, 0.8, fractionalR ) );\n  color = mix( color, vec4( baseColor.rgb, 0.15 ), smoothstep( 1.0, 1.05, fractionalR ) );\n\n  // Gamma\n  color.rgb = pow( abs( color.rgb ), vec3( 0.4545 ) );\n\n  gl_FragColor = color;\n}\n");function pc(e,t,n,r){return void 0===t&&void 0===n?this.set(e):(void 0===r&&(r=1),this.setRGB(e,t,n,r))}Object.assign(pc.prototype,{isColor:!0,r:1,g:1,b:1,a:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n,r){return this.r=e,this.g=t,this.b=n,this.a=r,this},setStyle:function(e){function t(e){return void 0===e?1:parseFloat(e)}var n;if(n=/^((?:rgb)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,this.a=t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,this.a=t(r[5]),this}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var a,s=(a=n[1]).length;if(3===s)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,this;if(6===s)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(a=Qs.Color.NAMES[e])?this.setHex(a):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b,this.a)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,r=e||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),l=Math.min(i,o,a),c=(l+s)/2;if(l===s)t=0,n=0;else{var u=s-l;switch(n=c<=.5?u/(s+l):u/(2-s-l),s){case i:t=(o-a)/u+(o<a?6:0);break;case o:t=(a-i)/u+2;break;case a:t=(i-o)/u+4}t/=6}return r.h=t,r.s=n,r.l=c,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this.a+=(e.a-this.a)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var dc=function(e){var t,n,r,i,o,a=Dl.getState().element;void 0===a&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),a===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=a,this.enabled=!0,this.target=new en,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=.17*Math.PI,this.maxPolarAngle=.33*Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!0,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=.5,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=50,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.lock2D=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,MINUS:189,PLUS:187},this.mouseButtons={LEFT:_.ROTATE,MIDDLE:_.DOLLY,RIGHT:_.PAN},this.touches={ONE:M.ROTATE,TWO:M.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.setDistanceToTarget=function(e){Tl.getState().clock.getElapsedTime()-Dl.getState().lastResize>1&&(c.target.sub(c.object.position),c.target.setLength(e),c.target.add(c.object.position))},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(u),c.update(),p=h.NONE},this.update=(t=new en,n=(new Kt).setFromUnitVectors(e.up,new en(0,1,0)),r=n.clone().inverse(),i=new en,o=new Kt,function(){var e=c.object.position;t.copy(e).sub(c.target),t.applyQuaternion(n),f.setFromVector3(t),c.autoRotate&&p===h.NONE&&L(2*Math.PI/60/60*c.autoRotateSpeed),c.lock2D?(void 0===c._oldPhi&&(c._oldPhi=f.phi),m.phi=-f.phi):void 0!==c._oldPhi&&(m.phi=c._oldPhi-f.phi,Math.abs(m.phi)<.05&&delete c._oldPhi),c.enableDamping?(f.theta+=m.theta*c.dampingFactor,f.phi+=m.phi*c.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi),f.theta=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,f.theta)),c.lock2D||void 0!==c._oldPhi||(f.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,f.phi))),f.makeSafe(),v-=1;var a=2*c.dampingFactor;return f.radius*=1+v*a,f.radius=Math.max(c.minDistance,Math.min(c.maxDistance,f.radius)),!0===c.enableDamping?c.target.addScaledVector(g,c.dampingFactor):c.target.add(g),t.setFromSpherical(f),t.applyQuaternion(r),e.copy(c.target).add(t),c.object.lookAt(c.target),!0===c.enableDamping?(m.theta*=1-c.dampingFactor,m.phi*=1-c.dampingFactor,g.multiplyScalar(1-c.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v*=1-a,v+=1,!!(y||i.distanceToSquared(c.object.position)>d||8*(1-o.dot(c.object.quaternion))>d)&&(c.dispatchEvent(u),c.object.position.forceHeight=!0,s.setCamera({position:c.object.position,target:c.target}),i.copy(c.object.position),o.copy(c.object.quaternion),y=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",oe,!1),c.domElement.removeEventListener("mousedown",K,!1),c.domElement.removeEventListener("wheel",ee,{capture:!1,passive:!1}),c.domElement.removeEventListener("touchstart",ne,!1),c.domElement.removeEventListener("touchend",ie,!1),c.domElement.removeEventListener("touchmove",re,!1),c.domElement.ownerDocument.removeEventListener("mousemove",Q,!1),c.domElement.ownerDocument.removeEventListener("mouseup",$,!1),c.domElement.removeEventListener("keydown",te,!1)};var l,c=this,u={type:"change"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=h.NONE,d=1e-6,f=new Ws,m=new Ws,v=1,g=new en,y=!1,x=.3,b=new Ht,w=new Ht,S=new Ht,T=new Ht,E=new Ht,A=new Ht,R=new Ht,C=new Ht,O=new Ht;function P(e){return Math.pow(.97,void 0!==e?.01*Math.abs(e):c.zoomSpeed)}function L(e){m.theta-=e}function z(e){m.phi-=e}var F,I=(F=new en,function(e,t){F.setFromMatrixColumn(t,0),F.multiplyScalar(-e),g.add(F)}),D=function(){var e=new en;return function(t,n){!0===c.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),k=function(){var e=new en;return function(t,n){var r=c.domElement;if(c.object.isPerspectiveCamera){var i=c.object.position;e.copy(i).sub(c.target);var o=e.length();o*=Math.tan(c.object.fov/2*Math.PI/180),I(2*t*o/r.clientHeight,c.object.matrix),D(2*n*o/r.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(I(t*(c.object.right-c.object.left)/c.object.zoom/r.clientWidth,c.object.matrix),D(n*(c.object.top-c.object.bottom)/c.object.zoom/r.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function U(e){c.object.isPerspectiveCamera?v/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function N(e){c.object.isPerspectiveCamera?v*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function B(e){b.set(e.clientX,e.clientY)}function j(e){T.set(e.clientX,e.clientY)}function G(e){c.dispatchEvent({type:"click",srcElement:e.srcElement||e.target,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,pageY:e.pageY,altKey:e.altKey,detail:e.clickCount})}function H(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}}function V(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,n)}}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);R.set(0,r)}function q(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}S.subVectors(w,b).multiplyScalar(c.rotateSpeed);var r=c.domElement;L(2*Math.PI*S.x/r.clientHeight),z(2*Math.PI*S.y/r.clientHeight),b.copy(w)}function Y(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}A.subVectors(E,T).multiplyScalar(c.panSpeed),k(A.x,A.y),T.copy(E)}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);C.set(0,r),O.set(0,Math.pow(C.y/R.y,c.zoomSpeed)),U(O.y),R.copy(C)}const Z=25;function J(e){const t=Tl.getState().clock.getElapsedTime();(!l||t-l.time>x)&&((l=e).time=t,l.clickCount=0),l.clickCount++}function K(e){if(!1!==c.enabled){var t;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case _.DOLLY:if(!1===c.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),p=h.DOLLY;break;case _.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;j(e),p=h.PAN}else{if(!1===c.enableRotate)return;B(e),p=h.ROTATE}break;case _.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;B(e),p=h.ROTATE}else{if(!1===c.enablePan)return;j(e),p=h.PAN}break;default:p=h.NONE}p!==h.NONE&&(c.domElement.ownerDocument.addEventListener("mousemove",Q,!1),c.domElement.ownerDocument.addEventListener("mouseup",$,!1),J(e),s.inputStarted())}}function Q(e){if(!1!==c.enabled)switch(e.preventDefault(),p){case h.ROTATE:if(!1===c.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),S.subVectors(w,b).multiplyScalar(c.rotateSpeed);var t=c.domElement;L(2*Math.PI*S.x/t.clientHeight),z(2*Math.PI*S.y/t.clientHeight),b.copy(w),c.update()}(e);break;case h.DOLLY:if(!1===c.enableZoom)return;!function(e){C.set(e.clientX,e.clientY),O.subVectors(C,R),O.y>0?U(P()):O.y<0&&N(P()),R.copy(C),c.update()}(e);break;case h.PAN:if(!1===c.enablePan)return;!function(e){E.set(e.clientX,e.clientY),A.subVectors(E,T).multiplyScalar(c.panSpeed),k(A.x,A.y),T.copy(E),c.update()}(e)}}function $(e){!1!==c.enabled&&(s.inputEnded(),function(e){const t=Tl.getState().clock.getElapsedTime();l.clientX===e.clientX&&l.clientY===e.clientY&&t-l.time<x&&G(l)}(e),c.domElement.ownerDocument.removeEventListener("mousemove",Q,!1),c.domElement.ownerDocument.removeEventListener("mouseup",$,!1),p=h.NONE)}function ee(e){!1===c.enabled||!1===c.enableZoom||p!==h.NONE&&p!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.inputStarted(),function(e){var t=e.deltaY;e.deltaMode===e.DOM_DELTA_LINE?t*=32:e.deltaMode===e.DOM_DELTA_PAGE&&(t*=100),t<0?N(P(t)):t>0&&U(P(t)),c.update()}(e),s.inputEnded())}function te(e){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(e){var t=!1;switch(e.keyCode){case c.keys.UP:k(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:k(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:k(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT:k(-c.keyPanSpeed,0),t=!0;break;case c.keys.MINUS:U(P(300)),t=!0;break;case c.keys.PLUS:N(P(300)),t=!0}t&&(e.preventDefault(),c.update())}(e)}function ne(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case M.ROTATE:if(!1===c.enableRotate)return;H(e),p=h.TOUCH_ROTATE;break;case M.PAN:if(!1===c.enablePan)return;V(e),p=h.TOUCH_PAN;break;default:p=h.NONE}break;case 2:switch(c.touches.TWO){case M.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&W(e),c.enablePan&&V(e)}(e),p=h.TOUCH_DOLLY_PAN;break;case M.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&W(e),c.enableRotate&&H(e)}(e),p=h.TOUCH_DOLLY_ROTATE;break;default:p=h.NONE}break;default:p=h.NONE}p!==h.NONE&&(s.inputStarted(),J(e))}}function re(e){if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case h.TOUCH_ROTATE:if(!1===c.enableRotate)return;q(e),c.update();break;case h.TOUCH_PAN:if(!1===c.enablePan)return;Y(e),c.update();break;case h.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&X(e),c.enablePan&&Y(e)}(e),c.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&X(e),c.enableRotate&&q(e)}(e),c.update();break;default:p=h.NONE}}function ie(e){!1!==c.enabled&&(s.inputEnded(),function(e){const t=Tl.getState().clock.getElapsedTime();1===l.touches.length&&Math.abs(l.pageX-e.pageX)<Z&&Math.abs(l.pageY-e.pageY)<Z&&t-l.time<x&&G(l)}(e),p=h.NONE)}function oe(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",oe,!1),c.domElement.addEventListener("mousedown",K,!1),c.domElement.addEventListener("wheel",ee,!1),c.domElement.addEventListener("touchstart",ne,!1),c.domElement.addEventListener("touchend",ie,!1),c.domElement.addEventListener("touchmove",re,!1),c.domElement.addEventListener("keydown",te,!1),-1===c.domElement.tabIndex&&(c.domElement.tabIndex=0),this.update()};(dc.prototype=Object.create(Ut.prototype)).constructor=dc;var fc=function(e,t){dc.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=_.PAN,this.mouseButtons.RIGHT=_.ROTATE,this.touches.ONE=M.PAN,this.touches.TWO=M.DOLLY_ROTATE};function mc(){this.clock=new Qs.Clock,this.lastInput=this.clock.getElapsedTime(),this.interacting=!1,this.bindListeners({onInput:[wl.toggleTracking,s.animateAlongFeature,s.doubleTapZoom,s.focusOnFeature,s.focusOnLocation,s.focusOnTarget,s.inputStarted,s.inputEnded,s.rotateLeft,s.rotateRight,s.featureClicked,s.setCurrentPlace,s.startFlyover,s.zoomIn,s.zoomOut],inputStarted:s.inputStarted,inputEnded:s.inputEnded})}fc.prototype=Object.create(Ut.prototype),fc.prototype.constructor=fc,mc.prototype.onInput=function(){this.lastInput=this.clock.getElapsedTime()},mc.prototype.inputStarted=function(){this.interacting=!0},mc.prototype.inputEnded=function(){this.interacting=!1,this.onInput()},mc.displayName="UserInputStore";var vc=o.createStore(mc),gc={cancelStack:[],transition:function(e,t,n,r){if(typeof t==typeof n){var i;if(r.lerp)i=r.lerp;else if(t instanceof Qs.Vector3)i=gc.lerp.vector3;else{if(isNaN(t))return S("Error: no lerp function for object:"),void S(t);i=gc.lerp.scalar}void 0===r&&(r={}),void 0===r.duration&&(r.duration=1),void 0===r.ease?r.ease=gc.smootherstep:"function"==typeof gc[r.ease]&&(r.ease=gc[r.ease]);var o={startTime:null,options:r,step:function(){o.startTime||(o.startTime=(new Date).getTime());var a=.001*((new Date).getTime()-o.startTime)/r.duration;if(a>=1){a=1,bl.unlisten(o.step);var s=gc.cancelStack.indexOf(o.step);-1!==s&&gc.cancelStack.splice(s,1)}var l=r.ease(a);e(i(t,n,l)),1===a&&"function"==typeof r.onComplete&&r.onComplete()}};r.doNotCancel||gc.cancelStack.push(o),bl.listen(o.step)}else S("Error: types do not match for transition:",typeof t,"!==",typeof n)},cubicOut:function(e){return Math.pow(e,3)},cubicIn:function(e){return 1-Math.pow(1-e,3)},linear:function(e){return e},smootherstep:function(e){return Qs.Math.smootherstep(e,0,1)},lerp:{scalar:function(e,t,n){return isNaN(e)?t:e+n*(t-e)},array:function(e,t,n){return e.map(function(e,r){return gc.lerp.scalar(e,t[r],n)})},vector3:function(e,t,n){return e.clone().lerp(t,n)},vector3Hop:function(e){return function(t,n,r){var i=gc.lerp.vector3(t,n,r);return i.z+=e*(1-Math.pow(2*r-1,2)),i}},vector3AngularHop:function(e,t){var n=new Qs.Vector3,r=new Qs.Vector3,i=new Qs.Vector3(0,0,1);return function(o,a,s){var l=n.subVectors(o,e).z,c=r.subVectors(a,e).z;n.setZ(0),r.setZ(0);var u=n.length(),h=r.length(),p=Math.atan2(r.y,r.x)-Math.atan2(n.y,n.x);p>Math.PI&&(p-=2*Math.PI),p<-Math.PI&&(p+=2*Math.PI);var d=gc.lerp.scalar(l,c,s),f=gc.lerp.scalar(u,h,s);return n.applyAxisAngle(i,p*s).setLength(f).setZ(d),n.add(e),n.z+=t*(1-Math.pow(2*s-1,2)),n}},vector3Angular:function(e){return gc.lerp.vector3AngularHop(e,0)},params:function(e,t,n){var r={};for(var i in t)if(t.hasOwnProperty(i)){if(void 0===e[i]){r[i]=t[i];continue}if("number"==typeof t[i])r[i]=(1-n)*e[i]+n*t[i];else if("string"==typeof t[i]){var o=new Qs.Color(e[i]),a=new Qs.Color(t[i]),s="#"+o.lerp(a,n).getHexString();r[i]=s}else r[i]=t[i]}return r}}};function yc(){this.tooFar=!0,this.tracking=!1,this.parameters=["latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed"],this.latitude=null,this.longitude=null,this.altitude=0,this.accuracy=0,this.altitudeAccuracy=0,this.heading=0,this.speed=0,this.bindListeners({panToPosition:wl.panToPosition,setPosition:wl.setPosition,cancelTracking:[s.doubleTapZoom,s.setCamera],toggleTracking:wl.toggleTracking})}vc.listen(function(){for(var e;e=gc.cancelStack.pop();)"function"==typeof e.options.onCancel&&e.options.onCancel(),bl.unlisten(e.step)}),yc.prototype.checkTooFar=function(){if(this.longitude&&this.latitude){var e=[this.longitude,this.latitude,0],t=pl.project(e);this.tooFar=Math.abs(t.x)>1e5||Math.abs(t.y)>1e5}else this.tooFar=!0},yc.prototype.setPosition=function(e){var t=this;this.parameters.forEach(function(n){t[n]=e.coords[n]}),this.checkTooFar()},yc.prototype.panToPosition=function(e){if(!this.longitude||!this.latitude)return this.setPosition(e);if(null===e.longitude||null===e.latitude)return this.setPosition(e);var t={coords:{}},n=this;this.parameters.forEach(function(e){t.coords[e]=n[e]});gc.transition(wl.setPosition,t,e,{duration:1,lerp:function(e,t,r){var i={coords:{}};return n.parameters.forEach(function(n){i.coords[n]=gc.lerp.scalar(e.coords[n],t.coords[n],r)}),i}})},yc.prototype.cancelTracking=function(){this.tracking=!1},yc.prototype.toggleTracking=function(){this.tracking=!this.tracking},yc.displayName="CurrentLocationStore";var xc=o.createStore(yc),bc=(new Qs.Vector3(0,0,0),new Qs.Vector3(0,0,0),new Qs.Vector3,new Qs.Vector3(0,0,1)),wc=(new Qs.Vector3(0,0,0),new Qs.Vector3(0,0,0),function(e,t){return bc}),Sc=new Qs.Vector3(0,0,1);function Tc(){this.position=new Qs.Vector3(0,0,16e3),this.target=new Qs.Vector3,this.hasZoomedOut=!1,this.vantages=[],this.constrainCamera=!0,this.minDistance=100,this.minHeight=200,this.maxDistance=5e4,this.maxBounds=1e5,kl.position.copy(this.position),kl.up.copy(Sc),kl.lookAt(new Qs.Vector3(0,0,0)),this.controls=new fc(kl);var e=this.controls;Tl.listen(function(){e.update()}),this.zoomInDuration=2,this.zoomOutDuration=2,this.bindListeners({animateAlongFeature:s.animateAlongFeature,configure:c.configureCamera,doubleTapZoom:s.doubleTapZoom,focusOnBounds:s.focusOnBounds,focusOnFeature:s.focusOnFeature,focusOnLocation:s.focusOnLocation,focusOnTarget:s.focusOnTarget,orbitTarget:s.orbitTarget,panToPosition:s.panToPosition,rotateLeft:s.rotateLeft,rotateRight:s.rotateRight,setCamera:s.setCamera,setCameraMode:s.setCameraMode,setCameraPosition:s.setCameraPosition,setCameraTarget:s.setCameraTarget,setFromCurrentLocation:[wl.setPosition,wl.toggleTracking],zoomIn:s.zoomIn,zoomOut:s.zoomOut})}Tc.prototype.setCamera=function(e){if(e.position&&(this.position.copy(e.position),!e.position.forceHeight)){var t=sc(this.position);this.position.z<t&&(this.position.z=t+1),this.constrainCamera&&this.position.z<t+this.minHeight&&(this.position.z+=.1*(t+this.minHeight-this.position.z))}if(e.target){this.target.copy(e.target);var n=this.maxBounds;Math.abs(this.target.x)>n&&(this.target.x=n*Math.sign(this.target.x)),Math.abs(this.target.y)>n&&(this.target.y=n*Math.sign(this.target.y))}this.controls.target.copy(this.target),kl.position.copy(this.position),kl.up.copy(Sc),e.quaternion?kl.setRotationFromQuaternion(e.quaternion):kl.lookAt(this.controls.target),kl.updateMatrixWorld()},Tc.prototype.setCameraTarget=function(e){this.setCamera({target:e})},Tc.prototype.setCameraPosition=function(e){this.setCamera({position:e})},Tc.prototype.setFromCurrentLocation=function(){this.waitFor(xc);var e=xc.getState();if(!e.tracking||e.tooFar)return!1;if(!e.longitude||!e.latitude)return!1;var t=pl.project([e.longitude,e.latitude,0]);return t.z=sc(t),this.focusOnTarget(t)},Tc.prototype.setCameraMode=function(e){if("2D"!==e&&"3D"!==e)return console.error("Unknown camera mode:",e),!1;this.controls.lock2D="3D"!==e},Tc.prototype.vantageForTarget=function(e){var t;if(void 0!==e.bearing){var n=Qs.Math.degToRad(e.bearing);t=new Qs.Vector3(-Math.sin(n),-Math.cos(n),0)}else t=wc();var r=void 0!==e.angle?e.angle:30;t.z=0,t.normalize(),t.z=Math.tan(Qs.Math.degToRad(r));var i=void 0!==e.distance?e.distance:this.target.distanceTo(this.position);return i=Math.max(i,1.5*this.minDistance),t.setLength(i),t.add(e),t},Tc.prototype.focusOnBounds=function(e){if(e.sw&&e.sw.longitude&&e.sw.latitude&&e.ne&&e.ne.longitude&&e.ne.latitude){var t=pl.project([e.sw.longitude,e.sw.latitude,0]);t.z=sc(e.sw,!0);var n=pl.project([e.ne.longitude,e.ne.latitude,0]);n.z=sc(e.ne,!0);var r=(new Qs.Box3).expandByPoint(t).expandByPoint(n),o=new Qs.Sphere;r.getBoundingSphere(o);var a=Qs.Math.degToRad(kl.fov),s=o.radius/Math.tan(.5*a),l=o.center.clone();return i.defaults(l,e),l.distance=s,this.focusOnTarget(l)}},Tc.prototype.focusOnFeature=function(e){var t,n=e.geometry.coordinates;return Array.isArray(n[0])&&(n=n[0]),(t=!1===e.projected?pl.project(n):new Qs.Vector3(n[0],n[1],0)).z=sc(t),this.focusOnTarget(t)},Tc.prototype.focusOnLocation=function(e){if(e.longitude&&e.latitude){var t=pl.project([e.longitude,e.latitude,0]);return t.z=e.height||sc(e,!0),i.defaults(t,e),this.focusOnTarget(t)}},Tc.prototype.focusOnTarget=function(e){var t=e.animationDuration;if(void 0===t&&(t=.001*this.target.distanceTo(e),t=Math.min(4,Math.max(1.2,t))),0===t)return this.setCamera({position:this.vantageForTarget(e),target:e});var n={position:this.vantageForTarget(e),target:e,duration:t,doNotCancel:!0};return"function"==typeof e.onComplete&&(n.onComplete=e.onComplete),this.panToPosition(n)},Tc.prototype.rotateAngle=function(e){var t=this.position.clone().sub(this.target);t.applyAxisAngle(Sc,e);var n=this.controls.target.clone().add(t),r={duration:.9,ease:gc.cubicIn,lerp:gc.lerp.vector3Angular(this.controls.target.clone()),doNotCancel:!0};gc.transition(s.setCameraPosition,this.position.clone(),n,r)},Tc.prototype.rotateLeft=function(){this.rotateAngle(.3*Math.PI)},Tc.prototype.rotateRight=function(){this.rotateAngle(-.3*Math.PI)},Tc.prototype.orbitTarget=function(){var e=this.position.clone().sub(this.target);e.applyAxisAngle(Sc,.5*Math.PI);var t=this.target.clone().add(e),n={duration:13.37,ease:gc.linear,lerp:gc.lerp.vector3Angular(this.target.clone()),onComplete:this.orbitTarget.bind(this)};gc.transition(s.setCameraPosition,this.position.clone(),t,n)},Tc.prototype.zoomIn=function(){var e=this.position.clone().sub(this.target),t=e.length(),n=t<this.minDistance+1;t=n?.9*this.minDistance:Math.max(this.minDistance,.5*t),e.setLength(t);var r=this;return this.panToPosition({position:this.target.clone().add(e),duration:n?.15:.5,ease:gc.cubicIn,doNotCancel:!0,onComplete:function(){n&&(e.setLength(r.minDistance),r.panToPosition({position:r.target.clone().add(e),duration:.2,ease:gc.cubicIn,doNotCancel:!0}))}})},Tc.prototype.zoomOut=function(){var e=this.position.clone().sub(this.target),t=e.length(),n=t>this.maxDistance-1;t=n?1.1*this.maxDistance:Math.min(this.maxDistance,2*t),e.setLength(t);var r=this;return this.panToPosition({position:this.target.clone().add(e),duration:n?.15:.5,ease:gc.cubicIn,doNotCancel:!0,onComplete:function(){n&&(e.setLength(r.maxDistance),r.panToPosition({position:r.target.clone().add(e),duration:.2,ease:gc.cubicIn,doNotCancel:!0}))}})},Tc.prototype.doubleTapZoom=function(){this.position.clone().sub(this.target).length()>1.05*this.minDistance?this.zoomIn():this.zoomOut()};var _c=new Qs.Vector3,Mc=new Qs.Vector3,Ec=new Qs.Vector3,Ac=new Qs.Vector3,Rc=new Qs.Quaternion,Cc=new Qs.Quaternion;Tc.prototype.panToPosition=function(e){if(void 0===e.position&&(e.position=this.position.clone()),void 0===e.target&&(e.target=this.target.clone()),_c.copy(this.position),Ec.copy(e.position),Mc.copy(this.target),Ac.copy(e.target),Rc.copy(kl.quaternion),this.controls.lock2D)Cc.copy(Rc);else{var t=new Qs.Matrix4;t.lookAt(e.position,e.target,Sc),Cc.setFromRotationMatrix(t)}return gc.transition(function(e){s.setCamera({position:{forceHeight:!0,...gc.lerp.vector3(_c,Ec,e)},target:gc.lerp.vector3(Mc,Ac,e),quaternion:Rc.clone().slerp(Cc,e)})},0,1,e),!1},Tc.prototype.animateAlongFeature=function(e){var t=this;if(this.controls.lock2D)return this.setCameraMode("3D"),void setTimeout(function(){t.animateAlongFeature(e)},500);var n=e.distance||1e3,r=Math.max(1,.5*n),i=e.speed||100,o=new Qs.Vector3,a=new Qs.Vector3,l=kl.near;kl.near=Math.min(.25*r,kl.near),kl.updateProjectionMatrix();var c=function(i){o.subVectors(i,t.target),o.multiplyScalar(.1),o.add(t.target);var l=o.distanceTo(t.position);l=n+.97*(l-n),a.subVectors(t.position,o),a.setLength(l),a.add(o);var c=sc(a)+r;a.z=c+.97*(a.z-c),s.setCamera({position:a,target:o}),e.onAnimationFrame&&e.onAnimationFrame(pl.unproject(o))},u=this.position.clone(),h=this.target.clone();this.constrainCamera=!1;var p=function(){t.constrainCamera=!0,t.panToPosition({position:u,target:h,duration:2,ease:gc.smootherstep}),setTimeout(function(){kl.near=l,kl.updateProjectionMatrix()},500),e.onComplete&&e.onComplete()},d=Array.isArray(e.feature)?e.feature:[e.feature],f=function(o){var a=d[o],s=function(){gc.transition(c,0,1,{duration:a.curve.getLength()/i,ease:gc.linear,lerp:function(e,t,n){return a.curve.getPointAt(n)},onCancel:p,onComplete:function(){o<d.length-1?f(o+1):p()}}),e.onFeatureReached&&e.onFeatureReached(a.id)};if(0===o){var l=a.curve.getPointAt(0),u=a.curve.getPointAt(.01),h=l.clone().sub(u);h.setLength(Math.max(n,100)),h.add(l),h.z+=r,t.panToPosition({position:h,target:l,duration:2,ease:gc.smootherstep,onComplete:s,onCancel:p})}else s()};f(0)},Tc.prototype.configure=function(e){var t=this;i.forEach(e,function(e,n){t[n]=e});i.forEach(["minDistance","minHeight","maxBounds","maxDistance","minPolarAngle","maxPolarAngle","noPan","noRotate","noZoom"],function(e){t.hasOwnProperty(e)&&(t.controls[e]=t[e])})},Tc.displayName="CameraStore";var Oc=o.createStore(Tc),Pc={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["precision highp float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};function Lc(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Lc.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Lc.FullScreenQuad=function(){var e=new rs(-1,1,1,-1,0,1),t=new _i(2,2),n=function(n){this._mesh=new Jr(t,n),this._camera=e};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n}();const zc=function(e,t){Lc.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof hi||e instanceof da?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=li.clone(e.uniforms),this.material=new da({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Lc.FullScreenQuad(this.material)};zc.prototype=Object.assign(Object.create(Lc.prototype),{constructor:zc,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))},compile:function(e){var t=new Rn,n=new An;n.material=this.material,t.add(n),e.compile(t,this.fsQuad._camera),t.children=[]}});var Fc=function(e,t,n){if(this.hd=!!n,this.renderer=e,void 0===t){var r={minFilter:ge,magFilter:ge,format:Fe,stencilBuffer:!1},i=e.getSize(new Ht);(t=new Zt(i.width,i.height,r)).texture.name="EffectComposer.rt1"}var o;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.hd&&(this.renderTargetHD=t.clone(),o=new la,this.renderTarget1.depthTexture=o,this.renderTarget2.depthTexture=o),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===Pc&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===zc&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new zc(Pc),this.clock=new bs};Object.assign(Fc.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){e.hd&&!this.hd&&console.error("Cannot add HD pass to a non-HD EffectComposer"),this.passes.push(e);var t=this.renderer.getSize(new Ht);e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){var o=this.readBuffer;t.hd&&(o=this.renderTargetHD),t.src&&(o=t.src),t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,o,e,!1),t.needsSwap&&this.swapBuffers()}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new Ht);(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t,n,r){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t),this.hd&&this.renderTargetHD.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(this.hd&&this.passes[i].hd?n:e,this.hd&&this.passes[i].hd?r:t)}});var Ic=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Ic.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Ic.FullScreenQuad=function(){var e=new rs(-1,1,1,-1,0,1),t=new _i(2,2),n=function(e){this._mesh=new Jr(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n}();var Dc=function(e,t,n,r,i){Lc.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};Dc.prototype=Object.assign(Object.create(Lc.prototype),{constructor:Dc,render:function(e,t,n){var r,i,o,a,s,l=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(o=e.getClearColor().getHex(),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),!1===this.autoClearColor&&(r=e.autoClearColor,e.autoClearColor=!1),!1===this.autoClearDepth&&(i=e.autoClearDepth,e.autoClearDepth=!1),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(o,a),!1===this.autoClearColor&&(e.autoClearColor=r),!1===this.autoClearDepth&&(e.autoClearDepth=i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=l}});var kc=function(e){Lc.call(this),void 0===Pc&&console.error("SavePass relies on CopyShader");var t=Pc;this.textureID="tDiffuse",this.uniforms=li.clone(t.uniforms),this.material=new hi({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new Zt(window.innerWidth,window.innerHeight,{minFilter:ge,magFilter:ge,format:ze,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new Lc.FullScreenQuad(this.material)};kc.prototype=Object.assign(Object.create(Lc.prototype),{constructor:kc,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}});const Uc=function(e,t){Lc.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof hi||e instanceof da?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=li.clone(e.uniforms),this.material=new da({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Lc.FullScreenQuad(this.material)};Uc.prototype=Object.assign(Object.create(Lc.prototype),{constructor:Uc,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))},compile:function(e){var t=new Rn,n=new An;n.material=this.material,t.add(n),e.compile(t,this.fsQuad._camera),t.children=[]}});var Nc=new Qs.Scene;Nc.hd=new Qs.Scene,Nc.tilepickerScene=new Qs.Scene;var Bc={tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new Qs.Vector2(1,1)}},jc=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform sampler2D tDiffuse;\nuniform vec2 uResolution;\n\nvarying vec2 vUv;\n\n#define FXAA_REDUCE_MIN   0.0078125 // (1.0/128.0)\n#define FXAA_REDUCE_MUL   0.03125   // (1.0/32.0)\n#define FXAA_SPAN_MAX     8.0\n\nconst vec3 luma = vec3( 0.299, 0.587, 0.114 );\nconst vec2 fxaa_span = vec2( FXAA_SPAN_MAX );\n\nvoid main() {\n  // FXAA\n  vec4 uv = vec4( vUv + uResolution, vUv - uResolution );\n  vec3 rgbNW = texture2D( tDiffuse, uv.zw ).rgb;\n  vec3 rgbNE = texture2D( tDiffuse, uv.xw ).rgb;\n  vec3 rgbSW = texture2D( tDiffuse, uv.zy ).rgb;\n  vec3 rgbSE = texture2D( tDiffuse, uv.xy ).rgb;\n  vec4 lumas = vec4( dot( rgbNW, luma ),\n                     dot( rgbNE, luma ),\n                     dot( rgbSW, luma ),\n                     dot( rgbSE, luma ) );\n\n  // Precalculate common combinations\n  vec4 tmp = lumas.xzxy + lumas.ywzw;\n  vec2 dir = tmp.yz - tmp.xw;\n  float dirReduce = FXAA_REDUCE_MUL * max( tmp.x + tmp.y, FXAA_REDUCE_MIN / FXAA_REDUCE_MUL );\n  float dirMin = min( abs( dir.x ), abs( dir.y ) ) + dirReduce;\n  dir = uResolution * clamp( dir / dirMin, -fxaa_span, fxaa_span );\n  vec4 rgbA = (\n      texture2D( tDiffuse, vUv - dir * 0.16666666666667 ) +\n      texture2D( tDiffuse, vUv + dir * 0.16666666666667 ) );\n  vec4 rgbM = texture2D( tDiffuse, vUv );\n\n  // We used to check the range of the luma of rgbB against max/min of\n  // lumas above, to determine whether to use rgbA or rgbB\n  // but it didn't make much difference, with rgbB used most of the time\n  // So just used that as it saved us computing lumaMin/lumaMax\n\n  // Testing, draw different regions with different AA\n  //if ( vUv.x < 0.25 ) {\n  //  gl_FragColor = 0.5 * rgbA; // Just blurred\n  //} else if ( vUv.x < 0.5 ) {\n  //  gl_FragColor = 0.36 * ( rgbA + rgbM ); // Slight original pixel 2 : 1\n  //} else if ( vUv.x < 0.75 ) {\n  //  gl_FragColor = 0.25 * ( rgbA + 2.0 * rgbM ); // More 1 : 1\n  //} else {\n  //  gl_FragColor = 1.1 * rgbM; // No anti-alias\n  //}\n  gl_FragColor = 0.33333333333 * ( rgbA + rgbM ); // Slight original pixel 2 : 1\n\n  // Vignette\n  float d = distance( vUv, vec2( 0.5 ) );\n  gl_FragColor.rgb *= 1.0 - 0.17 * smoothstep( 0.42, 0.65, d );\n}\n"),Gc=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nattribute vec3 position;\nattribute vec2 uv;\n\n// Quad vertex shader that also passes through uv coordinate\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  // Do not need any matrix multiplications as positions already in clip\n  // space\n  gl_Position = vec4( position, 1.0 );\n}\n"),Hc=Dl.getState(),Vc={type:Pl.render565?Qs.UnsignedShort565Type:Qs.UnsignedByteType,minFilter:Qs.LinearFilter,magFilter:Qs.LinearFilter,format:Qs.RGBFormat,stencilBuffer:!1},Wc=new Qs.Vector2(1/Hc.canvasWidth,1/Hc.canvasHeight);Bc.uResolution.value.copy(Wc);var qc=new Qs.WebGLRenderTarget(Hc.renderWidth,Hc.renderHeight,Vc);Dl.listen(function(e){Xc.setSize(e.renderWidth,e.renderHeight,e.canvasWidth,e.canvasHeight);var t=new Qs.Vector2(1/e.canvasWidth,1/e.canvasHeight);Bc.uResolution.value.copy(t)});var Yc=Pl.depthTexture,Xc=new Fc(Zl,qc,Yc),Zc=new Dc(Nc,kl);if(Xc.addPass(Zc),Yc){var Jc=new kc(Xc.renderTargetHD);Jc.src=Xc.renderTarget2,Xc.addPass(Jc)}var Kc=new Dc(Nc.hd,kl);Kc.autoClearColor=!1,Kc.autoClearDepth=Yc,Kc.hd=Yc,Xc.addPass(Kc);var Qc=new Uc({name:"postprocess",uniforms:Bc,vertexShader:Gc.value,fragmentShader:jc.value});Qc.uniforms=Bc,Qc.material.uniforms=Bc,Qc.hd=Yc,Qc.needsSwap=!1,Xc.addPass(Qc);var $c=Xc.render.bind(Xc);b(function(){Tl.listen($c)});var eu={};Pl.depthTexture&&(eu.uDepth={type:"t",value:Xc.renderTarget2.depthTexture}),eu.uReadDepthOverride={type:"f",value:1},Oc.listen(function(e){eu.uReadDepthOverride.value=e.controls.lock2D?0:1});var tu=new Qs.Vector3(5804542996261093e-21,13562911419845635e-21,3026590246882488e-20),nu=new Qs.Vector3(7633915830775757e-20,7544890573273999e-20,7411352687021361e-20),ru={luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},sunPosition:{type:"v3",value:new Qs.Vector3(0,0,0)},sunDirection:{type:"v3",value:new Qs.Vector3(0,0,0)},lightDirection:{type:"v3",value:new Qs.Vector3(0,0,0)},betaRM:{type:"v3",value:new Qs.Vector3(0,0,0)},betaRnorm:{type:"v3",value:new Qs.Vector3(0,0,0)},betaMnorm:{type:"v3",value:new Qs.Vector3(0,0,0)},constants:{type:"v4",value:new Qs.Vector4(0,0,0,0)},gamma:{type:"f",value:0},tonemapScale:{type:"f",value:0},update:function(){var e=ru.sunPosition.value,t=e.clone().normalize(),n=t.z;t.z=t.y,t.y=n,ru.sunDirection.value.copy(t);var r=e.clone().normalize();ru.lightDirection.value.copy(r);var i=ru.mieDirectionalG.value,o=Math.pow(.07957747154595*(1-i*i),-.666666666),a=-2*o*i,s=o*(i*i+1);ru.constants.value.y=a,ru.constants.value.z=s;var l=Math.pow(1-t.y,5);l=Qs.Math.clamp(l,0,1),ru.constants.value.w=l;var c=1-Qs.Math.clamp(1-Math.exp(e.z/45e4),0,1),u=ru.reileigh.value+c-1,h=.66666666666667*(Math.acos(t.y)-1.61107315568707),p=1e3*Math.max(0,1-Math.exp(h));ru.constants.value.x=19e3*p;var d=ru.turbidity.value,f=ru.mieCoefficient.value,m=tu.clone().multiplyScalar(u),v=nu.clone().multiplyScalar(d*f),g=new Qs.Vector3(p/(m.x+v.x),p/(m.y+v.y),p/(m.z+v.z)),y=m.clone().multiply(g).multiplyScalar(.01492077591487),x=v.clone().multiply(g);m.multiplyScalar(8400),v.multiplyScalar(1250),ru.betaRM.value.copy(m.add(v)),ru.betaRnorm.value.copy(y),ru.betaMnorm.value.copy(x);var b=1/(1.2+1.2*c);ru.gamma.value=b;var w=ru.luminance.value,S=1.7*Math.log(2/Math.pow(w,4))/Math.LN2;ru.tonemapScale.value=S}};ru.update();var iu=function(e){return(e*(.15*e+.05)+.004)/(e*(.15*e+.5)+.06)-.02/.3},ou={exposureBias:{type:"f",value:1},whitePoint:{type:"f",value:11.2},uTonemapExposureBias:{type:"f",value:1},uTonemapWhiteScale:{type:"f",value:1},update:function(){ou.uTonemapExposureBias.value=ou.exposureBias.value,ou.uTonemapWhiteScale.value=1/iu(ou.whitePoint.value)}},au=new Qs.Vector3,su=new Qs.Vector3,lu=!1,cu={uFogDropoff:{type:"f",value:6e-4},uFogIntensity:{type:"f",value:.1},uFogColor:{type:"c",value:new Qs.Color},update:function(e){lu=!e,e=e||Oc.getState(),au.copy(e.target).sub(e.position),au.z=au.y,au.y=0,au.normalize(),(lu||au.distanceToSquared(su)>.01)&&(cu.uFogColor.value.copy(function(e){var t=Math.max(0,e.y),n=t+Math.pow(17.6579343808112+260.4183050037293*t,-1.253),r=ru.betaRM.value.clone().multiplyScalar(-1/n);r.x=Math.exp(r.x),r.y=Math.exp(r.y),r.z=Math.exp(r.z);var i=ru.sunDirection.value.clone(),o=ru.constants.value.clone(),a=e.dot(i),s=a+1,l=ru.betaRnorm.value.clone(),c=ru.betaMnorm.value.clone();l.multiplyScalar(4+s*s),c.multiplyScalar(Math.pow(o.y*a+o.z,-1.5));var u=l.clone().add(c),h=new Qs.Vector3(Math.pow(u.x*(1-r.x),1.5),Math.pow(u.y*(1-r.y),1.5),Math.pow(u.z*(1-r.z),1.5));h.x*=1-o.w+o.w*Math.sqrt(u.x*r.x),h.y*=1-o.w+o.w*Math.sqrt(u.y*r.y),h.z*=1-o.w+o.w*Math.sqrt(u.z*r.z);var p=r.clone().multiplyScalar(.1),d=h.clone().add(p).multiplyScalar(.04).add(new Qs.Vector3(0,3e-4,75e-5)),f=ru.tonemapScale.value;d.multiplyScalar(f);var m=ru.gamma.value,v=ou.uTonemapExposureBias.value,g=ou.uTonemapWhiteScale.value;return d.x=Math.pow(v*iu(g*d.x),m),d.y=Math.pow(v*iu(g*d.y),m),d.z=Math.pow(v*iu(g*d.z),m),new Qs.Color(d.x,d.y,d.z)}(au)),su.copy(au))}};Oc.listen(cu.update);const uu=new rc({textureSize:256,poolSize:Yl});Gl.listen(({datasource:e})=>{e.imagery&&(uu.apiKey=e.imagery.apiKey,uu.urlFormat=e.imagery.urlFormat)});var hu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec3 tag;\nattribute vec4 tangent;\nattribute vec3 position;\nattribute vec4 color;\n\nuniform float uThickness;\nuniform vec3 uSelectedTag;\n\nvarying vec4 vColor;\nvarying float vAlpha;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nuniform vec2 uViewportInverse;\n\n// Calculate our position from the center and tangent of line\nvec4 positionFromTangent( const in vec3 center,\n                          const in float thickness ) {\n  // Get clipspace positions of center and center + tangent\n  vec4 p = vec4( center, 1.0 );\n  vec4 c4 = projectionMatrix * viewMatrix * p;\n\n  p.xyz += tangent.xyz;\n  vec4 cplust4 = projectionMatrix * viewMatrix * p;\n\n  // Tangent vector in clipspace (normalizing by w!)\n  vec2 t4 = cplust4.xy / cplust4.w - c4.xy / c4.w;\n\n  // Issue here when line is going towards screen, up and\n  // then down. The tangent will then flip from up to down\n  // and the line normal will also switch sides, leading\n  // to a fold in the quads forming the line\n  // Not really clear how to overcome this...\n\n  // Get normal in clipspace by crossing with vec3(0, 0, 1)\n  vec2 delt = t4.yx * vec2( 1.0, -1.0 ); // Move one side one way, the other the other way (tangent is opposite for vertices in pair)\n  delt = thickness * c4.w * normalize( delt ) * uViewportInverse;\n\n  c4.xy += delt;\n  return c4;\n}\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\nvoid main() {\n  // Vertices are placed based on tangent, to give constant width on screen\n  vec3 center = position;\n  center.z += getHeight( center.xy );\n  gl_Position = positionFromTangent( center, uThickness );\n\n  vColor = color;\n\n  // Is line selected?\n  float selected = step( distance( tag, uSelectedTag ), 0.0 );\n  gl_Position.z -= 0.5 + 0.01 * selected;\n  vColor.rgb = mix( vColor.rgb, vec3( 1.0 ), 0.8 * selected );\n\n  // Safe way to identify side of line\n  vAlpha = sign( tangent.w );\n\n  // Dashed line\n  // float D = ( viewMatrix * vec4( position, 1.0 ) ).z;\n  // Round to log values\n  // D = pow( 2.0, floor( log2( D ) ) );\n  // Modulate distance along line by depth\n  // float dash = position.w * D;\n\n}\n"),pu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform float uCutoff;\nuniform vec4 uOutlineColor;\n\nvarying vec4 vColor;\nvarying float vAlpha;\n\nvoid main() {\n  // Smoothly interpolate between:\n  // x: line color and edge color\n  // y: line alpha and transparent antialiased edge\n  vec2 f = smoothstep(\n   vec2( 0.4, 1.0 ) * uCutoff,\n   vec2( 0.5, 1.0 ),\n   abs( vec2( vAlpha ) ) );\n\n  // Multiply application of edge line with alpha\n  f.x *= uOutlineColor.a;\n\n  gl_FragColor = mix(\n    vColor,\n    vec4( uOutlineColor.rgb, 0.0 ),\n    f.xxxy );\n}\n");const du={uViewportInverse:{type:"v2",value:new Qs.Vector2(1,1)}};Dl.listen(({height:e,width:t})=>{du.uViewportInverse.value.set(1/t,1/e)});var fu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 uOrthoTransform;\nuniform vec3 cameraPosition;\nuniform float uLodScale;\n\nuniform vec3 uSelectedTag;\nuniform float uPixelRatio;\nuniform vec2 uViewportInverse;\nuniform float uReadDepthOverride;\n\n#ifdef READ_DEPTH\nuniform sampler2D uDepth;\n#endif\n\n// Can only have up to 16 attributes. Currently have 9\nattribute vec2 position; // Not instanced, defines quad to draw\n\nattribute vec4 anchor; // (xy: anchor, zw: anchor offset)\nattribute vec4 atlas; // (xy: location in atlas, zw: size in atlas)\nattribute vec4 background;\nattribute vec4 clipping; // (x: per-object depth, y: per-pixel depth)\nattribute vec4 color;\nattribute vec3 layout; // (x: padding, y: borderWidth, z: borderRadius)\nattribute vec4 normal; // (xyz: normal, w: collapseDistance)\nattribute vec4 offset; // (xyz: offset, w: fadeDistance)\nattribute vec4 tag; // (xyz: tag, w: highlightOpacity)\n\n// Can have max 8 varyings. Currently have 6\nvarying vec4 vUv; // (xy: uv, z: selected, w: visibility)\nvarying vec4 vBox;\nvarying vec4 vBackground;\nvarying vec4 vColor;\nvarying float vReadDepth;\nvarying vec3 vLayout;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// Normalized the input vector in place at the same\n// time as finding its lengt\n// Doesn't appear to be faster than length() & normalize() (same speed)\nfloat lengthNormalize( inout vec3 v ) {\n  float lengthSquared = dot( v, v );\n  float rcpLength = inversesqrt( lengthSquared );\n  v = rcpLength * v; // Normalized vector\n  return lengthSquared * rcpLength; // Vector length\n}\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\n// Size of atlas scaled by atlas pixel ratio\n// Also set in picker.vert\n#define SIZE vec2( 512.0, 1024.0 )\n\nvoid main() {\n  vec3 worldPosition = offset.xyz;\n  worldPosition.z = getHeight( worldPosition.xy );\n\n  // Pass on attributes for shading\n  vBackground = background;\n  vColor = color;\n  vLayout = uPixelRatio * layout;\n  vReadDepth = clipping.y * uReadDepthOverride;\n\n  // Fade with distance\n  vec3 reverseViewVec = cameraPosition - worldPosition;\n  float D = lengthNormalize( reverseViewVec );\n\n  // Convert from clip space to uv space\n  // position          --\x3e pointCoord\n  // (-1,+1) - (+1,+1)     (0,0) - (1,0)\n  //    |         |    --\x3e   |       |\n  // (-1,-1) - (-1,+1)     (0,1) - (1,1)\n  vec2 flipped = vec2( 1.0, -1.0 ) * position;\n  vec2 pointCoord = 0.5 * flipped + vec2( 0.5 );\n\n  // Are we selected?\n  vUv.z = step( distance( tag.xyz, uSelectedTag ), 0.0 );\n\n  // Collapse/fade the label\n  vec2 expandshow = vec2( normal.w, offset.w ) + 1000000.0 * vUv.zz;\n  expandshow = smoothstep( expandshow, vec2( 0.95, 0.9 ) * expandshow, vec2( D ) );\n  vUv.w = ( 0.6 * expandshow.x + 0.4 ) * expandshow.y;\n\n  // Opacity of highlight\n  vUv.z *= tag.w;\n\n  // Calculate potentially collapsed size of label\n  vec2 crop = mix( atlas.ww * vec2( SIZE.y / SIZE.x, 1.0 ),\n    atlas.zw, expandshow.x );\n  vUv.xy = atlas.xy + crop * pointCoord;\n\n  // Hide when on slope facing away, disabled when\n  // we perform per-pixel depth clipping\n  vUv.w *= smoothstep( 0.0, 0.15, clipping.y + dot( reverseViewVec, normal.xyz ) );\n  vUv.w *= step( 0.3, vUv.w );\n\n  // Adding padding & border around marker\n  vec2 padding = layout.xx + layout.yy;\n  vUv.xy += ( padding * flipped ) / SIZE;\n  vec2 aspect = SIZE * crop + 2.0 * padding;\n  aspect *= uPixelRatio;\n\n  // Position towards us so we show up above terrain\n  // Make bigger for object clipping as to avoid flashing\n  float bringForward = min( 0.5 * D, 100.0 + 200.0 * clipping.x );\n  vec4 p = vec4( worldPosition + bringForward * reverseViewVec, 1.0 );\n  //vec4 p = vec4( worldPosition, 1.0 );\n  gl_Position = projectionMatrix * viewMatrix * p;\n\n  // Convert between gl_Position.xy clip-space to pixels\n  vec2 pixelScale = 2.0 * gl_Position.w * uViewportInverse; \n\n  #ifdef READ_DEPTH\n  // Hide entire label if anchor obscured\n  vec3 uvz = 0.5 * gl_Position.xyz / gl_Position.w + vec3( 0.5 );\n  float fragCoordZ = texture2D( uDepth, uvz.xy ).x;\n\n  // Move back by amount relative to precision limit of depth\n  float b = projectionMatrix[3][2]; // -2 * far * near / ( far - near )\n  // Not entirely clear why 0.01 is correct, but lower\n  // than this leading to flashing on iOS\n  fragCoordZ /= 1.0 + 0.02 * fragCoordZ / b;\n\n  vUv.w *= step( clipping.x * uvz.z, fragCoordZ );\n  #endif\n\n  // Snap to position. Do this before applying anchor\n  // to ensure composite markers stay together without wobbling\n  // Final offset of vec2( 0.5 ) is to emulate round() using ceil()\n  gl_Position.xy = pixelScale * floor( gl_Position.xy / pixelScale + vec2( 0.5 ) );\n\n  // Half of box for marker in clipspace\n  vec2 halfSize = 0.5 * pixelScale * aspect;\n\n  // Shift entire marker based on anchor position\n  gl_Position.xy += pixelScale * ( 0.5 * anchor.xy * aspect + anchor.zw );\n\n  // Finally move out vertices to form quad\n  // First get clipspace of top-left point\n  gl_Position.xy -= halfSize;\n\n  // box in fragCoord space, xy: center, zw: width/height\n  const vec2 halfPixel = vec2( 0.5 );\n  vBox.xy = ( gl_Position.xy + halfSize - halfPixel ) / pixelScale + vec2( 0.5 ) / uViewportInverse;\n  vBox.zw = aspect;\n\n  // Now calculate other vertices (relative to top-left)\n  vec2 vertex = ( position + vec2( 1.0 ) ) * halfSize;\n\n  // Shift by half pixel so that we are snapped to pixel for sharper text\n  vertex -= halfPixel;\n\n  // Only expand to primitive if visible, otherwise collapse to degenerate\n  // triangle, avoiding the fragment shader having to execute\n  gl_Position.xy += step( 0.0001, vUv.w ) * vertex;\n\n  // Clamp border radius to sensible range\n  vLayout.z = min( vLayout.z, 0.5 * vBox.w - vLayout.y ); // no larger than half of box\n  vLayout.z = max( 0.0001, vLayout.z ); // 0 causes rendering issues\n}\n"),mu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\n#ifdef READ_DEPTH\nuniform sampler2D uDepth;\nuniform vec2 uViewportInverse;\n#endif\nuniform sampler2D uMap;\n\nvarying vec4 vUv;\nvarying vec4 vBox;\nvarying vec4 vBackground;\nvarying vec4 vColor;\nvarying float vReadDepth;\nvarying vec3 vLayout;\n\n#define SIZE 512.0\n\nvoid main() {\n  //gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n  //return;\n  // Partially hide label (per-pixel depth check)\n  #ifdef READ_DEPTH\n  float fragCoordZ = texture2D(uDepth, uViewportInverse * gl_FragCoord.xy).x;\n\n  float visibility = vUv.w * step( vReadDepth * gl_FragCoord.z, fragCoordZ );\n  #else\n  float visibility = vUv.w;\n  #endif\n\n  // Background color\n  gl_FragColor = vBackground;\n\n  // Padding\n  vec2 limit = 0.5 * vBox.zw - vec2( vLayout.x + vLayout.y );\n  vec2 clamped = clamp( gl_FragCoord.xy,\n      vBox.xy - limit,\n      vBox.xy + limit );\n  float inside = step( distance( clamped, gl_FragCoord.xy ), 0.0 );\n\n  // Image\n  // TODO not the correct blend operation, but works on black\n  // background\n  // Should switch to over operator\n  // e.g. https://en.wikipedia.org/wiki/Alpha_compositing\n  vec4 image = texture2D( uMap, vUv.xy );\n\n  // Mask out correct channel\n  // 1: R, 2: B, 3: G, 4: A - see atlas.js\n  vec4 channel = step( vec4( 1.0, 3.0, 2.0, 4.0 ), vec4( vUv.y ) );\n  channel *= step( vec4( vUv.y ), vec4( 2.0, 4.0, 3.0, 5.0 ) );\n  float monochrome = length( channel );\n  image = mix( image,\n               vec4( vec3( 1.0 ), dot( channel, image ) ),\n               monochrome );\n\n  // Clip image by padding\n  image.a *= inside;\n\n  // Colorize image\n  image *= vColor;\n\n  gl_FragColor.rgb = mix( gl_FragColor.rgb, image.rgb, image.a );\n  gl_FragColor.a = max( gl_FragColor.a, image.a );\n\n  // Radius of border\n  float radius = vLayout.z;\n\n  // Modify clamp to be circular\n  limit = 0.5 * vBox.zw - vec2( radius + vLayout.y );\n  clamped = clamp( gl_FragCoord.xy,\n                   vBox.xy - limit,\n                   vBox.xy + limit );\n  float d = distance( clamped, gl_FragCoord.xy );\n\n  // Draw border (similarly smoothstepping to reduce aliasing)\n  limit = vec2( max( radius - 1.0, 0.0 ), radius ); // Inner radius of border\n  float border = smoothstep( limit.x, limit.y, d );\n  border *= step( 0.4999, vLayout.y ); // Do not draw border if width less than 0.5\n  gl_FragColor = mix( gl_FragColor, vec4( 1.0 ), border );\n  limit += vLayout.yy; // Outer radius of border\n\n  // Fade out rounded border over one pixel to reduce aliasing\n  gl_FragColor.a *= smoothstep( limit.y, limit.x, d );\n\n  // Highlight and visibility\n  gl_FragColor.rgb += vUv.z;\n  gl_FragColor.a *= visibility;\n\n  // Debug\n  // Check that uv is always centered on texel\n  // Get constant color when we disable snapping\n  //gl_FragColor.rg = 10.0 * abs( fract( SIZE * vUv.xy ) - vec2( 0.5 ) );\n\n  // Display channel used\n  //gl_FragColor.rgb = mix( gl_FragColor.rgb, channel.rgb, vUv.z );\n\n  // Show entire quad\n  //gl_FragColor += vec4(1.0, 0.0, 0.0, 0.1);\n  if ( gl_FragColor.a < 0.0001 ) { discard; }\n}\n");const vu={uMap:{type:"t",value:null},uPixelRatio:{type:"f",value:1},uViewportInverse:{type:"v2",value:new Qs.Vector2(1,1)}};Dl.listen(({canvasHeight:e,pixelRatio:t,canvasWidth:n})=>{vu.uViewportInverse.value.set(1/n,1/e),vu.uPixelRatio.value=t});var gu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec3 position;\n\nvarying vec3 vPosition;\n\nvoid main() {\n  vPosition = position.xzy;\n  vPosition.y = max( 0.0, vPosition.y );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"),yu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nvarying vec3 vPosition;\n\n// Not including sun disk for now as we rarely see it anyway\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// Derived uniforms\nuniform vec3 sunDirection;\nuniform vec3 betaRM;\nuniform vec3 betaRnorm;\nuniform vec3 betaMnorm;\nuniform vec4 constants; // sunE, hgPhaseA, hgPhaseB & LinWeight\nuniform float gamma;\nuniform float tonemapScale;\n\n// Safe functions\nfloat spow( const float x, const float y ) {\n  return pow( abs( x ), y );\n}\n\nvec3 spow( const vec3 x, const vec3 y ) {\n  return pow( abs( x ), y );\n}\n\nvec3 ssqrt( const vec3 x ) {\n  return sqrt( abs( x ) );\n}\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nconst float A = 0.15;\nconst float B = 0.50;\nconst float C = 0.10;\nconst float D = 0.20;\nconst float E = 0.02;\nconst float F = 0.30;\n\nuniform float uTonemapExposureBias;\nuniform float uTonemapWhiteScale;\n\nvec3 RawTonemap( vec3 x )\n{\n  return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\n\nvec3 Tonemap( vec3 color ) {\n  return uTonemapExposureBias * RawTonemap( uTonemapWhiteScale * color );\n}\n\n\nvec3 skyColor( vec3 direction ) {\n  float cosZenithAngle = max( 0.0, direction.y );\n  // Approximate acos( x ) by pi/2 - x\n  // This allows us to simplify and error is only large when looking up\n  float denom = cosZenithAngle + spow( 17.6579343808112 + cosZenithAngle * 260.41830500372932, -1.253 );\n\n  // combined extinction factor\t\n  vec3 Fex = exp( -betaRM / denom );\n\n  // in scattering\n  float cosTheta = dot( direction, sunDirection );\n  float rPhase = cosTheta + 1.0;\n  vec3 betaRTheta = betaRnorm * ( 4.0 + rPhase * rPhase );\n  vec3 betaMTheta = betaMnorm * spow( constants.y * cosTheta + constants.z, -1.5 );\n\n  vec3 tmp = betaRTheta + betaMTheta;\n  vec3 Lin = spow( tmp * ( 1.0 - Fex ), vec3( 1.5 ) );\n  Lin *= mix( vec3( 1.0 ), ssqrt( tmp * Fex ), constants.w );\n\n  // nightsky\n  vec3 L0 = 0.1 * Fex;\n\n  #ifdef SUN_DISK\n  L0 += constants.x * Fex * smoothstep( 0.9999566769, 0.9999766769, cosTheta );\n  #endif\n\n  // Combine all components\n  vec3 color = 0.04 * ( Lin + L0 ) + vec3( 0.0, 0.0003, 0.00075 );   \n  color = Tonemap( tonemapScale * color );\n  return spow( color, vec3( gamma ) );\n}\n\n\nvoid main() {\n  vec3 direction = normalize( vPosition );\n  vec3 color = skyColor( direction );\n  // Stars\n  //float r = 500.0;\n  //vec3 rounded = floor( 0.4999999 + r * direction ) / r;\n  //float hash = fract( sin( 21041.4 * rounded.x ) + sin( 317041.4 * rounded.z ) + sin( 210041.4 * rounded.x ) + sin( 217041.4 * rounded.y ));\n  //float star = distance( rounded, direction );\n  //star = smoothstep( 0.5 / r, 0.0, star );\n  //color += vec3( star * smoothstep( 0.97, 1.0, hash ) * smoothstep( 0.01, 0.05, direction.y) );\n  gl_FragColor = vec4( color, 1.0 );\n}\n");function xu(){this.selected=null,this.bindListeners({animateAlongFeature:s.animateAlongFeature,onFeatureSelected:s.featureSelected})}xu.prototype.animateAlongFeature=function(){this.selected=null},xu.prototype.onFeatureSelected=function(e){this.selected=e},xu.displayName="FeaturesStore";var bu=o.createStore(xu);const wu={uSelectedTag:{type:"c",value:new Qs.Color}};bu.listen(({selected:e})=>{var t=e&&e.tag?e.tag:65536;wu.selectedTag.value.set(t)});var Su=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\n\nattribute vec4 position;\n\nuniform vec4 uOffset;\nuniform vec4 uImageryUvOffset;\n\nvarying vec4 vUV;\nvarying float D;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\nvoid main() {\n  // Move into place by shifting instanced position by tile offset\n  vec4 p = vec4( position.xy, 0.0, 1.0 );\n  p.xy *= uOffset.z; // Scale\n  p.xy += uOffset.xy; // Shift\n\n  // Extract the height (for skirting from the uv)\n  vec2 skirt = 10.0 * floor( position.zw / 10.0 );\n  vec2 uv = position.zw - skirt;\n\n  p.z = getHeight( p.xy );\n\n  // Pull down skirt vertices\n  p.z -= 0.01 * uOffset.z * skirt.x;\n\n  // Scale image uv lookup for fragment shader\n  vUV.xy = uImageryUvOffset.z * uv.xy + uImageryUvOffset.xy;\n  vUV.zw = uv.xy;\n\n  // Distance for fog\n  D = distance( cameraPosition, p.xyz );\n\n\tgl_Position = projectionMatrix * viewMatrix * p;\n}\n"),Tu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\n//#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform vec4 uImageryUvOffset;\n\nvarying vec4 vUV; // xy: scaled for imagery lookup, zw: actual uv across tile\n\nvarying float D;\n\nuniform lowp sampler2D imageryArray;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nuniform float uFogDropoff;\nuniform float uFogIntensity;\nuniform vec3 uFogColor;\n\nfloat fogFactor( in float dist ) {\n  float fog = uFogIntensity *  ( 1.0 - exp( -dist * uFogDropoff ) );\n  return clamp( fog, 0.0, 1.0 );\n}\n\nfloat fogFactor( in vec3 camera, in vec3 pos ) {\n  float dist = distance( camera, pos );\n  return fogFactor( dist );\n}\n\n\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 16.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 256.0\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nvoid main() {\n  vec3 color = readTex( imageryArray, vUV.xy, uImageryUvOffset.w ).rgb;\n\n  float fogAmount = fogFactor( D );\n  color = mix( color, uFogColor, fogAmount );\n\n  gl_FragColor = vec4( color, 1.0 );\n\n  //// Edge debug\n  //gl_FragColor.r *= 1.0 - dot( vec2( 1.0 ), step( vUV.xy, vec2( 0.01 ) ) );\n  //gl_FragColor.g *= 1.0 - dot( vec2( 1.0 ), step( vUV.zw, vec2( 0.01 ) ) );\n\n  // Error calc (mimics picker shader)\n  //vec4 error = dFdx( vUV );\n  //error *= 256.0;\n  //float E = log2( length( error.zw ) ) - 0.75;\n  //float cap = 0.75; // Value to cap error display at\n  //vec3 errorColor = mix( vec3( 1.0 ), vec3( 1.0, 0.0, 0.0 ),\n  //  max( 0.0, E / cap ) );\n  //errorColor = mix( errorColor, vec3( 0.0, 1.0, 0.0 ),\n  //  max( 0.0, -E / cap ) );\n\n  //// Tile outlines\n  //vec4 wire = smoothstep(\n  // 0.48, 0.49,\n  // fract( vec4( 1.0, -1.0, 1.0, -1.0 ) * 2.0 * vUV.zzww + vec4( 0.5 ) ) );\n  //float wireframe = min( 1.0, wire.x * wire.y + wire.z * wire.w );\n  //gl_FragColor.rgb = mix( gl_FragColor.rgb, errorColor, wireframe );\n}\n"),_u=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec4 position;\n\nuniform vec4 uOffset;\nuniform vec4 uImageryUvOffset;\nuniform vec3 uScaling; // xy: center pixel, z: downScaling\n\nvarying vec4 vUV;\n\n#define MANUAL_TEXTURE_BILINEAR 1\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\nvoid main() {\n  // Move into place by shifting instanced position by tile offset\n  vec4 p = vec4( position.xy, 0.0, 1.0 );\n  p.xy *= uOffset.z; // Scale\n  p.xy += uOffset.xy; // Shift\n\n  // Extract the height (for skirting from the uv)\n  vec2 skirt = 10.0 * floor( position.zw / 10.0 );\n  vec2 uv = position.zw - skirt;\n\n  p.z = getHeight( p.xy );\n\n  // Pull down skirt vertices\n  p.z -= 0.01 * uOffset.z * skirt.x;\n\n  // Pass values through to fragment shader\n  float tileId = uOffset.w;\n  vec2 encodedTileId = vec2(\n    floor( tileId / 256.0 ) / 256.0,\n    fract( tileId / 256.0 )\n    ) * ( 256.0 / 255.0 );\n\n  // Scale error to texture width\n  vUV.xy = uv.xy * uScaling.z;\n  vUV.zw = encodedTileId;\n\n\tgl_Position = projectionMatrix * viewMatrix * p;\n}\n"),Mu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\n#extension GL_OES_standard_derivatives : enable  \nprecision highp float;\n\nuniform vec3 uScaling; // xy: center pixel, z: downScaling\n\nvarying vec4 vUV; // xy: actual uv across tile, zw: encodedTileId\n\nvoid main() {\n  // Assess our screen space error, both for tile size and texture blur\n  // For now not actually using the texture blur error, as it is best to\n  // fetch just based on the tile geometry, makes things more stable\n  vec2 deltaUV = dFdx( vUV.xy );\n\n  float err = log2( length( deltaUV ) );\n\n  vec2 encodedTileId = vUV.zw;\n\n  // TODO perhaps we could encode this the same way we encode Z\n  // and save some instructions\n  // Store error clamped to range -5 > 5 (log encoded)\n  float encodedError = 0.1 * err + 0.5;\n\n  // Scale to fill 0->1 to 16bit capacity\n  float scaledZ = 256.0 * 255.0 * gl_FragCoord.z;\n  vec2 encodedZ = vec2(\n    floor( scaledZ / 256.0 ),\n    mod( scaledZ, 256.0 )\n   ) / 255.0;\n  float isCenter = step( distance( gl_FragCoord.xy, uScaling.xy ), 4.0 );\n\n  vec4 standard = vec4( encodedTileId, 0.0, encodedError );\n  vec4 centerPixels = vec4( 0.0, 0.0, encodedZ );\n  gl_FragColor = mix( standard, centerPixels, isCenter );\n}\n");const Eu={uScaling:{value:new Qs.Vector3}};[uc,hu,fu,Su,_u].forEach(e=>{Xl||e.define("MANUAL_TEXTURE_BILINEAR","1"),e.define("VIRTUAL_TEXTURE_ARRAY_BLOCKS",Math.sqrt(ql).toExponential()),e.define("VIRTUAL_TEXTURE_ARRAY_SIZE",256..toExponential())}),Tu.define("VIRTUAL_TEXTURE_ARRAY_BLOCKS",Math.sqrt(Yl).toExponential()),Tu.define("VIRTUAL_TEXTURE_ARRAY_SIZE",256..toExponential()),Pl.depthTexture&&(fu.define("READ_DEPTH",1),mu.define("READ_DEPTH",1));var Au={beacon:new Qs.RawShaderMaterial({name:"_beacon",uniforms:i.assign({uAccuracy:{type:"f",value:25},uTime:{type:"f",value:0}},lc),depthWrite:!1,vertexShader:uc.value,fragmentShader:hc.value,transparent:!0}),marker:(()=>{const e=new Qs.RawShaderMaterial({name:"marker",uniforms:i.assign({},eu,lc,vu,wu),vertexShader:fu.value,fragmentShader:mu.value,transparent:!0});return e.defaultAttributeValues={},e})(),line:i.memoize(function(e,t,n){var r=Math.max(.3,(t-2)/t),o=new pc(e);e=[o.r,o.g,o.b,o.a],void 0!==n?(void 0===(o=new pc(n)).a&&(o.a=1),n=new Qs.Vector4(o.r,o.g,o.b,o.a)):n=new Qs.Vector4(0,0,0,0);var a=new Qs.RawShaderMaterial({name:"line",uniforms:i.assign({uCutoff:{type:"f",value:r},uOutlineColor:{type:"c",value:n},uThickness:{type:"f",value:t}},lc,du,wu),vertexShader:hu.value,fragmentShader:pu.value,transparent:!0});return a.defaultAttributeValues.color=e,a}),sky:new Qs.RawShaderMaterial({name:"sky",uniforms:i.assign({},ru,ou),depthWrite:!1,vertexShader:gu.value,fragmentShader:yu.value,side:Qs.BackSide}),terrain:e=>{return{imagery:new Qs.RawShaderMaterial({uniforms:i.assign(e,{imageryArray:{value:uu.textureArray}},cu,lc),vertexShader:Su.value,fragmentShader:Tu.value}),picker:new Qs.RawShaderMaterial({uniforms:i.assign(e,lc,Eu),vertexShader:_u.value,fragmentShader:Mu.value})}}};Au.marker.index0AttributeName="offset",i.forOwn(Au,function(e){"RawShaderMaterial"===e.type&&(e.defaultAttributeValues={})});var Ru=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\n\nuniform float uPixelRatio;\nuniform vec2 uViewportCanvasInverse;\n\n// This material needs to handle both pistes and markers\n// which is tricky as their attributes mean different things\n// In particular position is instanced for markers but\n// not for pistes\n\n// Rather than have 2 materials we use the position attribute\n// to decide what we are rendering. Perhaps it is faster to have\n// two materials, but this is simpler and saves swapping programs\n\n// For markers the position attribute is 1, 1 or similar\n// assume that for pistes it is longer. A bit hacky but works\n// Using another attribute isn't reliable, e.g. we cannot\n// use the atlas which should be 0 for pistes as this randomly\n// fails. TODO investigate more robust solution\n\n// Shared attributes\nattribute vec3 tag;\nattribute vec3 position;\n\n// Piste attribute\nattribute vec3 tangent;\n\n// Marker attributes\nattribute vec4 atlas; // (xy: location in atlas, zw: size in atlas)\nattribute vec4 anchor; // (xy: anchor, z: per-object depth, w: per-pixel depth)\nattribute vec4 clipping; // (x: per-object depth, y: per-pixel depth)\nattribute vec3 layout; // (x: padding, y: borderWidth, z: borderRadius)\nattribute vec4 normal; // (xyz: normal, w: collapseDistance)\nattribute vec4 offset; // (xyz: offset, w: fadeDistance)\n\nvarying vec4 vTag;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// Normalized the input vector in place at the same\n// time as finding its lengt\n// Doesn't appear to be faster than length() & normalize() (same speed)\nfloat lengthNormalize( inout vec3 v ) {\n  float lengthSquared = dot( v, v );\n  float rcpLength = inversesqrt( lengthSquared );\n  v = rcpLength * v; // Normalized vector\n  return lengthSquared * rcpLength; // Vector length\n}\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\n#define TUBE_RADIUS 20.0\n#define SIZE vec2( 512.0, 1024.0 )\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nuniform vec2 uViewportInverse;\n\n// Calculate our position from the center and tangent of line\nvec4 positionFromTangent( const in vec3 center,\n                          const in float thickness ) {\n  // Get clipspace positions of center and center + tangent\n  vec4 p = vec4( center, 1.0 );\n  vec4 c4 = projectionMatrix * viewMatrix * p;\n\n  p.xyz += tangent.xyz;\n  vec4 cplust4 = projectionMatrix * viewMatrix * p;\n\n  // Tangent vector in clipspace (normalizing by w!)\n  vec2 t4 = cplust4.xy / cplust4.w - c4.xy / c4.w;\n\n  // Issue here when line is going towards screen, up and\n  // then down. The tangent will then flip from up to down\n  // and the line normal will also switch sides, leading\n  // to a fold in the quads forming the line\n  // Not really clear how to overcome this...\n\n  // Get normal in clipspace by crossing with vec3(0, 0, 1)\n  vec2 delt = t4.yx * vec2( 1.0, -1.0 ); // Move one side one way, the other the other way (tangent is opposite for vertices in pair)\n  delt = thickness * c4.w * normalize( delt ) * uViewportInverse;\n\n  c4.xy += delt;\n  return c4;\n}\n\n\nvoid main() {\n  vTag.rgb = tag;\n\n  // If we have a tag of zero, do not even draw\n  // TODO appears to break in Firefox!\n  float visible = 1.0 - step( length( tag ), 0.0 );\n\n  // Select which material this is\n  // TODO also broken on FF?\n  float l = length( position.x );\n  float isMarker = step( l, 1.00001 );\n  isMarker *= step( 0.99999, l );\n\n  // Lookup height\n  vec3 worldPosition = mix( position, offset.xyz, isMarker );\n  worldPosition.z = getHeight( worldPosition.xy );\n\n  // Render path for piste\n  vec4 piste = positionFromTangent( worldPosition, TUBE_RADIUS );\n\n  // Render path for markers\n  vec3 reverseViewVec = cameraPosition - worldPosition;\n  float D = lengthNormalize( reverseViewVec );\n\n  // Pack all into one varying xy: uv, z: selected, w: visibility\n  vec2 flipped = vec2( 1.0, -1.0 ) * position.xy;\n  vec2 pointCoord = 0.5 * flipped + vec2( 0.5 );\n\n  // Collapse/fade the label\n  vec4 vUv;\n  vec2 expandshow = vec2( normal.w, offset.w );\n  expandshow = smoothstep( expandshow, vec2( 0.95, 0.9 ) * expandshow, vec2( D ) );\n  vUv.w = ( 0.6 * expandshow.x + 0.4 ) * expandshow.y;\n\n  // Calculate potentially collapsed size of label\n  vec2 crop = mix( atlas.ww * vec2( SIZE.y / SIZE.x, 1.0 ),\n    atlas.zw, expandshow.x );\n  vUv.xy = atlas.xy + crop * pointCoord;\n\n  // Hide when on slope facing away, disabled when\n  // we perform per-pixel depth clipping\n  vUv.w *= smoothstep( 0.0, 0.15, clipping.y + dot( reverseViewVec, normal.xyz ) );\n  vUv.w *= step( 0.3, vUv.w );\n\n  // Adding padding & border around marker\n  vec2 padding = layout.xx + layout.yy;\n  vUv.xy += ( padding * flipped ) / SIZE;\n  vec2 aspect = SIZE * crop + 2.0 * padding;\n  aspect *= uPixelRatio;\n\n  // Position towards us so we show up above terrain\n  // Make bigger for object clipping as to avoid flashing\n  float bringForward = min( 0.5 * D, 100.0 + 200.0 * clipping.x );\n  vec4 p = vec4( worldPosition + bringForward * reverseViewVec, 1.0 );\n  //vec4 p = vec4( worldPosition, 1.0 );\n  vec4 marker = projectionMatrix * viewMatrix * p;\n\n  // Pixel-snapping (means we can use nearest filtering on texture)\n  vec2 pixelScale = uPixelRatio * marker.w * uViewportCanvasInverse; \n\n  #ifdef READ_DEPTH\n  // Hide entire label if anchor obscured\n  vec3 uvz = 0.5 * marker.xyz / marker.w + vec3( 0.5 );\n  float fragCoordZ = texture2D( uDepth, uvz.xy ).x;\n\n  // Move back by amount relative to precision limit of depth\n  float b = projectionMatrix[3][2]; // -2 * far * near / ( far - near )\n  // Not entirely clear why 0.01 is correct, but lower\n  // than this leading to flashing on iOS\n  fragCoordZ /= 1.0 + 0.02 * fragCoordZ / b;\n\n  vUv.w *= step( clipping.x * uvz.z, fragCoordZ );\n  #endif\n\n  marker.xy = pixelScale * floor( marker.xy / pixelScale );\n\n  // Half of box for marker in clipspace\n  vec2 halfSize = 0.5 * pixelScale * aspect;\n\n  // Shift entire marker based on anchor position\n  marker.xy += pixelScale * ( 0.5 * anchor.xy * aspect + anchor.zw );\n\n\n  // Finally move out vertices to form quad\n  // First get clipspace of top-left point\n  marker.xy -= halfSize;\n\n  // Now calculate other vertices (relative to top-left)\n  vec2 vertex = ( position.xy + vec2( 1.0 ) ) * halfSize;\n  marker.xy += vertex;\n\n  gl_Position = visible * mix( piste, marker, isMarker );\n}\n"),Cu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nvarying vec4 vTag;\n\nvoid main() {\n  gl_FragColor = vTag;\n  // For testing draw more visible colors\n  //gl_FragColor.rgb = mod( 10000.0 * vTag.rgb, vec3( 1.0 ) );\n  //gl_FragColor.a = 1.0;\n}\n");const Ou={uPixelRatio:{type:"f",value:1},uViewportCanvasInverse:{type:"v2",value:new Qs.Vector2(1,1)},uViewportInverse:{type:"v2",value:new Qs.Vector2(1,1)}};Dl.listen(({canvasHeight:e,canvasWidth:t,height:n,width:r,pixelRatio:i})=>{Ou.uViewportCanvasInverse.value.set(1/t,1/e),Ou.uViewportInverse.value.set(1/r,1/n),Ou.uPixelRatio.value=i});var Pu,Lu,zu,Fu,Iu,Du,ku,Uu,Nu,Bu=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec4 position;\n\nuniform vec4 uOffset;\n\nvarying vec2 vPosition;\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// TODO set these from JS\n#define VIRTUAL_TEXTURE_ARRAY_BLOCKS 4.0\n#define VIRTUAL_TEXTURE_ARRAY_SIZE 512.0\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// On iOS standard texture linear filtering has\n// artifacts, so use this manual replacement.\n// It also doesn't work for FLOAT textures\n#define TEX_SIZE (VIRTUAL_TEXTURE_ARRAY_SIZE * VIRTUAL_TEXTURE_ARRAY_BLOCKS)\nconst vec2 texelSize = vec2( 1.0 / TEX_SIZE, 0.0 );\nvec4 texture2D_bilinear( const in sampler2D t, in vec2 uv )\n{\n  // Calculate pixels to sample and interpolating factor\n  uv -= 0.5 * texelSize.xx;\n  vec2 f = fract( uv * TEX_SIZE );\n  // Snap to corner of texel and then move to center\n  vec2 uvSnapped = uv - texelSize.xx * f + 0.5 * texelSize.xx;\n\n  #ifdef HEIGHT_LOOKUP_BIAS\n  // As we are sampling snapped pixels need to override\n  // the mip-map selection by selecting a large negative\n  // bias. Otherwise at boundaries the gradient of\n  // uvSnapped is large and an incorrect mip-level is used\n  // leading to artifacts\n  vec4 tl = texture2D(t, uvSnapped, -10.0);\n  vec4 tr = texture2D(t, uvSnapped + texelSize, -10.0 );\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx, -10.0 );\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx, -10.0 );\n  #else\n  vec4 tl = texture2D(t, uvSnapped);\n  vec4 tr = texture2D(t, uvSnapped + texelSize);\n  vec4 bl = texture2D(t, uvSnapped + texelSize.yx);\n  vec4 br = texture2D(t, uvSnapped + texelSize.xx);\n  #endif\n  vec4 tA = mix( tl, tr, f.x );\n  vec4 tB = mix( bl, br, f.x );\n  return mix( tA, tB, f.y );\n}\n\n// Virtual texture array lookup (WebGL1 fallback)\nvec4 readTex( in sampler2D tex, in vec2 uv, in float index ) {\n  // Convert index into spatial offset\n  vec2 offset = vec2(\n    mod( float( index ), VIRTUAL_TEXTURE_ARRAY_BLOCKS ),\n    floor( float( index ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS )\n  );\n\n  // Don't bleed across to next texture\n  const float padding = 0.5;\n  vec2 limits = vec2( padding, VIRTUAL_TEXTURE_ARRAY_SIZE - padding ) / VIRTUAL_TEXTURE_ARRAY_SIZE; \n\n  // Calculate uv for lookup\n  vec2 scaledUv = ( clamp( uv, limits.x, limits.y ) + offset ) / VIRTUAL_TEXTURE_ARRAY_BLOCKS;\n  #ifdef MANUAL_TEXTURE_BILINEAR\n  return texture2D_bilinear( tex, scaledUv );\n  #else\n  return texture2D( tex, scaledUv );\n  #endif\n}\n\n\nuniform lowp sampler2D indirectionTexture;\nuniform vec2 uGlobalOffset;\nuniform float uSceneScale;\n\n// Function to scale height such that one unit in the\n// horizontal plane is equal to one vertical unit\n// Basically comes down to the Mercator projection\n// Math.pow(2, 15) / 40075016.686\nconst float earthScale = 0.0008176665341588574;\nfloat heightScale ( in float y ) {\n  // PI - 2 * PI * y / pow( 2, 10 ) [ z is fixed to 10 ]\n  float n = 3.141592653589793 - 0.006135923151542565 * y;\n  // cosh( n ) / ( earthScale * uSceneScale)\n  float cosh_n = dot( vec2( 0.5 ), exp( vec2( n, -n ) ) );\n  return cosh_n / ( earthScale * uSceneScale );\n}\n\n// TODO should this be highp? Seems OK on iOS\n// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n//     If you have a float texture, iOS requires that you use highp sampler2D foo;\n//     or it will very painfully give you lowp texture samples!\n//     (+/-2.0 max is probably not good enough for you)\n// +/-2 seems OK, but should revisit if artifacts present\nuniform lowp sampler2D elevationArray;\nfloat getHeight( in vec2 p ) {\n  // Get tile coord (at z = 10), currently we are at z = 15\n  const float zoomScale = 32.0; // pow( 2, 15 - 10 )\n  const float indirectionSize = 1024.0;\n  vec2 tile = p.xy - uGlobalOffset;\n  tile /= ( uSceneScale * zoomScale );\n  tile *= vec2( 1.0, -1.0 );\n\n  // Unsnapped uv will be used below for secondary lookup\n  vec2 indirectionUv = tile / indirectionSize;\n\n  // Snap as on Windows/ANGLE Nearest filtering is not respected\n  const vec2 halfTexel = vec2( 0.5 );\n  vec2 snapped = ( floor( tile - halfTexel ) + halfTexel );\n  snapped += step( halfTexel, tile - snapped );\n  vec2 indirectionUvRounded = snapped / indirectionSize;\n\n  vec4 indirection = texture2D( indirectionTexture, indirectionUvRounded );\n\n  // Update index from indirection\n  float index = indirection.r;\n  float tileSize = indirection.g;\n  vec2 tileOrigin = indirection.ba;\n\n  // We know index of texture to do lookup in, but now\n  // we need to know the uv coordinates within the tile\n  // For this we need to know what the tile origin and size are\n  // At first glance it might seem possible to derive the tile origin\n  // mathematically from the indirectionUv (using `fract`), but the issue\n  // then is numerical precision. On some GPUs the lack of precision\n  // means that the data we read from the indirection texture doesn't\n  // align with that derived in the shader. It is more reliable to\n  // store the entire transformation from the indirectionUv to\n  // scaledUv in the texture, that way it will be no spurious errors\n  vec2 scaledUv = indirectionUv * tileSize + tileOrigin;\n\n  // Finally read out height, and unpack to single float\n  return heightScale( tile.y ) * readTex( elevationArray, scaledUv, index ).a;\n}\n\n\n// TODO, not yet working, but shader should look something like this\nvoid main() {\n  // Move into place by shifting instanced position by tile offset\n  vec4 p = vec4( position.xy, 0.0, 1.0 );\n  p.xy *= uOffset.z; // Scale\n  p.xy += uOffset.xy; // Shift\n\n  vPosition = p.xy + vec2( 32768.0 );\n  p.z = getHeight( p.xy );\n\tgl_Position = projectionMatrix * viewMatrix * p;\n}\n"),ju=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\nvarying vec2 vPosition;\n\nvoid main() {\n  // Pack position xy into RGBA\n  gl_FragColor = vec4( mod( vPosition.xy, 256.0 ),\n                       floor( vPosition.xy / 256.0 ) ) / 255.0;\n}\n"),Gu={mouse:{x:0,y:0},raycastPosition:new Qs.Vector3,init:function(){Gu.resolution=.2;var e=new Qs.RawShaderMaterial({name:"picker",uniforms:i.assign({},lc,Ou),vertexShader:Ru.value,fragmentShader:Cu.value});e.defaultAttributeValues=Au.marker.defaultAttributeValues,Gu.pickerScene=new Qs.Scene,Gu.pickerScene.overrideMaterial=e,Gu.pickerScene.lastCameraPosition=kl.position.clone();var t=new Qs.RawShaderMaterial({name:"raycast",uniforms:lc,vertexShader:Bu.value,fragmentShader:ju.value});Gu.raycastScene=new Qs.Scene,Gu.raycastScene.overrideMaterial=t;var n=Dl.getState(),r={minFilter:Qs.NearestFilter,magFilter:Qs.NearestFilter};Gu.renderTarget=new Qs.WebGLRenderTarget(Gu.resolution*n.width,Gu.resolution*n.height,r),Gu.renderTarget1px=new Qs.WebGLRenderTarget(1,1,r),Gu.viewOffsetWidth=n.width,Gu.viewOffsetHeight=n.height,Gu.buffer=new Uint8Array(4)},stores:[],tagId:1,featureIdtoTagId:new Map,registerStore:function(e){-1===Gu.stores.indexOf(e)&&Gu.stores.push(e),e.data.forEach(function(e){!1!==e.properties.selectable&&(void 0!==e.id?((Lu=Gu.featureIdtoTagId.get(e.id))||(Lu=Gu.tagId++,Gu.featureIdtoTagId.set(e.id,Lu)),e.tag=Lu):(e.tag=Gu.tagId++,e.id=1e6+Gu.tagId++))})},pickFeature:function(e){for(Gu.mouse.x=e.x,Gu.mouse.y=e.y,e.clipspace&&(Gu.mouse=Dl.fromClipSpace(Gu.mouse)),Gu.mouse.x=Gu.resolution*Gu.mouse.x,Gu.mouse.y=Gu.renderTarget.height-Gu.resolution*Gu.mouse.y,Gu.pickerScene.lastCameraPosition.equals(kl.position)||(Gu.pickerScene.lastCameraPosition.copy(kl.position),Zl.setRenderTarget(Gu.renderTarget),Zl.render(Gu.raycastScene,kl),Pu=Zl.autoClearDepth,Zl.autoClearDepth=!1,Zl.render(Gu.pickerScene,kl),Zl.autoClearDepth=Pu),Zl.readRenderTargetPixels(Gu.renderTarget,Gu.mouse.x,Gu.mouse.y,1,1,Gu.buffer),zu=Gu.buffer[0]<<16|Gu.buffer[1]<<8|Gu.buffer[2],wu.uSelectedTag.value.set(0===zu?65536:zu),Iu=0,Du=Gu.stores.length;Iu<Du;Iu++)for(Fu=Gu.stores[Iu],Uu=0,Nu=Fu.data.length;Uu<Nu;Uu++)if((ku=Fu.data[Uu]).tag===zu)return ku;return null},raycastTerrain:function(e){return Gu.mouse.x=e.x,Gu.mouse.y=e.y,e.clipspace&&(Gu.mouse=Dl.fromClipSpace(Gu.mouse)),kl.setViewOffset(Gu.viewOffsetWidth,Gu.viewOffsetHeight,Gu.mouse.x,Gu.mouse.y,1,1),Zl.setRenderTarget(Gu.renderTarget1px),Zl.render(Gu.raycastScene,kl),Zl.readRenderTargetPixels(Gu.renderTarget1px,0,0,1,1,Gu.buffer),kl.clearViewOffset(),Gu.raycastPosition.set(Gu.buffer[0]+256*Gu.buffer[2]-32768,Gu.buffer[1]+256*Gu.buffer[3]-32768),32768===Gu.raycastPosition.x&&32768===Gu.raycastPosition.y?null:(Gu.raycastPosition.z=sc(Gu.raycastPosition),Gu.raycastPosition)},render:function(){Zl.setScissorTest(!0);var e=Gu.mouse.x/Gu.resolution,t=(Gu.renderTarget.height-Gu.mouse.y)/Gu.resolution;Zl.setScissor(e-50,t-50,100,100),Zl.render(Gu.raycastScene,kl),Pu=Zl.autoClearDepth,Zl.autoClearDepth=!1,Zl.setClearColor("#ff0000",1),Zl.render(Gu.pickerScene,kl),Zl.autoClearDepth=Pu,Zl.setScissorTest(!1)}};function Hu(){this.data={},this.bindListeners({clearFeatures:s.setCurrentPlace,addOverlay:[h.addOverlay,h.removeOverlay]})}Dl.listen(function(e){Gu.renderTarget.setSize(Gu.resolution*e.width,Gu.resolution*e.height),Gu.viewOffsetWidth=e.width,Gu.viewOffsetHeight=e.height}),Tl.listen(function(e){e.animating&&(Gu.pickerScene.lastCameraPosition.x+=1e6)}),Gu.init(),Hu.prototype.clearFeatures=function(){return this.data=[],!1},Hu.prototype.addOverlay=function(){this.waitFor(yl);var e=yl.getState().lines;if(i.isEqual(this.data,e))return!1;this.data=e.concat(),Gu.registerStore(this)},Hu.displayName="LineData";var Vu=o.createStore(Hu);const Wu={};function qu(){this.bindListeners({featureClicked:s.featureClicked,featureSelected:s.featureSelected,overlayDisplayed:a.overlayDisplayed})}var Yu=function(e){if(void 0!==e){if(Array.isArray(e))return e.map(Yu);if(e.geometry)return i.find(Vu.getState().data,i.matchesProperty("geometry",e.geometry));var t=i.find(Vu.getState().data,i.matchesProperty("id",e));return t||(t||((t=i.find(yl.getState().points,i.matchesProperty("id",e)))?t:t=i.find(yl.getState().markers,i.matchesProperty("id",e))))}};Wu.addBuiltinOverlay=function(e){setTimeout(function(){h.addBuiltinOverlay(e)},0)},Wu.addOverlay=function(e){setTimeout(function(){h.addOverlay(e)},0)},Wu.updateOverlay=function(e){setTimeout(function(){h.updateOverlay(e)},0)},Wu.removeOverlay=function(e){setTimeout(function(){h.removeOverlay(e)},0)},Wu.highlightFeature=function(e){var t=Yu(e);t&&setTimeout(function(){s.featureSelected(t)})},Wu.focusOnFeature=function(e){var t=Yu(e);t&&setTimeout(function(){s.focusOnFeature(t)})},Wu.selectFeatures=function(e){e&&setTimeout(function(){s.selectFeatures(e)})};var Xu=null;qu.prototype.featureSelected=function(e){Xu!==e&&(Xu=e,"function"==typeof Wu.onFeatureSelected&&e&&void 0!==e.id&&Wu.onFeatureSelected(e.id))},qu.prototype.featureClicked=function(e){"function"==typeof Wu.onFeatureClicked&&e&&void 0!==e.id&&Wu.onFeatureClicked(e.id)},qu.prototype.overlayDisplayed=function(e){"function"==typeof Wu.onOverlayAdded&&e&&Wu.onOverlayAdded(e)},qu.displayName="FeaturesExport",o.createStore(qu);const Zu={play:function(){setTimeout(function(){a.play()},0)},pause:function(){setTimeout(function(){a.pause()},0)}},Ju={setUserLocation:function(e){var t;t=void 0!==e.latitude&&void 0!==e.longitude?{coords:e}:e,setTimeout(function(){wl.panToPosition(t)},0)},toggleUserLocationTracking:function(){setTimeout(function(){wl.toggleTracking()},0)}},Ku={setCameraModeControlVisible:function(e){setTimeout(function(){c.setCameraModeControlVisible(e)},0)},setCompassVisible:function(e){setTimeout(function(){c.setCompassVisible(e)},0)},setRotationControlVisible:function(e){setTimeout(function(){c.setRotationControlVisible(e)},0)},setUserLocationControlVisible:function(e){setTimeout(function(){c.setUserLocationControlVisible(e)},0)},setZoomControlVisible:function(e){setTimeout(function(){c.setZoomControlVisible(e)},0)}};var Qu=t(n(function(e,t){!function(e){function t(e,t){var n=L,r=void 0,i=void 0,o=void 0,a=void 0;for(a=arguments.length;a-- >2;)P.push(arguments[a]);for(t&&null!=t.children&&(P.length||P.push(t.children),delete t.children);P.length;)if((i=P.pop())&&void 0!==i.pop)for(a=i.length;a--;)P.push(i[a]);else"boolean"==typeof i&&(i=null),(o="function"!=typeof e)&&(null==i?i="":"number"==typeof i?i+="":"string"!=typeof i&&(o=!1)),o&&r?n[n.length-1]+=i:n===L?n=[i]:n.push(i),r=o;var s=new C;return s.nodeName=e,s.children=n,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==O.vnode&&O.vnode(s),s}function n(e,t){for(var n in t)e[n]=t[n];return e}function r(e,t){e&&("function"==typeof e?e(t):e.current=t)}function i(e,r){return t(e.nodeName,n(n({},e.attributes),r),arguments.length>2?[].slice.call(arguments,2):e.children)}function o(e){!e._dirty&&(e._dirty=!0)&&1==B.push(e)&&(O.debounceRendering||z)(a)}function a(){for(var e=void 0;e=B.pop();)e._dirty&&T(e)}function s(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&l(e,t.nodeName):n||e._componentConstructor===t.nodeName}function l(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function c(e){var t=n({},e.attributes);t.children=e.children;var r=e.nodeName.defaultProps;if(void 0!==r)for(var i in r)void 0===t[i]&&(t[i]=r[i]);return t}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,n,i,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)r(n,null),r(i,e);else if("class"!==t||o)if("style"===t){if(i&&"string"!=typeof i&&"string"!=typeof n||(e.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof n)for(var a in n)a in i||(e.style[a]="");for(var s in i)e.style[s]="number"==typeof i[s]&&!1===N.test(s)?i[s]+"px":i[s]}}else if("dangerouslySetInnerHTML"===t)i&&(e.innerHTML=i.__html||"");else if("o"==t[0]&&"n"==t[1]){var l=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),i?n||e.addEventListener(t,p,l):e.removeEventListener(t,p,l),(e._listeners||(e._listeners={}))[t]=i}else if("list"!==t&&"type"!==t&&!o&&t in e){try{e[t]=null==i?"":i}catch(e){}null!=i&&!1!==i||"spellcheck"==t||e.removeAttribute(t)}else{var c=o&&t!==(t=t.replace(/^xlink:?/,""));null==i||!1===i?c?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof i&&(c?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),i):e.setAttribute(t,i))}else e.className=i||""}function p(e){return this._listeners[e.type](O.event&&O.event(e)||e)}function d(){for(var e=void 0;e=j.shift();)O.afterMount&&O.afterMount(e),e.componentDidMount&&e.componentDidMount()}function f(e,t,n,r,i,o){G++||(H=null!=i&&void 0!==i.ownerSVGElement,V=null!=e&&!(U in e));var a=m(e,t,n,r,o);return i&&a.parentNode!==i&&i.appendChild(a),--G||(V=!1,o||d()),a}function m(e,t,n,r,i){var o=e,a=H;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0))),o[U]=!0,o;var s=t.nodeName;if("function"==typeof s)return _(e,t,n,r);if(H="svg"===s||"foreignObject"!==s&&H,s+="",(!e||!l(e,s))&&(o=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}(s,H),e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0)}var c=o.firstChild,u=o[U],h=t.children;if(null==u){u=o[U]={};for(var p=o.attributes,d=p.length;d--;)u[p[d].name]=p[d].value}return!V&&h&&1===h.length&&"string"==typeof h[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=h[0]&&(c.nodeValue=h[0]):(h&&h.length||null!=c)&&v(o,h,n,r,V||null!=u.dangerouslySetInnerHTML),x(o,t.attributes,u),H=a,o}function v(e,t,n,r,i){var o=e.childNodes,a=[],l={},c=0,h=0,p=o.length,d=0,f=t?t.length:0,v=void 0,y=void 0,x=void 0,b=void 0,w=void 0;if(0!==p)for(var S=0;S<p;S++){var T=o[S],_=T[U],M=f&&_?T._component?T._component.__key:_.key:null;null!=M?(c++,l[M]=T):(_||(void 0!==T.splitText?!i||T.nodeValue.trim():i))&&(a[d++]=T)}if(0!==f)for(var E=0;E<f;E++){b=t[E],w=null;var A=b.key;if(null!=A)c&&void 0!==l[A]&&(w=l[A],l[A]=void 0,c--);else if(h<d)for(v=h;v<d;v++)if(void 0!==a[v]&&s(y=a[v],b,i)){w=y,a[v]=void 0,v===d-1&&d--,v===h&&h++;break}w=m(w,b,n,r),x=o[E],w&&w!==e&&w!==x&&(null==x?e.appendChild(w):w===x.nextSibling?u(x):e.insertBefore(w,x))}if(c)for(var R in l)void 0!==l[R]&&g(l[R],!1);for(;h<=d;)void 0!==(w=a[d--])&&g(w,!1)}function g(e,t){var n=e._component;n?M(n):(null!=e[U]&&r(e[U].ref,null),!1!==t&&null!=e[U]||u(e),y(e))}function y(e){for(e=e.lastChild;e;){var t=e.previousSibling;g(e,!0),e=t}}function x(e,t,n){var r=void 0;for(r in n)t&&null!=t[r]||null==n[r]||h(e,r,n[r],n[r]=void 0,H);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||h(e,r,n[r],n[r]=t[r],H)}function b(e,t,n){var r=void 0,i=W.length;for(e.prototype&&e.prototype.render?(r=new e(t,n),E.call(r,t,n)):((r=new E(t,n)).constructor=e,r.render=w);i--;)if(W[i].constructor===e)return r.nextBase=W[i].nextBase,W.splice(i,1),r;return r}function w(e,t,n){return this.constructor(e,n)}function S(e,t,n,i,a){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=i),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,n!==F&&(n!==I&&!1===O.syncComponentUpdates&&e.base?o(e):T(e,I,a)),r(e.__ref,e))}function T(e,t,r,i){if(!e._disable){var o=e.props,a=e.state,s=e.context,l=e.prevProps||o,u=e.prevState||a,h=e.prevContext||s,p=e.base,m=e.nextBase,v=p||m,y=e._component,x=!1,w=h,_=void 0,E=void 0,A=void 0;if(e.constructor.getDerivedStateFromProps&&(a=n(n({},a),e.constructor.getDerivedStateFromProps(o,a)),e.state=a),p&&(e.props=l,e.state=u,e.context=h,t!==D&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(o,a,s)?x=!0:e.componentWillUpdate&&e.componentWillUpdate(o,a,s),e.props=o,e.state=a,e.context=s),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!x){_=e.render(o,a,s),e.getChildContext&&(s=n(n({},s),e.getChildContext())),p&&e.getSnapshotBeforeUpdate&&(w=e.getSnapshotBeforeUpdate(l,u));var R=_&&_.nodeName,C=void 0,P=void 0;if("function"==typeof R){var L=c(_);(E=y)&&E.constructor===R&&L.key==E.__key?S(E,L,I,s,!1):(C=E,e._component=E=b(R,L,s),E.nextBase=E.nextBase||m,E._parentComponent=e,S(E,L,F,s,!1),T(E,I,r,!0)),P=E.base}else A=v,(C=y)&&(A=e._component=null),(v||t===I)&&(A&&(A._component=null),P=f(A,_,s,r||!p,v&&v.parentNode,!0));if(v&&P!==v&&E!==y){var z=v.parentNode;z&&P!==z&&(z.replaceChild(P,v),C||(v._component=null,g(v,!1)))}if(C&&M(C),e.base=P,P&&!i){for(var k=e,U=e;U=U._parentComponent;)(k=U).base=P;P._component=k,P._componentConstructor=k.constructor}}for(!p||r?j.push(e):x||(e.componentDidUpdate&&e.componentDidUpdate(l,u,w),O.afterUpdate&&O.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);G||i||d()}}function _(e,t,n,r){for(var i=e&&e._component,o=i,a=e,s=i&&e._componentConstructor===t.nodeName,l=s,u=c(t);i&&!l&&(i=i._parentComponent);)l=i.constructor===t.nodeName;return i&&l&&(!r||i._component)?(S(i,u,k,n,r),e=i.base):(o&&!s&&(M(o),e=a=null),i=b(t.nodeName,u,n),e&&!i.nextBase&&(i.nextBase=e,a=null),S(i,u,I,n,r),e=i.base,a&&e!==a&&(a._component=null,g(a,!1))),e}function M(e){O.beforeUnmount&&O.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?M(n):t&&(null!=t[U]&&r(t[U].ref,null),e.nextBase=t,u(t),W.push(e),y(t)),r(e.__ref,null)}function E(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function A(e,t,n){return f(n,e,{},!1,t,!1)}function R(){return{}}var C=function(){},O={},P=[],L=[],z="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,F=0,I=1,D=2,k=3,U="__preactattr_",N=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,B=[],j=[],G=0,H=!1,V=!1,W=[];n(E.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=n(n({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),o(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),T(this,D)},render:function(){}}),e.default={h:t,createElement:t,cloneElement:i,createRef:R,Component:E,render:A,rerender:a,options:O},e.h=t,e.createElement=t,e.cloneElement=i,e.createRef=R,e.Component=E,e.render=A,e.rerender=a,e.options=O,Object.defineProperty(e,"__esModule",{value:!0})}(t)})),$u={constructor:1,render:1,shouldComponentUpdate:1,componentWillReceiveProps:1,componentWillUpdate:1,componentDidUpdate:1,componentWillMount:1,componentDidMount:1,componentWillUnmount:1,componentDidUnmount:1};var eh=Qu;eh.createClass=function(e){function t(e,t){!function(e){for(var t in e){var n=e[t];"function"!=typeof n||n.__bound||$u.hasOwnProperty(t)||((e[t]=n.bind(e)).__bound=!0)}}(this),Qu.Component.call(this,e,t)}var n=t.prototype=new Qu.Component;for(var r in e)n[r]=e[r];return n.constructor=t};var th,nh,rh,ih,oh,ah,sh=eh.render;eh.render=function(e,t){t.innerHTML=null,sh(e,t)};var lh=function(e){if("set"!==e.slice(0,3))throw new Error("Action must be called setX");return e.charAt(3).toLowerCase()+e.slice(4)};function ch(e){function t(){var t={};for(th=0,nh=e.length;th<nh;th++)rh=e[th],ih=rh[0],ah=rh[1],oh=ih.data.name,this[lh(oh)]=ah,t[oh]=ih;this.bindListeners(t)}for(th=0,nh=e.length;th<nh;th++)rh=e[th],ih=rh[0],oh=ih.data.name,t.prototype[oh]=function(e){return function(t){this[e]=t}}(lh(oh));return t}var uh=ch([[s.setCurrentPlace,{}]]);uh.displayName="PlacesStore";var hh=o.createStore(uh);function ph(){this.featuresLoaded=!1,this.renderedFeatureStatus={},this.featuresRendered=!1,this.bindListeners({renderedFeatureRegister:a.renderedFeatureRegister,renderedFeatureDisplayed:a.renderedFeatureDisplayed,setCurrentPlace:s.setCurrentPlace,setFeatures:h.setFeatures})}ph.prototype.setCurrentPlace=function(){this.featuresLoaded=!1;for(var e=Object.keys(this.renderedFeatureStatus),t=0;t<e.length;t++)this.renderedFeatureStatus[e[t]]=!1;this.featuresRendered=!1,this.waitFor(hh);var n=hh.getState().currentPlace;setTimeout(function(){const e={longitude:n.location[0],latitude:n.location[1],angle:40,distance:5e3,bearing:0,animationDuration:.5};sc(e,t=>{e.height=t,s.focusOnLocation(e)})},0)},ph.prototype.setFeatures=function(){this.waitFor(vl),this.featuresLoaded=!0},ph.prototype.renderedFeatureRegister=function(e){return this.renderedFeatureStatus[e]=!1,!1},ph.prototype.renderedFeatureDisplayed=function(e){this.renderedFeatureStatus[e]=!0;var t=Object.keys(this.renderedFeatureStatus);this.featuresRendered=this.featuresLoaded;for(var n=0;n<t.length;n++){this.renderedFeatureStatus[t[n]]||(this.featuresRendered=!1)}return this.featuresRendered},ph.displayName="EngineStore",o.createStore(ph);var dh=ch([[s.setEnvironment,{}]]);dh.displayName="EnvironmentStore";var fh=o.createStore(dh),mh={};mh.update=function(){ru.turbidity.value=mh.turbidity,ru.reileigh.value=mh.reileigh,ru.luminance.value=mh.luminance,ru.mieCoefficient.value=mh.mieCoefficient,ru.mieDirectionalG.value=mh.mieDirectionalG;var e=Math.PI*(mh.inclination-.5),t=2*Math.PI*(mh.azimuth-.5);ru.sunPosition.value.set(4e5*Math.sin(t)*Math.cos(e),4e5*Math.cos(t)*Math.cos(e),4e5*Math.sin(e)),ru.update(),cu.update(),cu.uFogDropoff.value=mh.fogDropoff,cu.uFogIntensity.value=mh.fogIntensity,ou.exposureBias.value=mh.exposureBias,ou.whitePoint.value=mh.whitePoint,ou.update()},mh.set=function(e,t){if(0===t)Object.assign(mh,e),mh.update(),setTimeout(function(){a.needsRender({env:!0})});else{var n=i.clone(mh),r=i.clone(e);gc.transition(function(e){Object.assign(mh,e),mh.update(),setTimeout(function(){a.needsRender({env:!0})})},n,r,{duration:t,doNotCancel:!0,lerp:gc.lerp.params,onComplete:function(){a.needsRender({env:!0})}})}},fh.listen(function(e){var t=e.environment;mh.set(t.parameters,t.animationDuration)}),hh.listen(function(e){var t=e.currentPlace;t.env&&mh.set(t.env,0)});var vh=function(){Qs.Object3D.call(this),this.sphere=new Qs.Mesh(new Qs.SphereBufferGeometry(50,32,15),Au.beacon),this.add(this.sphere),this.visible=!1,Nc.add(this),xc.listen(this.update.bind(this)),Tl.listen(this.tick.bind(this))};(vh.prototype=Object.create(Qs.Object3D.prototype)).update=function(){var e=xc.getState();if(e.longitude&&e.latitude&&!e.tooFar){this.visible=!0;var t=pl.project([e.longitude,e.latitude]);this.position.copy(t),this.sphere.material.uniforms.uAccuracy.value=e.accuracy||0}else this.visible=!1},vh.prototype.tick=function(e){this.sphere.material.uniforms.uTime.value=e.clock.elapsedTime},new vh;var gh,yh,xh,bh,wh,Sh,Th=function(e,t,n){Ur.call(this),e=e||1048576,t=t||["position"],this.type="BufferMergeGeometry",this.indices=[];for(var r,i=0;i<t.length;i++){var o=t[i];"normal"===o?(r=new Int8Array(3*e),this.setAttribute(o,new br(r,3,!0))):"tangent"===o?(r=new Int8Array(4*e),this.setAttribute(o,new br(r,4,!0))):"color"===o?(r=new Uint8Array(4*e),this.setAttribute(o,new br(r,4,!0))):(r=new Float32Array(3*e),this.setAttribute(o,new br(r,3)))}n&&(r=new Uint8Array(3*e),this.setAttribute("tag",new br(r,3,!0))),this.attributeOffset=0,this.indexOffset=0};(Th.prototype=Object.create(Ur.prototype))._mergeIndices=function(e){for(var t=this.indices,n=e.index.array,r=e.index.array.length,i=0,o=this.indexOffset;i<r;i++,o++)t[o]=this.attributeOffset+n[i];this.indexOffset+=r},Th.prototype.merge=function(e,t){var n,r,i,o,a,s;this._mergeIndices(e);var l=new hr(t);l=new Uint8Array([255*l.r,255*l.g,255*l.b]);for(var c=Object.keys(this.attributes),u=0;u<c.length;u++){var h=c[u],p=this.attributes[h];if(o=p.array,"tag"===h&&t)for(n=0,r=3*this.attributeOffset,i=3*s;n<i;n+=3,r+=3)o.set(l,r);else e.attributes[h]&&(a=e.attributes[h].array,s=e.attributes[h].count,o.set(a,p.itemSize*this.attributeOffset))}return this.attributeOffset+=s,this},Th.prototype.capacity=function(){return this.attributes.position.count-this.attributeOffset},Th.prototype.freeze=function(){var e=new(this.attributes.position.count>65535?Uint32Array:Uint16Array)(this.indices);this.setIndex(new br(e,1));for(var t,n,r,i=Object.keys(this.attributes),o=0;o<i.length;o++)t=i[o],r=(n=this.attributes[t]).itemSize*this.attributeOffset,n.set(n.array.subarray(0,r)),this.setAttribute(t,new br(n.array.subarray(0,r),n.itemSize,n.normalized));return this};var _h,Mh,Eh,Ah,Rh,Ch,Oh,Ph,Lh={position:0,tangent:0,generate:function(e,t,n,r,i,o){bh=i*(xh=i*i),wh=2*t-2*n+(gh=.5*(n-e))+(yh=.5*(r-t)),Sh=-3*t+3*n-2*gh-yh,Lh.position=wh*bh+Sh*xh+gh*i+t,o&&(Lh.tangent=3*wh*xh+2*Sh*i+gh)}},zh=new Qs.Vector3,Fh=new pc,Ih=new Qs.Vector3,Dh=new Qs.Vector3,kh={color:Fh,position:Ih,tangent:Dh},Uh=function(e,t){Qs.Curve.call(this),this.hDelta=3,this.points=void 0===e?[]:e,this.colors=t?t.map(function(e){return new pc(e)}):void 0};(Uh.prototype=Object.create(Qs.Curve.prototype)).getPoint=function(e){return _h=this.points,Mh=(_h.length-1)*e,Eh=Math.floor(Mh),Ah=Mh-Eh,Rh=_h[0===Eh?Eh:Eh-1],Ch=_h[Eh],Oh=_h[Eh>_h.length-2?_h.length-1:Eh+1],Ph=_h[Eh>_h.length-3?_h.length-1:Eh+2],zh=new Qs.Vector3,Lh.generate(Rh.x,Ch.x,Oh.x,Ph.x,Ah),zh.x=Lh.position,Lh.generate(Rh.y,Ch.y,Oh.y,Ph.y,Ah),zh.y=Lh.position,zh.z=this.hDelta,zh},Uh.prototype.getTangentAt=function(e){var t=e-1e-5,n=e+1e-5;t<0&&(t=0),n>1&&(n=1);var r=this.getPointAt(t);return this.getPointAt(n).clone().sub(r).normalize()},Uh.prototype.getPointAndTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getPointAndTangent(t)},Uh.prototype.getPointAndTangent=function(e){return _h=this.points,Mh=(_h.length-1)*e,Eh=Math.floor(Mh),Ah=Mh-Eh,Rh=_h[0===Eh?Eh:Eh-1],Ch=_h[Eh],Oh=_h[Eh>_h.length-2?_h.length-1:Eh+1],Ph=_h[Eh>_h.length-3?_h.length-1:Eh+2],Lh.generate(Rh.x,Ch.x,Oh.x,Ph.x,Ah,!0),Ih.x=Lh.position,Dh.x=Lh.tangent,Lh.generate(Rh.y,Ch.y,Oh.y,Ph.y,Ah,!0),Ih.y=Lh.position,Dh.y=Lh.tangent,Ih.z=this.hDelta,Dh.z=0,Dh.normalize(),this.colors&&(Ch=this.colors[Eh],Oh=this.colors[Eh>_h.length-2?_h.length-1:Eh+1],Fh.set(Ch).lerp(Oh,Ah)),kh};for(var Nh=new Array(2),Bh=0;Bh<2;Bh++)Nh[Bh]=1-2*Bh;var jh=function(e,t,n,r){this.type="LineGeometry";var i,o,a,s,l,c,u,h,p,d,f,m,v,g,y,x,b,w=(t=t||64)+1,S=-1!==(r=r||["position","normal","tangent"]).indexOf("color"),T=-1!==r.indexOf("normal"),_=-1!==r.indexOf("tangent");g=new Float32Array(3*w*2),this.attributes={position:new Qs.BufferAttribute(g,3)},S&&(y=new Uint8Array(4*w*2),this.attributes.color=new Qs.BufferAttribute(y,4,!1)),T&&(x=new Int8Array(3*w*2),this.attributes.normal=new Qs.BufferAttribute(x,3,!1)),_&&(b=new Int8Array(4*w*2),this.attributes.tangent=new Qs.BufferAttribute(b,4,!1));var M=0,E=0,A=new Array(w);for(l=0;l<w;l++)for(A[l]=[],a=l/t,o=(s=e.curve.getPointAndTangentAt(a)).tangent,i=s.color,u=2*l,c=0;c<2;c++){var R=4*M/3;A[l][c]=u+c,g[M]=s.position.x,g[M+1]=s.position.y,g[M+2]=s.position.z,n.writeTangent&&(g[M+2]=Math.atan2(o.y,o.x)),S&&(y[R]=255*i.r,y[R+1]=255*i.g,y[R+2]=255*i.b,y[R+3]=255*i.a),T&&(x[M]=127*Nh[c]*o.y,x[M+1]=-127*Nh[c]*o.x,x[M+2]=0),_&&(E=127-254*c,b[R]=E*o.x,b[R+1]=E*o.y,b[R+2]=E*o.z,b[R+3]=.5*E),M+=3}var C=2*t*6,O=g.length/3>65535?new Uint32Array(C):new Uint16Array(C);for(this.index=new Qs.BufferAttribute(O,1),M=0,l=0;l<t;l++)for(h=l+1,c=0;c<2;c++)p=(c+1)%2,d=A[l][c],f=A[h][c],m=A[h][p],v=A[l][p],O[M]=d,O[M+1]=f,O[M+2]=v,O[M+3]=f,O[M+4]=m,O[M+5]=v,M+=6};jh.prototype.constructor=jh,jh.prototype.dispose=function(){this.index=null,delete this.attributes};var Gh,Hh,Vh,Wh=performance||Date,qh={taskCount:0,workTimeout:30,completedTasks:[],createTask:function(e,t,n,r){if(0!==e.length){qh.taskCount++;var i,o,a,s,l,c=0,u=!1,h=function(p){if(o=Wh.now(),s=qh.workTimeout+p.time,!(o>s)){for(qh.completedTasks.length>0&&s-o>10&&(a=qh.completedTasks.pop(),bl.unlisten(a.step),qh.taskCount--,a.onComplete()),o=Wh.now(),l=r?s:qh.workTimeout/qh.taskCount+o;o<s&&o<l&&(i=e[c++]);)t(i),o=Wh.now();c>=e.length&&!u&&(u=!0,qh.completedTasks.unshift({step:h,onComplete:n}))}};bl.listen(h)}else b(n)}},Yh=function(){Qs.Object3D.call(this),this.features=[],Nc.add(this),this.maxIndex=65535,this.projectTime=0,this.curveTime=0,this.geomTime=0,this.mergeTime=0,this.matrixAutoUpdate=!1,this.updateMatrixWorld=function(){},this.parent=null,this.constantWidth=!1};(Yh.prototype=Object.create(Qs.Object3D.prototype)).onNewData=function(e){this.features=e.data,this.update()},Yh.prototype.remove=function(){this.children.forEach(function(e){e.geometry.dispose()}),this.children=[]},Yh.prototype.update=function(){var e=this;this.remove(),this.constantWidth?this.bufferGeomAttributes=["position","tangent"]:this.bufferGeomAttributes=["position"],this.bufferGeoms={},this.materials={},this.curveTime=0,this.projectTime=0,this.geomTime=0,this.mergeTime=0,S("Starting processing",e.name),qh.createTask(e.features,e.addMesh.bind(e),function(){var t=fl.now();i.each(e.bufferGeoms,function(t,n){(Hh=new Qs.Mesh(t.freeze(),e.materials[n])).frustumCulled=!1,e.add(Hh)}),e.constructTime=fl.now()-t,S("Parsed",e.name),fl.timing(e.name,"project",null,e.projectTime),fl.timing(e.name,"curve",null,e.curveTime),fl.timing(e.name,"geom",null,e.geomTime),fl.timing(e.name,"merge",null,e.mergeTime),fl.timing(e.name,"construct",null,e.constructTime),S("instances:",e.children.length),a.renderedFeatureDisplayed(e.name)})},Yh.prototype.createGeometry=function(e){var t,n=fl.now(),r=pl.vectorizeFeature(e),i=fl.now()-n;this.projectTime+=i,n=fl.now(),e.geometry.colors&&(e.geometry.coordinates.length!==e.geometry.colors.length?console.error("colors array for feature must have same length as positions array"):(t=e.geometry.colors,e.perVertexColors=!0));var o=new Uh(r,t);e.curve=o,i=fl.now()-n,this.curveTime+=i,n=fl.now(),e.thickness=T.thickness(e),o.hDelta=3+.5*e.thickness,e.curve.arcLengthDivisions=10;var a=e.curve.getLength(),s=Math.round(a/25);s=(s=Math.max(s,2*e.geometry.coordinates.length))<10?10:s,e.curve.arcLengthDivisions=s,e.curve.needsUpdate=!0;var l={writeTangent:this.writeTangent};this.constantWidth||(l.thickness=e.thickness),e.geom=new jh(e,s,l,e.perVertexColors?this.bufferGeomAttributes.concat("color"):this.bufferGeomAttributes),i=fl.now()-n,this.geomTime+=i,delete e.geometry.colors,e.geometry.coordinates=[e.geometry.coordinates[0]]},Yh.prototype.addMesh=function(e){void 0===e.geom&&this.createGeometry(e),Vh=e.perVertexColors?null:T.color(e),Gh=this.material(Vh,e.thickness,e.properties?e.properties.outlineColor:void 0),this.materials[Gh.uuid]||(this.materials[Gh.uuid]=Gh);var t=fl.now(),n=e.geom.attributes.position.count,r=e.perVertexColors?this.bufferGeomAttributes.concat("color"):this.bufferGeomAttributes;if(n>this.maxIndex){var i=new Th(n,r,!!e.tag);i.merge(e.geom,e.tag),Hh=new Qs.Mesh(i.freeze(),Gh),this.add(Hh),i.dispose()}else{this.bufferGeoms[Gh.uuid]||(this.bufferGeoms[Gh.uuid]=new Th(this.maxIndex,r,!!e.tag));var o=this.bufferGeoms[Gh.uuid];n>o.capacity()&&((Hh=new Qs.Mesh(o.freeze(),Gh)).frustumCulled=!1,this.add(Hh),this.bufferGeoms[Gh.uuid]=new Th(this.maxIndex,r,!!e.tag),o=this.bufferGeoms[Gh.uuid]),o.merge(e.geom,e.tag)}var s=fl.now()-t;this.mergeTime+=s,a.featureCreated(e)};var Xh=function(){Yh.call(this),Vu.listen(this.onNewData.bind(this)),Gu.pickerScene.add(this),this.material=Au.line,this.name="lines",a.renderedFeatureRegister(this.name),this.constantWidth=!0};Xh.prototype=Object.create(Yh.prototype),new Xh;var Zh={"top-left":{x:1,y:-1},top:{x:0,y:-1},"top-right":{x:-1,y:-1},left:{x:1,y:0},center:{x:0,y:0},right:{x:-1,y:0},"bottom-left":{x:1,y:1},bottom:{x:0,y:1},"bottom-right":{x:-1,y:1}};function Jh(e){return void 0===e||isNaN(e.x)||isNaN(e.y)?Zh[e]||Zh.bottom:e}var Kh,Qh=document.createElement("i"),$h=document.createElement("div");$h.style.position="absolute",$h.style.left="-999px",$h.style.top="-999px",$h.appendChild(Qh),$h.style.display="none",document.body.appendChild($h);var ep=i.memoize(function(e){return $h.style.display="block",Qh.className="fa fa-"+e,Kh=(Kh=window.getComputedStyle(Qh,":before").getPropertyValue("content")).replace(/['"]/g,""),$h.style.display="none",Kh}),tp='-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif';Math.log2=Math.log2||function(e){return Math.log(e)*Math.LOG2E};var np=function(e,t,n){this.pixelRatio=window.devicePixelRatio,Pl.depthTexture||(this.pixelRatio=1),this.pixelRatio=Math.min(this.pixelRatio,4),this.size=(e||512)*this.pixelRatio,this.size=Math.pow(2,Math.ceil(Math.log2(this.size))),this.width=this.size,this.height=2*this.size,this.spriteSize=40,this.monochromeBegin=.25*this.height,this.queue=[],this.padding=n||0,this.mapping=new Map,this.scratchCanvas=document.createElement("canvas"),this.scratchCanvas.width=this.width,this.scratchCanvas.height=this.height,this.scratch=this.scratchCanvas.getContext("2d"),this.scratch.textBaseline="middle",this.scratch.fillStyle="rgba(255, 255, 255, 1.0)",this.texture=new Qs.Texture(this.scratchCanvas),this.texture.wrapS=Qs.RepeatWrapping,this.texture.wrapT=Qs.RepeatWrapping,this.texture.minFilter=Qs.NearestFilter,this.texture.magFilter=Qs.NearestFilter,this.texture.generateMipmaps=!1,this.texture.flipY=!1,this.clear();var r=this;window.showAtlas=function(){r.scratchCanvas.style.position="absolute",r.scratchCanvas.style.width="512px",r.scratchCanvas.style.height="512px",r.scratchCanvas.style["pointer-events"]="none",r.scratchCanvas.style.opacity="0.9",document.children[0].children[1].appendChild(r.scratchCanvas)},this.defaultFontSize=11,this.checkFontAvailable()},rp=30;np.prototype.checkFontAvailable=function(){this.testCanvas||(this.testCanvas=document.createElement("canvas"),this.testCanvas.width=16,this.testCanvas.height=16);var e=this.testCanvas.getContext("2d");e.font="32px FontAwesome",e.fillStyle="rgba(255, 255, 255, 1)";var t=ep("minus");if(e.fillText(t,0,16),e.getImageData(15,0,1,1).data[0]>250)a.fontsLoaded();else{var n=this;setTimeout(function(){n.checkFontAvailable(),0===--rp&&(console.error("FontAwesome has not loaded"),console.error("Please make sure you are including the relevant CSS in the <head> element, e.g."),console.error('<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">'))},333)}},np.prototype.checkContainerFont=function(){var e=document.getElementById("container"),t=e?document.defaultView.getComputedStyle(e)["font-family"]:null;t=t||"",this.font="FontAwesome, "+t+", "+tp,this.setFontSize(this.defaultFontSize)},np.prototype.setFontSize=function(e){if(void 0===e&&(e=this.defaultFontSize),e!==this.fontSize)if(isNaN(e))console.error("Invalid font size");else{this.fontSize=e;var t=this.pixelRatio*Math.round(e)+"px ";t+=this.font,this.scratch.font=t,this.textHeight=this.getTextHeight()}},np.prototype.getTextHeight=function(){return 1.3*this.scratch.measureText("M").width},np.prototype.addImage=function(e,t,n){var r=e;void 0!==t&&(r+="#_#"+t),void 0!==n&&(r+="#_#"+n);var i=this.mapping.get(r);if(void 0!==i)return i;if(i=this.createTransform({width:this.pixelRatio*(void 0!==t?t:this.spriteSize),height:this.pixelRatio*(void 0!==n?n:this.spriteSize)}),this.mapping.set(r,i),i.z*i.w==0)return i;var o=new Qs.ImageLoader;o.setCrossOrigin("Anonymous");var s=this;return o.load(e,function(e){var t=i.clone();t.x*=s.width,t.y*=s.height,t.z*=s.width,t.w*=s.height,s.scratch.clearRect(t.x,t.y,t.z,t.w),s.scratch.globalCompositeOperation="lighter",s.scratch.drawImage(e,t.x,t.y,t.z,t.w),s.texture.needsUpdate=!0,a.needsRender()}),i},np.prototype.fillTextToChannel=function(e,t){var n=Math.floor(t.y/this.height);1===n?this.scratch.fillStyle="rgba(255, 255, 0, 1)":2===n?this.scratch.fillStyle="rgba(0, 255, 255, 1)":3===n&&(this.greenCleared||this.clearGreen(),this.scratch.fillStyle="rgba(0, 255, 0, 1)"),this.scratch.globalCompositeOperation="lighter";var r=t.y%this.height+.5*t.w;this.scratch.fillText(e,t.x,r)},np.prototype.clearGreen=function(){this.scratch.globalCompositeOperation="multiply",this.scratch.fillStyle="rgba(255, 0, 255, 1)",this.scratch.fillRect(0,this.monochromeBegin,this.width,this.height),this.greenCleared=!0},np.prototype.addText=function(e,t,n){this.font||this.checkContainerFont(),this.setFontSize(t);var r=e;void 0!==t&&(r+="#_#"+t);var i=this.mapping.get(r);if(void 0!==i)return i;var o=this.scratch.measureText(e.slice(0,1)).width,a=.5*(this.textHeight-o),s=this.scratch.measureText(e).width,l=Math.ceil(s+2*a);if(l<this.textHeight&&(l=this.textHeight,a=Math.floor(.5*(l-s))),i=this.createTransform({width:l,height:this.textHeight},!0),this.mapping.set(r,i),i.z*i.w==0)return i;var c=i.clone();return c.x*=this.width,c.y*=this.height,c.z*=this.width,c.w*=this.height,c.x+=a,n&&i.y<3?this.fillTextToChannel(e,c):this.queue.push({fontSize:t,text:e,transform:c}),i},np.prototype.processQueue=function(){var e=this;qh.createTask(this.queue,function(t){e.setFontSize(t.fontSize),e.fillTextToChannel(t.text,t.transform)},function(){a.needsRender(),e.queue=[],e.texture.needsUpdate=!0,S("Atlas text drawn")},!0)},np.prototype.clear=function(){this.mapping.clear(),S("ATLAS CLEAR"),this.scratch.globalCompositeOperation="copy",this.scratch.fillStyle="rgba(0, 0, 0, 1)",this.scratch.fillRect(0,this.monochromeBegin,this.width,this.height-this.monochromeBegin),this.usedX=0,this.usedY=0,this.greenCleared=!1,this.rowHeight=0,this.usedMonochromeX=0,this.usedMonochromeY=this.height+this.monochromeBegin,this.rowMonochromeHeight=0},np.prototype.createTransform=function(e,t){var n=new Qs.Vector4,r=Math.ceil(e.width),i=Math.ceil(e.height),o=r+2*this.padding,a=i+2*this.padding,s=0;if(o>this.width||a>this.height)return console.error("Cannot fit object in atlas"),n;if(t){if(this.usedMonochromeX+o>this.width&&(this.usedMonochromeX=0,this.usedMonochromeY+=this.rowMonochromeHeight,this.rowMonochromeHeight=0),this.rowMonochromeHeight=Math.max(this.rowMonochromeHeight,a),Math.floor(this.usedMonochromeY/this.height)!==(s=Math.floor((this.usedMonochromeY+this.rowMonochromeHeight)/this.height))&&(this.usedMonochromeX=0,this.usedMonochromeY=s*this.height+this.monochromeBegin,this.rowMonochromeHeight=a),this.usedMonochromeY+this.rowMonochromeHeight>4*this.height)return console.error("Atlas capacity exceeded!"),n.z=0,n.w=0,n}else if(this.usedX+o>this.width&&(this.usedX=0,this.usedY+=this.rowHeight,this.rowHeight=0),this.rowHeight=Math.max(this.rowHeight,a),this.usedY+this.rowHeight>=this.monochromeBegin)return console.error("Atlas capacity exceeded!"),n.z=0,n.w=0,n;return t?(n.x=Math.round(this.usedMonochromeX+this.padding),n.y=Math.round(this.usedMonochromeY+this.padding),this.usedMonochromeX+=o):(n.x=Math.round(this.usedX+this.padding),n.y=Math.round(this.usedY+this.padding),this.usedX+=o),n.z=r,n.w=i,n.x/=this.width,n.y/=this.height,n.z/=this.width,n.w/=this.height,n};var ip={none:{x:0,y:0},object:{x:1,y:0},pixel:{x:0,y:1}};function op(e){return void 0===e||isNaN(e.x)||isNaN(e.y)?ip[e]||ip.pixel:e}function ap(){this.data=[],this.haveFonts=!1,this.isUpdate=!1,this.bindListeners({clearFeatures:s.setCurrentPlace,fontsLoaded:a.fontsLoaded,addOverlay:[h.addBuiltinOverlay,h.addOverlay,h.setFeatures,h.removeOverlay],updateOverlay:h.updateOverlay})}ap.prototype.clearFeatures=function(){return this.data=[],!0},ap.prototype.isReady=function(){return this.haveFonts},ap.prototype.fontsLoaded=function(){return this.haveFonts=!0,this.isReady()},ap.prototype.addOverlay=function(){this.waitFor(yl);var e=yl.getState().markers;return!i.isEqual(this.data,e)&&(this.data=e.concat(),Gu.registerStore(this),this.isUpdate=!1,this.isReady())},ap.prototype.updateOverlay=function(){this.waitFor(yl);var e=yl.getState().markers;return this.data=e.concat(),this.isUpdate=!0,this.isReady()},ap.displayName="MarkerData";var sp=o.createStore(ap),lp=function(){this.defaultValue=Array.prototype.slice.call(arguments),0===this.defaultValue.length&&console.error("Need to provide default value(s)"),this.array=[],this.firstValue=null,this.onlyDuplicates=!0};lp.prototype.push=function(){var e=Array.prototype.slice.call(arguments);this.defaultValue.length!==e.length&&console.error("Pushed item with incorrect length to PushList"),null===this.firstValue?this.firstValue=e:this.onlyDuplicates&&!i.isEqual(this.firstValue,e)&&(this.onlyDuplicates=!1),this.array.push.apply(this.array,e)},lp.prototype.pushDefault=function(){this.push.apply(this,this.defaultValue)};var cp=function(){this.positions=new Qs.BufferAttribute(new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),2);var e=new Qs.InstancedBufferGeometry;e.setAttribute("position",this.positions),Qs.Mesh.call(this,e,Au.marker),this.name="markers",a.renderedFeatureRegister(this.name),this.renderOrder=1e3,this.atlas=new np,this.material.uniforms.uMap.value=this.atlas.texture,sp.listen(this.onNewData.bind(this)),Nc.hd.add(this),this.parent=null,Gu.pickerScene.add(this),this.parent=null,this.visible=!1;var t=this;this.empty=!0,Oc.listen(this.checkVisibility.bind(this)),hh.listen(function(){t.atlas.clear()})};(cp.prototype=Object.create(Qs.Mesh.prototype)).checkVisibility=function(){this.visible=!this.empty&&kl.near>20},cp.prototype.onNewData=function(e){if(e.isUpdate)return void this.onUpdatedData(e);var t=fl.now(),n=this,r=e.data;if(this.empty=0===r.length,this.checkVisibility(),this.empty)return this.atlas.clear(),void b(function(){a.renderedFeatureDisplayed(n.name)});b(function(){a.renderedFeatureRegister(n.name)}),this.geometry=new Qs.InstancedBufferGeometry,this.geometry.setAttribute("position",this.positions);var o=Jh(),s=op("pixel"),l={anchor:new lp(o.x,o.y,0,0),atlas:new lp(0,0,0,0),background:new lp(255,255,255,0),clipping:new lp(s.x,s.y),color:new lp(255,255,255,255),layout:new lp(0,0,0),normal:new lp(0,0,1,1e5),offset:new lp(0,0,0,1e5),tag:new lp(0,0,0,.2)};l.background.normalized=!0,l.color.normalized=!0,l.normal.dynamic=!0,l.offset.dynamic=!0,l.normal.onlyDuplicates=!1,l.offset.onlyDuplicates=!1;var c,u,h,p,d,f,m,v,g,y,x,w,T,_,M={x:0,y:0,z:0},E=kl.position.x,A=kl.position.y;r.forEach(function(e){T=e.properties,f=e.tag?new pc(e.tag):new pc(0),y=void 0!==T.highlightOpacity?T.highlightOpacity:.2,l.tag.push(f.r,f.g,f.b,y),T.color?(f=new pc(T.color),l.color.push(255*f.r,255*f.g,255*f.b,255*f.a)):l.color.pushDefault(),T.background?(p=new pc(T.background),l.background.push(255*p.r,255*p.g,255*p.b,255*p.a)):T.color?l.background.push(255*f.r,255*f.g,255*f.b,0):l.background.push(255,255,255,0),m=T.collapseDistance||1e5,g=T.fadeDistance||1e5,w=pl.vectorizeFeature(e),l.offset.push(w.x,w.y,w.z,g),T.image?(h=n.atlas.addImage(T.image,T.width,T.height),l.atlas.push(h.x,h.y,h.z,h.w)):void 0!==T.name||void 0!==T.icon?(d=op("object"),_="",void 0!==T.icon&&(_+=ep(T.icon),void 0!==T.name&&(_+="  ")),void 0!==T.name&&(_+=T.name),v=Math.abs(E-w.x)<4e3&&Math.abs(A-w.y)<4e3,h=n.atlas.addText(_,T.fontSize,v),l.atlas.push(h.x,h.y,h.z,h.w)):(d=op("object"),l.atlas.pushDefault()),d=T.clipping?op(T.clipping||"pixel"):d||s,l.clipping.push(d.x,d.y),c=Jh(T.anchor),u=T.anchorOffset||{x:0,y:0},l.anchor.push(c.x,c.y,parseFloat(u.x)||0,parseFloat(u.y)||0),M.x=T.padding||0,M.y=T.borderWidth||0,M.z=T.borderRadius||0,l.layout.push(M.x,M.y,M.z),x=wc(),l.normal.push(x.x,x.y,x.z,m)}),this.atlas.processQueue(),i.forOwn(l,function(e,t){if(e.onlyDuplicates){var r=e.firstValue||e.defaultValue;e.normalized&&(r=r.map(function(e){return e/255})),n.material.defaultAttributeValues[t]=r}else{var i=e.normalized?Uint8Array:Float32Array,o=new Qs.InstancedBufferAttribute(new i(e.array),e.defaultValue.length,e.normalized,1);e.dynamic&&o.setUsage(Qs.DynamicDrawUsage),n.geometry.setAttribute(t,o)}});var R=this.geometry.attributes.position;this.geometry.attributes.position=this.geometry.attributes.offset,this.geometry.computeBoundingSphere(),this.geometry.attributes.position=R,this.geometry.boundingSphere.center.z=2e3;const C=this.geometry.boundingSphere.radius;this.geometry.boundingSphere.radius=Math.max(C,2e3),this.visible=l.offset.array.length>0;var O=fl.now()-t;S("Parsed",this.name),S("Blit count",this.atlas.blitCount),fl.timing(this.name,"construct",null,O),b(function(){a.renderedFeatureDisplayed(n.name),r.forEach(function(e){a.featureCreated(e)})})},cp.prototype.onUpdatedData=function(e){var t=this.geometry.attributes.offset,n=this.geometry.attributes.normal;if(void 0!==t){var r,i,o=0;e.data.forEach(function(e){r=pl.vectorizeFeature(e),t.array[o]=r.x,t.array[o+1]=r.y,t.array[o+2]=r.z,i=wc(),n.array[o]=i.x,n.array[o+1]=i.y,n.array[o+2]=i.z,o+=4}),t.needsUpdate=!0,n.needsUpdate=!0}},new cp;const up=new Qs.SphereBufferGeometry(2e5,32,6,0,2*Math.PI,0,.6*Math.PI),hp=new Qs.Matrix4;hp.makeRotationX(Math.PI/2),up.applyMatrix4(hp);const pp=new Qs.Mesh(up,Au.sky);pp.geometry.computeBoundingBox(),pp.renderOrder=1e4,Nc.add(pp);var dp={uSkybox:{type:"t",value:null}},fp=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nprecision highp float;\n\n#define SUN_DISK\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// Derived uniforms\nuniform vec3 sunDirection;\nuniform vec3 betaRM;\nuniform vec3 betaRnorm;\nuniform vec3 betaMnorm;\nuniform vec4 constants; // sunE, hgPhaseA, hgPhaseB & LinWeight\nuniform float gamma;\nuniform float tonemapScale;\n\n// Safe functions\nfloat spow( const float x, const float y ) {\n  return pow( abs( x ), y );\n}\n\nvec3 spow( const vec3 x, const vec3 y ) {\n  return pow( abs( x ), y );\n}\n\nvec3 ssqrt( const vec3 x ) {\n  return sqrt( abs( x ) );\n}\n\n/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nconst float A = 0.15;\nconst float B = 0.50;\nconst float C = 0.10;\nconst float D = 0.20;\nconst float E = 0.02;\nconst float F = 0.30;\n\nuniform float uTonemapExposureBias;\nuniform float uTonemapWhiteScale;\n\nvec3 RawTonemap( vec3 x )\n{\n  return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\n\nvec3 Tonemap( vec3 color ) {\n  return uTonemapExposureBias * RawTonemap( uTonemapWhiteScale * color );\n}\n\n\nvec3 skyColor( vec3 direction ) {\n  float cosZenithAngle = max( 0.0, direction.y );\n  // Approximate acos( x ) by pi/2 - x\n  // This allows us to simplify and error is only large when looking up\n  float denom = cosZenithAngle + spow( 17.6579343808112 + cosZenithAngle * 260.41830500372932, -1.253 );\n\n  // combined extinction factor\t\n  vec3 Fex = exp( -betaRM / denom );\n\n  // in scattering\n  float cosTheta = dot( direction, sunDirection );\n  float rPhase = cosTheta + 1.0;\n  vec3 betaRTheta = betaRnorm * ( 4.0 + rPhase * rPhase );\n  vec3 betaMTheta = betaMnorm * spow( constants.y * cosTheta + constants.z, -1.5 );\n\n  vec3 tmp = betaRTheta + betaMTheta;\n  vec3 Lin = spow( tmp * ( 1.0 - Fex ), vec3( 1.5 ) );\n  Lin *= mix( vec3( 1.0 ), ssqrt( tmp * Fex ), constants.w );\n\n  // nightsky\n  vec3 L0 = 0.1 * Fex;\n\n  #ifdef SUN_DISK\n  L0 += constants.x * Fex * smoothstep( 0.9999566769, 0.9999766769, cosTheta );\n  #endif\n\n  // Combine all components\n  vec3 color = 0.04 * ( Lin + L0 ) + vec3( 0.0, 0.0003, 0.00075 );   \n  color = Tonemap( tonemapScale * color );\n  return spow( color, vec3( gamma ) );\n}\n\n\n// 1 / 2048.0 (texture width)\n#define STEP 0.00048828125\n\nvoid main() {\n  // Map to sphere normal direction\n  vec2 uv = gl_FragCoord.xy * STEP;\n  vec3 direction = 2.0 * vec3( uv - 0.5, 0.0 ); // Switch to polar coordaintes\n  float r = min( 0.99999, length( direction ) ); // Limit to unit length\n  r = sin( 1.5707963267949 * r ); // store linear in polar angle\n  direction = r * normalize( direction );\n  direction.z = sqrt( max( 0.0, 1.0 - dot( direction, direction ) ) ); // Get z-coordinate from Pythagorus\n  vec3 color = skyColor( normalize( direction.xzy ) );\n  gl_FragColor = vec4( color, 1.0 );\n}\n"),mp=new cc("/**\n * Copyright 2020 (c) Felix Palmer\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n// RawShader\nattribute vec3 position;\n\nvoid main() {\n  // Do not need any matrix multiplications as positions already in clip\n  // space\n  gl_Position = vec4( position, 1.0 );\n}\n"),vp={camera:null,enabled:!0,renderTarget:null,scene:new Qs.Scene,init:function(){var e={format:Qs.RGBFormat,type:Pl.render565?Qs.UnsignedShort565Type:Qs.UnsignedByteType,depthBuffer:!1,stencilBuffer:!1,wrapS:Qs.ClampToEdgeWrapping,wrapT:Qs.ClampToEdgeWrapping};vp.width=256,vp.camera=new Qs.OrthographicCamera(-1,1,1,-1,0,1e4),vp.scene.add(vp.camera),vp.camera.position.z=10,vp.camera.lookAt(new Qs.Vector3(0,0,0)),vp.renderTarget=new Qs.WebGLRenderTarget(vp.width,vp.width,e),dp.uSkybox.value=vp.renderTarget.texture;var t=new Qs.PlaneBufferGeometry(2,2);fp.define("STEP",(1/vp.width).toExponential());var n=new Qs.RawShaderMaterial({name:"skybox",uniforms:i.assign({},ru,ou),vertexShader:mp.value,fragmentShader:fp.value}),r=new Qs.Mesh(t,n);vp.scene.add(r),Tl.listen(function(e){e.env&&vp.process()})},process:function(){Zl.setRenderTarget(vp.renderTarget),Zl.render(vp.scene,vp.camera)}};vp.init();class gp{constructor(e,t){let n=[0,0];e=e||[1,1],t=t||1;let r,i,o=n[0],a=n[1],s=e[0],l=e[1],c=t+1,u=new Array(c*c);for(r=0;r<c;r++)for(i=0;i<c;i++){u[r*c+i]={x:o+r*(s/t),y:a-i*(l/t),uvx:r/t,uvy:i/t}}let h=6*t*t;h+=24*t,this.positions=new Float32Array(4*h),this.index=new Array(h);let p=0,d=(e,t,n,r,i)=>{let o=u[t],a=u[n],s=u[r],l=u[i];let c=e=>[e.x,e.y,e.uvx,e.uvy];this.positions.set(c(o),4*(e+0)),this.positions.set(c(a),4*(e+1)),this.positions.set(c(s),4*(e+2)),this.positions.set(c(s),4*(e+3)),this.positions.set(c(a),4*(e+4)),this.positions.set(c(l),4*(e+5)),this.index[e+0]=t,this.index[e+1]=n,this.index[e+2]=r,this.index[e+3]=r,this.index[e+4]=n,this.index[e+5]=i};for(r=0;r<t;r++)for(i=0;i<t;i++,p++){d(6*p,r*c+i,r*c+i+1,(r+1)*c+i,(r+1)*c+i+1)}for(let e=0;e<4;e++)for(let n=0;n<t;n++,p++){let o,a;0===e?(r=0,i=n):1===e?(r=t,i=n):2===e?(r=n,i=0):3===e&&(r=n,i=t),e<2?(o=u[r*c+i],a=u[r*c+i+1]):(o=u[r*c+i],a=u[(r+1)*c+i]),0!==e&&3!==e||([o,a]=[a,o]);let s=o,l=a;this.positions[24*p]=o.x,this.positions[24*p+1]=o.y,this.positions[4*(6*p+1)]=a.x,this.positions[4*(6*p+1)+1]=a.y,this.positions[4*(6*p+2)]=s.x,this.positions[4*(6*p+2)+1]=s.y,this.positions[4*(6*p+3)]=s.x,this.positions[4*(6*p+3)+1]=s.y,this.positions[4*(6*p+4)]=a.x,this.positions[4*(6*p+4)+1]=a.y,this.positions[4*(6*p+5)]=l.x,this.positions[4*(6*p+5)+1]=l.y,this.positions[24*p+2]=o.uvx,this.positions[24*p+3]=o.uvy,this.positions[4*(6*p+1)+2]=a.uvx,this.positions[4*(6*p+1)+3]=a.uvy,this.positions[4*(6*p+2)+2]=s.uvx+10,this.positions[4*(6*p+2)+3]=s.uvy+10,this.positions[4*(6*p+3)+2]=s.uvx+10,this.positions[4*(6*p+3)+3]=s.uvy+10,this.positions[4*(6*p+4)+2]=a.uvx,this.positions[4*(6*p+4)+3]=a.uvy,this.positions[4*(6*p+5)+2]=l.uvx+10,this.positions[4*(6*p+5)+3]=l.uvy+10}for(h=u.length,this.grid=new Float32Array(4*h),r=0;r<h;r++){let e=u[r];this.grid[4*r+0]=e.x,this.grid[4*r+1]=e.y,this.grid[4*r+2]=e.uvx,this.grid[4*r+3]=e.uvy}}}const yp=2;let xp=[],bp=1;class wp{constructor(){this.id=bp++;const e=this.refreshIndices.bind(this);uu.addListener(e),ic.addListener(e);let t=wp.geometry[64];this.offset=new Qs.Vector4(0,0,1,1),this.imageryUvOffset=new Qs.Vector4;let n=Au.terrain({uOffset:{value:this.offset},uImageryUvOffset:{value:this.imageryUvOffset}});this.mesh=new Qs.Mesh(t,n.imagery),this.pickerMesh=new Qs.Mesh(t,n.picker),this.init(...arguments)}init(e,t,n){if(isNaN(e)||isNaN(t)||isNaN(n))throw Error("Invalid tile initialization");this.wasSeen=!1,this.wasRendered=!1,Nc.add(this.mesh),Nc.tilepickerScene.add(this.pickerMesh),this.x=e,this.y=t,this.z=n;let r=Math.max(yp,this.z-10);this.x2=Math.floor(this.x/Math.pow(2,r)),this.y2=Math.floor(this.y/Math.pow(2,r)),this.z2=this.z-r;let i=1024/Math.pow(2,r);i=Math.min(64,Math.max(1,i));let o=wp.geometry[i].clone(),a=wp.geometry[Math.max(1,i/8)].clone();this.mesh.geometry=o,this.pickerMesh.geometry=a,this.calculateOffset(),this.imageryKey=hl.tileToQuadkey([this.x,this.y,this.z]),this.elevationKey=hl.tileToQuadkey([this.x2,this.y2,this.z2]),this.imageryIndex=0,this.elevationIndex=0;let s=new Qs.Vector3(this.offset.x+.5*this.offset.z,this.offset.y-.5*this.offset.z,.5*this.offset.w*3800),l=Math.max(.5*this.offset.w*4200,.5*this.offset.z);l*=Math.sqrt(3);let c=new Qs.Sphere(s,l);return this.mesh.geometry.boundingSphere=c,this.pickerMesh.geometry.boundingSphere=c,this}calculateOffset(){const{sceneScale:e,globalOffset:t}=Bl.getState();let n=Math.pow(2,15-this.z)*e;this.offset.set(this.x*n+t.x,-this.y*n+t.y,n,this.id)}split(){let e=hl.getChildren([this.x,this.y,this.z]);return e=[this.init(...e[0]),wp.next(...e[1]),wp.next(...e[2]),wp.next(...e[3])]}grow(){return this.init(...hl.getParent([this.x,this.y,this.z])),this}shift(e,t,n){n>this.z&&console.error("Cannot shift at zoom level bigger than this.z");const r=Math.round(this.x+e*Math.pow(2,this.z-n)),i=Math.round(this.y+t*Math.pow(2,this.z-n));return this.init(r,i,this.z),this}recycle(){xp.push(this),Nc.remove(this.mesh),Nc.tilepickerScene.remove(this.pickerMesh)}fetchData(){this.wasSeen||this.z<8?(ic.fetchIfNeeded(this.elevationKey),uu.fetchIfNeeded(this.imageryKey)):this.wasRendered&&this.z>10?uu.fetchIfNeeded(this.imageryKey.slice(0,-2)):(uu.fetchIfNeeded(this.imageryKey.slice(0,5)),ic.fetchIfNeeded(this.elevationKey.slice(0,5))),this.refreshIndices()}calculateImageryOffset(e){let t=e.quadkey?this.imageryKey.length-e.quadkey.length:0,n=Math.pow(2,-t),[r,i]=e.quadkey?hl.quadkeyToTile(e.quadkey):[this.x,this.y,this.z];this.imageryUvOffset.set(this.x*n-r,this.y*n-i,n,this.imageryIndex)}refreshIndices(){let e=hl.quadkeyToTile(this.imageryKey),t=hl.tileToQuadkey(e);this.elevationIndex=ic.findBestAvailableData(t,!0).index,this.bestImagery=uu.findBestAvailableData(this.imageryKey),this.imageryIndex=this.bestImagery.index,this.calculateImageryOffset(this.bestImagery)}onSeen(){ic.indexPool.tap(this.elevationIndex),uu.indexPool.tap(this.imageryIndex)}}wp.next=function(){return xp.length>0?xp.splice(0,1)[0].init(...arguments):new wp(...arguments)};let Sp=64;for(wp.geometry=[];Sp>=1;){let e=new gp([1,1],Sp),t=new Qs.BufferGeometry;t.setAttribute("position",new Qs.Float32BufferAttribute(e.positions,4)),wp.geometry[Sp]=t,Sp/=2}const Tp=Zl.domElement,_p={data:new Uint8Array(4*Tp.width*Tp.height),target:new Qs.WebGLRenderTarget(Tp.width,Tp.height)};let Mp,Ep,Ap;Dl.listen(function({width:e,height:t,renderRatio:n}){let r=Math.sqrt(e*t/500),i=2*Math.round(.5*e/r),o=2*Math.round(.5*t/r);_p.target&&i===_p.target.width&&o===_p.target.height||(_p.target=new Qs.WebGLRenderTarget(i,o),_p.data=new Uint8Array(4*_p.target.width*_p.target.height),Eu.uScaling.value.set(.5*i,.5*o,256/(n*r)))});const Rp=5,Cp=new Qs.Vector2;let Op=1/0;hh.listen(({currentPlace:e})=>{[Mp,Ep,Ap]=hl.pointToTileFraction(f.snap(e.location[0]),f.snap(e.location[1]),Rp);const t=Bl.getState().sceneScale;Op=.6*t*Math.pow(2,15-Rp),Mp=Math.floor(Mp),Ep=Math.floor(Ep),function(){Lp.forEach(e=>e.recycle()),(Lp=[]).push(wp.next(Mp,Ep,Ap));let e=Lp[0].split();Lp.push(...e.splice(1,3)),Lp.forEach(e=>e.fetchData())}()});let Pp,Lp=[],zp={},Fp=0,Ip=null,Dp=!1;Tl.listen(function(){if(0===Lp.length)return;Fp++;let e=new Set,t=new Set,n=new Set,r={},i=1;const o=5+1*i+1;let a=Fp%o,s=0===a,l=(a-1-4)%1==0&&a>4&&a<5+1*i,c=a===o-1;if(Dp||(s=!0,l=!0,c=!0,i=1),s&&(Zl.setRenderTarget(_p.target),Zl.clear(!0,!0,!0),Zl.render(Nc.tilepickerScene,kl),Pp=kl.projectionMatrix.elements),l){let e=Dp?(a-1-4)/1:0,t=4*_p.target.width*_p.target.height/i,n=new Uint8Array(_p.data.buffer,e*t,t);Zl.readRenderTargetPixels(_p.target,0,e*_p.target.height/i,_p.target.width,_p.target.height/i,n),Zl.setRenderTarget(null)}if(c){let i,o,a=2*(_p.target.width+_p.target.width*_p.target.height);a=Math.round(a);let s=256*_p.data[a+2]+_p.data[a+3];s/=65280,Ip=Pp[14]/(2*s-1+Pp[10]),Oc.getState().controls.setDistanceToTarget(Ip);let l=_p.data.length;for(a=0;a<l;a+=4){if(i=256*_p.data[a]+_p.data[a+1],o=10*(o=_p.data[a+3]/255)-5,0===i)continue;let r=Lp.find(e=>e.id===i);void 0!==r&&(o<(window.minError||-1.5)&&r.z<18?(t.add(r),e.add(r)):o>(window.maxError||0)&&r.z>7?n.add(r):e.add(r))}Lp.forEach(t=>{void 0===zp[t.imageryKey]&&(zp[t.imageryKey]=0),e.has(t)?zp[t.imageryKey]=0:zp[t.imageryKey]++>5&&n.add(t)});let c=new Set([...n].filter(e=>t.has(e)));n=new Set([...n].filter(t=>!c.has(t)&&!e.has(t))),t=new Set([...t].filter(e=>!c.has(e))),[...e].filter(e=>!t.has(e)).forEach(e=>e.wasSeen=!0),[...Lp].filter(e=>!t.has(e)).forEach(e=>e.wasRendered=!0),n.forEach(e=>{let t=e.imageryKey.slice(0,-1);void 0===r[t]?r[t]=new Set([e]):r[t].add(e)}),t.forEach(e=>{if(window.noSplit)return;let t=e.split();t.forEach(e=>e.fetchData()),Lp.push(...t.splice(1,3))}),0===t.size&&(Dp=!0),Object.values(r).forEach(e=>{if(4!==e.size)return;let t=[...e],n=t[0],r=t.splice(1,3);delete zp[n.imageryKey],n.grow().fetchData(),r.forEach(e=>{let t=Lp.indexOf(e);Lp.splice(t,1),delete zp[e.imageryKey],e.recycle()})});const u=Oc.getState().target;Lp.forEach(e=>{Cp.copy(e.mesh.geometry.boundingSphere.center),Cp.sub(u);const t=Math.abs(Cp.x)>Op?-Math.sign(Cp.x):0,n=Math.abs(Cp.y)>Op?Math.sign(Cp.y):0;(t||n)&&(e.shift(t,n,Rp),e.fetchData())}),Lp.filter(e=>e.bestImagery.downsample>0).forEach(e=>e.fetchData()),Lp.forEach(e=>{zp[e.imageryKey]<10&&e.onSeen()})}uu.hasUpdates&&uu.broadcastUpdate(),ic.hasUpdates&&ic.broadcastUpdate()});var kp=Dl.getState().element,Up={mouse:{x:0,y:0},init:function(){var e=function(e){if(!vc.getState().interacting){var t=e.srcElement.getBoundingClientRect(),n=e.clientX||e.pageX,r=e.clientY||e.pageY;n-=t.left,r-=t.top,isNaN(n)||isNaN(r)||(Up.mouse={x:n,y:r})}};"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0||kp.addEventListener("mousemove",function(t){e(t)});var t=e=>{if(2===e.detail)!function(){var e=Dl.toClipSpace(Up.mouse);if(Math.abs(e.x)<.2&&Math.abs(e.y)<.2)s.doubleTapZoom();else{var t=Gu.raycastTerrain(Up.mouse);Math.abs(t.x)<7500&&Math.abs(t.y)<7500&&s.focusOnTarget(t)}}();else{var t=Gu.pickFeature(Up.mouse);t&&s.featureClicked(t)}return!0};Oc.getState().controls.addEventListener("click",n=>{e(n),t(n)})}};var Np=ch([[c.setCameraModeControlVisible],[c.setCompassVisible],[c.setLayersControlVisible],[c.setRotationControlVisible],[c.setSeasonControlVisible],[s.setSecondaryParams],[c.setUserLocationControlVisible],[c.setZoomControlVisible]]);Np.displayName="UserInterfaceStore";var Bp=o.createStore(Np),jp={position:"absolute",top:9,left:11,padding:"3px 13px",border:"1px solid white",borderRadius:34,backgroundColor:"#333542"},Gp="solid 4px transparent",Hp={borderBottom:"solid 14px #b33330",borderLeft:Gp,borderRight:Gp},Vp={borderTop:"solid 14px #cccccc",borderLeft:Gp,borderRight:Gp},Wp=new Qs.Vector3,qp=eh.createClass({displayName:"Compass",getInitialState:function(){return{azimuth:0,visible:Bp.getState().compassVisible}},componentDidMount:function(){var e;Oc.listen(this.onStoreChange),Bp.listen((e="compassVisible",function(t){this.setState({visible:t[e]})}).bind(this))},onStoreChange:function(e){Wp.subVectors(e.position,e.target);var t=.5*Math.PI+Math.atan2(Wp.y,Wp.x);t=.01*Math.round(100*t),this.setState({azimuth:t})},shouldComponentUpdate:function(e,t){return this.state.azimuth!==t.azimuth||this.state.visible!==t.visible},render:function(){return!1===this.state.visible?null:(jp.transform="rotate("+this.state.azimuth+"rad) translateZ(0)",eh.createElement("div",{className:"compass",style:Object.assign({},jp)},eh.createElement("div",{style:Hp}),eh.createElement("div",{style:Vp})))}}),Yp=eh.createClass({displayName:"Container",render:function(){return eh.createElement("div",{style:{position:"relative",height:"100%",overflow:"hidden"}},eh.createElement("div",{id:"container",style:{fontSize:"14px",color:"#fff",position:"absolute",top:0,bottom:0,left:0,right:0}},this.props.children))}});const Xp={position:"absolute",bottom:0,right:0,paddingTop:1,paddingBottom:1,paddingLeft:4,paddingRight:4,fontFamily:tp,textAlign:"right",textTransform:"none",color:"white",background:"rgba( 255, 255, 255, 0.1 )"},Zp={color:"white",fontSize:"6pt",margin:0},Jp=["&copy; ONECOMPATH"],Kp=eh.createClass({displayName:"Credits",getInitialState:()=>Gl.getState().datasource,componentDidMount:function(){Gl.listen(this.onStoreChange),this.onStoreChange(Gl.getState())},onStoreChange:function({datasource:e}){this.setState(e)},render:function(){let e=[...Jp];this.state.imagery&&e.push(this.state.imagery.attribution);let t=`color: ${Zp.color}; font-size: ${Zp.fontSize}; margin: ${Zp.margin}; text-decoration: underline;`;return e=e.map(e=>e.replace(/<a href=/g,'<a style="'+t+'" href=')),eh.createElement("div",{className:"credits",style:Xp},eh.createElement("p",{style:Zp},e.map(e=>eh.createElement(eh.Fragment,null,eh.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),eh.createElement("span",null," ")))))}});function Qp(){this.message=null,this.displayErrors=!0,this.bindListeners({clearError:s.setCurrentPlace,fatalError:a.fatalError,setDisplayErrors:c.setDisplayErrors})}Qp.prototype.clearError=function(){this.message=null},Qp.prototype.fatalError=function(e){this.message=e},Qp.prototype.setDisplayErrors=function(e){this.displayErrors=e},Qp.displayName="ErrorStore";var $p=o.createStore(Qp),ed=Dl.getState().element,td=eh.createClass({displayName:"Engine",componentDidMount:function(){(this.base||this.getDOMNode()).appendChild(ed),ed.appendChild(Zl.domElement),setTimeout(function(){a.containerMounted()},0),$p.listen(this.onError),this.setState(this.getInitialState())},getInitialState:function(){return{error:$p.getState().message}},onError:function(e){e.displayErrors&&this.setState({error:e.message})},render:function(){var e={width:"100%",height:"100%",touchAction:"none"};if(this.state.error){var t={padding:10,textAlign:"center"};return eh.createElement("div",{style:e},eh.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",zIndex:10,background:"black"}},eh.createElement("h2",{style:t},"Error"),eh.createElement("p",{style:t},this.state.error)))}return eh.createElement("div",{style:e})}}),nd={border:"1px solid white",margin:4,color:"white",width:36,height:36,lineHeight:"32px",textAlign:"center",padding:0,borderRadius:18,backgroundColor:"#333542",outline:"none",WebkitTransition:"background-color 0.5s",transition:"background-color 0.5s",cursor:"pointer"},rd={backgroundColor:"rgba(97, 97, 97, 0.5)"},id=eh.createClass({displayName:"Button",getInitialState:function(){return{hover:!1}},mouseOver:function(){this.setState({hover:!0})},mouseOut:function(){this.setState({hover:!1})},render:function(){var e=Object.assign({},nd,this.state.hover?rd:void 0,this.props.style);return eh.createElement("button",{className:this.props.icon,onClick:this.props.action,onMouseOver:this.mouseOver,onMouseOut:this.mouseOut,style:e},this.props.text)}}),od=eh.createClass({displayName:"ButtonRow",render:function(){var e=this.props.buttons.map(function(e){return eh.createElement(id,{action:e.action,icon:e.icon,text:e.text})});return eh.createElement("div",null,e)}}),ad=null,sd=!1;if("geolocation"in navigator){ad={icon:"b1 fa fa-location-arrow",action:function(){sd||(navigator.geolocation.watchPosition(wl.panToPosition),sd=!0),wl.toggleTracking()}}}var ld=eh.createClass({displayName:"EngineControlsBottom",getInitialState:function(){return Bp.getState()},componentDidMount:function(){Bp.listen(this.onStoreChange),this.setState(this.getInitialState())},onStoreChange:function(e){this.setState(e)},shouldComponentUpdate:function(e,t){return this.state.userLocationControlVisible!==t.userLocationControlVisible},render:function(){var e=[];this.state.userLocationControlVisible&&e.push(eh.createElement(od,{className:"engine-controls-user-location",buttons:[ad]}));return eh.createElement("div",{style:{position:"absolute",top:"initial",bottom:15,right:8},className:"engine-controls bottom"},e)}}),cd=[{icon:"b1 fa fa-minus",action:s.zoomOut},{icon:"b1 fa fa-plus",action:s.zoomIn}],ud=[{text:"2D",action:function(){s.setCameraMode("2D"),s.setTerrainEffectContours()}},{text:"3D",action:function(){s.setCameraMode("3D"),s.setTerrainEffectNone()}}],hd=[{icon:"b1 fa fa-rotate-right",action:s.rotateRight},{icon:"b1 fa fa-rotate-left",action:s.rotateLeft}],pd=eh.createClass({displayName:"EngineControlsTop",getInitialState:function(){return Bp.getState()},componentDidMount:function(){Bp.listen(this.onStoreChange),this.setState(this.getInitialState())},onStoreChange:function(e){this.setState(e)},shouldComponentUpdate:function(e,t){return this.state.cameraModeControlVisible!==t.cameraModeControlVisible||this.state.rotationControlVisible!==t.rotationControlVisible||this.state.zoomControlVisible!==t.zoomControlVisible},render:function(){var e=[];this.state.zoomControlVisible&&e.push(eh.createElement(od,{className:"engine-controls-zoom",buttons:cd})),this.state.cameraModeControlVisible&&e.push(eh.createElement(od,{className:"engine-controls-cam",buttons:ud})),this.state.rotationControlVisible&&e.push(eh.createElement(od,{className:"engine-controls-rotate",buttons:hd}));return eh.createElement("div",{style:{position:"absolute",top:6,right:8},className:"engine-controls"},e)}}),dd=eh.createClass({displayName:"PoweredBy",render:function(){var e={backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='34.32' y='1.52' width='57.03' height='57.03' fill='%23fff'/><rect x='34.32' y='69.96' width='28.52' height='28.52' fill='%23fff'/><rect x='8.65' y='69.96' width='14.26' height='14.26' fill='%23fff'/><rect x='15.78' y='51.43' width='7.13' height='7.13' fill='%23fff'/></svg>\")\n",backgroundRepeat:"no-repeat",display:"block",height:40,width:40};return eh.createElement("div",{className:"powered-by",style:{position:"absolute",padding:"11px 8px",bottom:0,opacity:.9,WebkitTouchCallout:"none",WebkitUserSelect:"none",KhtmlUserSelect:"none",MozUserSelect:"none",MsUserSelect:"none",userSelect:"none"}},eh.createElement("a",{href:"https://github.com/felixpalmer/procedural-gl-js",target:"_blank",style:e}))}}),fd=eh.createClass({displayName:"App",render:function(){return eh.createElement(Yp,null,eh.createElement(td,null),eh.createElement(Kp,null),eh.createElement(pd,null),eh.createElement(ld,null),eh.createElement(qp,null),eh.createElement(dd,null))}});Gl.listen(function(e){e.appContainer&&eh.render(eh.createElement(fd,null),e.appContainer)}),c.configureCamera({minDistance:500,minHeight:250,zoomInDuration:.8,zoomOutDuration:1}),Up.init(),console.log("Procedural v1.0.6");const md={...l,...u,...p,...v,...g,...Wu,...Zu,...Ju,...Ku};let vd=["onFeatureClicked","onFeatureSelected","onOverlayAdded"];for(let e of vd)Object.defineProperty(md,e,{set:t=>Wu[e]=t});vd=["onBoundsFocused","onLocationError","onLocationFocused","onLocationLoaded","onUserInteraction"];for(let e of vd)Object.defineProperty(md,e,{set:t=>p[e]=t});return md});